"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/notifications/count/route";
exports.ids = ["app/api/notifications/count/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Fcount%2Froute&page=%2Fapi%2Fnotifications%2Fcount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Fcount%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Fcount%2Froute&page=%2Fapi%2Fnotifications%2Fcount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Fcount%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_notifications_count_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/notifications/count/route.js */ \"(rsc)/./src/app/api/notifications/count/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/notifications/count/route\",\n        pathname: \"/api/notifications/count\",\n        filename: \"route\",\n        bundlePath: \"app/api/notifications/count/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\bacze\\\\Project\\\\GroupShare\\\\groupshare-project\\\\src\\\\app\\\\api\\\\notifications\\\\count\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_notifications_count_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/notifications/count/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZub3RpZmljYXRpb25zJTJGY291bnQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm5vdGlmaWNhdGlvbnMlMkZjb3VudCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm5vdGlmaWNhdGlvbnMlMkZjb3VudCUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUN3RDtBQUNySTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8/MzhkMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxiYWN6ZVxcXFxQcm9qZWN0XFxcXEdyb3VwU2hhcmVcXFxcZ3JvdXBzaGFyZS1wcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXG5vdGlmaWNhdGlvbnNcXFxcY291bnRcXFxccm91dGUuanNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL25vdGlmaWNhdGlvbnMvY291bnQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9ub3RpZmljYXRpb25zL2NvdW50XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9ub3RpZmljYXRpb25zL2NvdW50L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcVXNlcnNcXFxcYmFjemVcXFxcUHJvamVjdFxcXFxHcm91cFNoYXJlXFxcXGdyb3Vwc2hhcmUtcHJvamVjdFxcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFxub3RpZmljYXRpb25zXFxcXGNvdW50XFxcXHJvdXRlLmpzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9ub3RpZmljYXRpb25zL2NvdW50L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Fcount%2Froute&page=%2Fapi%2Fnotifications%2Fcount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Fcount%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/notifications/count/route.js":
/*!**************************************************!*\
  !*** ./src/app/api/notifications/count/route.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/currentUser.js\");\n/* harmony import */ var _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/database/supabase-admin-client */ \"(rsc)/./src/lib/database/supabase-admin-client.js\");\n/* harmony import */ var _services_notification_notification_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/services/notification/notification-service */ \"(rsc)/./src/services/notification/notification-service.js\");\n// src/app/api/notifications/count/route.js\n\n\n\n\nconst dynamic = \"force-dynamic\";\n/**\r\n * GET /api/notifications/count\r\n * Pobiera liczbę nieprzeczytanych powiadomień dla zalogowanego użytkownika\r\n */ async function GET(request) {\n    try {\n        // Sprawdź autentykację\n        const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__.currentUser)();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        // Pobierz ID profilu użytkownika\n        const { data: userProfile } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_1__[\"default\"].from(\"user_profiles\").select(\"id\").eq(\"external_auth_id\", user.id).single();\n        if (!userProfile) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User profile not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Pobierz liczbę nieprzeczytanych powiadomień\n        const count = await _services_notification_notification_service__WEBPACK_IMPORTED_MODULE_2__.notificationService.getUnreadCount(userProfile.id);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            count\n        });\n    } catch (error) {\n        console.error(\"Error fetching notification count:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to fetch notification count\",\n            details: error.message\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9ub3RpZmljYXRpb25zL2NvdW50L3JvdXRlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDJDQUEyQztBQUNBO0FBQ1E7QUFDYztBQUNrQjtBQUU1RSxNQUFNSSxVQUFVLGdCQUFnQjtBQUV2Qzs7O0NBR0MsR0FDTSxlQUFlQyxJQUFJQyxPQUFPO0lBQy9CLElBQUk7UUFDRix1QkFBdUI7UUFDdkIsTUFBTUMsT0FBTyxNQUFNTixpRUFBV0E7UUFDOUIsSUFBSSxDQUFDTSxNQUFNO1lBQ1QsT0FBT1AscURBQVlBLENBQUNRLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFlLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNwRTtRQUVBLGlDQUFpQztRQUNqQyxNQUFNLEVBQUVDLE1BQU1DLFdBQVcsRUFBRSxHQUFHLE1BQU1WLDJFQUFhQSxDQUM5Q1csSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUMsTUFDUEMsRUFBRSxDQUFDLG9CQUFvQlIsS0FBS1MsRUFBRSxFQUM5QkMsTUFBTTtRQUVULElBQUksQ0FBQ0wsYUFBYTtZQUNoQixPQUFPWixxREFBWUEsQ0FBQ1EsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQXlCLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUM5RTtRQUVBLDhDQUE4QztRQUM5QyxNQUFNUSxRQUFRLE1BQU1mLDRGQUFtQkEsQ0FBQ2dCLGNBQWMsQ0FBQ1AsWUFBWUksRUFBRTtRQUVyRSxPQUFPaEIscURBQVlBLENBQUNRLElBQUksQ0FBQztZQUFFVTtRQUFNO0lBQ25DLEVBQUUsT0FBT1QsT0FBTztRQUNkVyxRQUFRWCxLQUFLLENBQUMsc0NBQXNDQTtRQUNwRCxPQUFPVCxxREFBWUEsQ0FBQ1EsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1lBQXNDWSxTQUFTWixNQUFNYSxPQUFPO1FBQUMsR0FDdEU7WUFBRVosUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ncm91cHNoYXJlLXByb2plY3QvLi9zcmMvYXBwL2FwaS9ub3RpZmljYXRpb25zL2NvdW50L3JvdXRlLmpzP2IyYmEiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2FwcC9hcGkvbm90aWZpY2F0aW9ucy9jb3VudC9yb3V0ZS5qc1xyXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGN1cnJlbnRVc2VyIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xyXG5pbXBvcnQgc3VwYWJhc2VBZG1pbiBmcm9tICdAL2xpYi9kYXRhYmFzZS9zdXBhYmFzZS1hZG1pbi1jbGllbnQnO1xyXG5pbXBvcnQgeyBub3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnQC9zZXJ2aWNlcy9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLXNlcnZpY2UnO1xyXG5cclxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSAnZm9yY2UtZHluYW1pYyc7XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvbm90aWZpY2F0aW9ucy9jb3VudFxyXG4gKiBQb2JpZXJhIGxpY3pixJkgbmllcHJ6ZWN6eXRhbnljaCBwb3dpYWRvbWllxYQgZGxhIHphbG9nb3dhbmVnbyB1xbx5dGtvd25pa2FcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBTcHJhd2TFuiBhdXRlbnR5a2FjasSZXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgY3VycmVudFVzZXIoKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQb2JpZXJ6IElEIHByb2ZpbHUgdcW8eXRrb3duaWthXHJcbiAgICBjb25zdCB7IGRhdGE6IHVzZXJQcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgaWYgKCF1c2VyUHJvZmlsZSkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VzZXIgcHJvZmlsZSBub3QgZm91bmQnIH0sIHsgc3RhdHVzOiA0MDQgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUG9iaWVyeiBsaWN6YsSZIG5pZXByemVjenl0YW55Y2ggcG93aWFkb21pZcWEXHJcbiAgICBjb25zdCBjb3VudCA9IGF3YWl0IG5vdGlmaWNhdGlvblNlcnZpY2UuZ2V0VW5yZWFkQ291bnQodXNlclByb2ZpbGUuaWQpO1xyXG5cclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGNvdW50IH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBub3RpZmljYXRpb24gY291bnQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIG5vdGlmaWNhdGlvbiBjb3VudCcsIGRldGFpbHM6IGVycm9yLm1lc3NhZ2UgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjdXJyZW50VXNlciIsInN1cGFiYXNlQWRtaW4iLCJub3RpZmljYXRpb25TZXJ2aWNlIiwiZHluYW1pYyIsIkdFVCIsInJlcXVlc3QiLCJ1c2VyIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiZGF0YSIsInVzZXJQcm9maWxlIiwiZnJvbSIsInNlbGVjdCIsImVxIiwiaWQiLCJzaW5nbGUiLCJjb3VudCIsImdldFVucmVhZENvdW50IiwiY29uc29sZSIsImRldGFpbHMiLCJtZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/notifications/count/route.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/database/supabase-admin-client.js":
/*!***************************************************!*\
  !*** ./src/lib/database/supabase-admin-client.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createNotification: () => (/* binding */ createNotification),\n/* harmony export */   createUserProfileAdmin: () => (/* binding */ createUserProfileAdmin),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getGroupMembersAdmin: () => (/* binding */ getGroupMembersAdmin),\n/* harmony export */   getSubscriptionPlatformsAdmin: () => (/* binding */ getSubscriptionPlatformsAdmin),\n/* harmony export */   getUnreadNotificationsCount: () => (/* binding */ getUnreadNotificationsCount),\n/* harmony export */   getUserByAuthIdAdmin: () => (/* binding */ getUserByAuthIdAdmin),\n/* harmony export */   handleSupabaseAdminError: () => (/* binding */ handleSupabaseAdminError),\n/* harmony export */   logAdminActivity: () => (/* binding */ logAdminActivity),\n/* harmony export */   updateUserProfileAdmin: () => (/* binding */ updateUserProfileAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// src/lib/database/supabase-admin-client.js\n\n// Inicjalizacja klienta Supabase z uprawnieniami administratora\n// Dodajemy wartości domyślne w przypadku braku zmiennych środowiskowych\nconst supabaseUrl = \"https://nimrnohkesysfppcmujb.supabase.co\" || 0;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\";\n// Sprawdzenie czy zmienne środowiskowe są ustawione\nif (!supabaseUrl || !supabaseServiceKey) {\n    console.error(\"Missing environment variables: NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\");\n}\n// Sprawdź, czy zmienne są poprawne przed utworzeniem klienta\nconst isConfigValid = supabaseUrl && supabaseServiceKey;\n// Uwaga: Ten klient ma pełne uprawnienia do bazy danych, używaj ostrożnie!\nconst supabaseAdmin = isConfigValid ? (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n}) : null;\n// Funkcja pomocnicza do obsługi błędów Supabase\nconst handleSupabaseAdminError = (error)=>{\n    console.error(\"Supabase Admin error:\", error);\n    return {\n        error: true,\n        message: error.message || \"Nieoczekiwany błąd administratora\",\n        code: error.code || \"unknown_error\",\n        details: error.details || null\n    };\n};\n// Funkcje administratora do zarządzania użytkownikami\n// Funkcja do tworzenia profilu użytkownika przez administratora\nconst createUserProfileAdmin = async (userProfile)=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").insert([\n            userProfile\n        ]).select().single();\n        if (error) {\n            if (error.code === \"23505\") {\n                console.warn(\"Admin: Pr\\xf3ba utworzenia duplikatu profilu użytkownika:\", error);\n                // Jeśli profil już istnieje, pobierz go\n                const { data: existingUser, error: fetchError } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", userProfile.external_auth_id).single();\n                if (fetchError) {\n                    throw new Error(\"Nie można pobrać istniejącego profilu: \" + fetchError.message);\n                }\n                return existingUser;\n            } else {\n                throw new Error(error.message || \"Nie udało się utworzyć profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania profilu użytkownika przez administratora\nconst getUserByAuthIdAdmin = async (authId)=>{\n    if (!authId) return null;\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", authId).single();\n        if (error) {\n            if (error.code === \"PGRST116\") {\n                // Nie znaleziono - to normalny przypadek\n                return null;\n            } else {\n                console.error(\"Admin: Błąd pobierania profilu użytkownika:\", error);\n                throw new Error(error.message || \"Nie udało się pobrać profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do aktualizacji profilu użytkownika przez administratora\nconst updateUserProfileAdmin = async (userId, updates)=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").update(updates).eq(\"id\", userId).select().single();\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania platform subskrypcyjnych przez administratora\nconst getSubscriptionPlatformsAdmin = async ()=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { data, error } = await supabaseAdmin.from(\"subscription_platforms\").select(\"*\").order(\"name\");\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Funkcja do pobierania członków grupy przez administratora\nconst getGroupMembersAdmin = async (groupId)=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { data, error } = await supabaseAdmin.from(\"group_members\").select(`\r\n        *,\r\n        user:user_profiles(id, display_name, avatar_url, email)\r\n      `).eq(\"group_id\", groupId);\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Zapisz wszystkie aktywności administratora do logu bezpieczeństwa\nconst logAdminActivity = async (action, resourceType, resourceId, details = {})=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            console.error(\"Database client is not initialized. Could not log activity.\");\n            return;\n        }\n        const { data, error } = await supabaseAdmin.from(\"security_logs\").insert([\n            {\n                action_type: action,\n                resource_type: resourceType,\n                resource_id: resourceId,\n                status: \"success\",\n                details: details\n            }\n        ]);\n        if (error) console.error(\"Błąd logowania aktywności administratora:\", error);\n    } catch (error) {\n        console.error(\"Wyjątek podczas logowania aktywności administratora:\", error);\n    }\n};\n// Funkcja do zarządzania powiadomieniami użytkowników\nconst createNotification = async (userId, type, title, content, relatedEntityType = null, relatedEntityId = null)=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { data, error } = await supabaseAdmin.from(\"notifications\").insert([\n            {\n                user_id: userId,\n                type,\n                title,\n                content,\n                related_entity_type: relatedEntityType,\n                related_entity_id: relatedEntityId,\n                is_read: false,\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            }\n        ]).select().single();\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania nieprzeczytanych powiadomień użytkownika\nconst getUnreadNotificationsCount = async (userId)=>{\n    try {\n        // Sprawdź czy klient jest dostępny\n        if (!supabaseAdmin) {\n            throw new Error(\"Database client is not initialized. Check environment variables.\");\n        }\n        const { count, error } = await supabaseAdmin.from(\"notifications\").select(\"*\", {\n            count: \"exact\",\n            head: true\n        }).eq(\"user_id\", userId).eq(\"is_read\", false);\n        if (error) throw error;\n        return count || 0;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return 0;\n    }\n};\n// Sprawdź czy klient jest poprawnie skonfigurowany\nif (!supabaseAdmin) {\n    console.error(\"UWAGA: Klient supabaseAdmin nie został zainicjalizowany poprawnie. Upewnij się, że zmienne środowiskowe są ustawione.\");\n}\n// Eksport klienta administratora jako domyślny\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabaseAdmin);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLDRDQUE0QztBQUNTO0FBRXJELGdFQUFnRTtBQUNoRSx3RUFBd0U7QUFDeEUsTUFBTUMsY0FBY0MsMENBQW9DLElBQUk7QUFDNUQsTUFBTUcscUJBQXFCSCxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QixJQUFJO0FBRXBFLG9EQUFvRDtBQUNwRCxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksb0JBQW9CO0lBQ3ZDRSxRQUFRQyxLQUFLLENBQ1g7QUFFSjtBQUVBLDZEQUE2RDtBQUM3RCxNQUFNQyxnQkFBZ0JSLGVBQWVJO0FBRXJDLDJFQUEyRTtBQUMzRSxNQUFNSyxnQkFBZ0JELGdCQUNsQlQsbUVBQVlBLENBQUNDLGFBQWFJLG9CQUFvQjtJQUM1Q00sTUFBTTtRQUNKQyxnQkFBZ0I7UUFDaEJDLGtCQUFrQjtJQUNwQjtBQUNGLEtBQ0E7QUFFSixnREFBZ0Q7QUFDekMsTUFBTUMsMkJBQTJCLENBQUNOO0lBQ3ZDRCxRQUFRQyxLQUFLLENBQUMseUJBQXlCQTtJQUV2QyxPQUFPO1FBQ0xBLE9BQU87UUFDUE8sU0FBU1AsTUFBTU8sT0FBTyxJQUFJO1FBQzFCQyxNQUFNUixNQUFNUSxJQUFJLElBQUk7UUFDcEJDLFNBQVNULE1BQU1TLE9BQU8sSUFBSTtJQUM1QjtBQUNGLEVBQUU7QUFFRixzREFBc0Q7QUFFdEQsZ0VBQWdFO0FBQ3pELE1BQU1DLHlCQUF5QixPQUFPQztJQUMzQyxJQUFJO1FBQ0YsbUNBQW1DO1FBQ25DLElBQUksQ0FBQ1QsZUFBZTtZQUNsQixNQUFNLElBQUlVLE1BQU07UUFDbEI7UUFFQSxNQUFNLEVBQUVDLElBQUksRUFBRWIsS0FBSyxFQUFFLEdBQUcsTUFBTUUsY0FDM0JZLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDO1lBQUNKO1NBQVksRUFDcEJLLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlqQixP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QyxXQUFXO2dCQUNsQ0MsWUFBWSxJQUFJRixPQUFPQyxXQUFXO1lBQ3BDO1NBQUUsRUFDRHJDLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlqQixPQUFPLE1BQU1BO1FBRWpCLE9BQU9hO0lBQ1QsRUFBRSxPQUFPYixPQUFPO1FBQ2RNLHlCQUF5Qk47UUFDekIsTUFBTUE7SUFDUjtBQUNGLEVBQUU7QUFFRixpRUFBaUU7QUFDMUQsTUFBTXVELDhCQUE4QixPQUFPN0I7SUFDaEQsSUFBSTtRQUNGLG1DQUFtQztRQUNuQyxJQUFJLENBQUN4QixlQUFlO1lBQ2xCLE1BQU0sSUFBSVUsTUFBTTtRQUNsQjtRQUVBLE1BQU0sRUFBRTRDLEtBQUssRUFBRXhELEtBQUssRUFBRSxHQUFHLE1BQU1FLGNBQzVCWSxJQUFJLENBQUMsaUJBQ0xFLE1BQU0sQ0FBQyxLQUFLO1lBQUV3QyxPQUFPO1lBQVNDLE1BQU07UUFBSyxHQUN6Q3BDLEVBQUUsQ0FBQyxXQUFXSyxRQUNkTCxFQUFFLENBQUMsV0FBVztRQUVqQixJQUFJckIsT0FBTyxNQUFNQTtRQUVqQixPQUFPd0QsU0FBUztJQUNsQixFQUFFLE9BQU94RCxPQUFPO1FBQ2RNLHlCQUF5Qk47UUFDekIsT0FBTztJQUNUO0FBQ0YsRUFBRTtBQUVGLG1EQUFtRDtBQUNuRCxJQUFJLENBQUNFLGVBQWU7SUFDbEJILFFBQVFDLEtBQUssQ0FBQztBQUNoQjtBQUVBLCtDQUErQztBQUMvQyxpRUFBZUUsYUFBYUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8uL3NyYy9saWIvZGF0YWJhc2Uvc3VwYWJhc2UtYWRtaW4tY2xpZW50LmpzPzM0NzciXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2xpYi9kYXRhYmFzZS9zdXBhYmFzZS1hZG1pbi1jbGllbnQuanNcclxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcclxuXHJcbi8vIEluaWNqYWxpemFjamEga2xpZW50YSBTdXBhYmFzZSB6IHVwcmF3bmllbmlhbWkgYWRtaW5pc3RyYXRvcmFcclxuLy8gRG9kYWplbXkgd2FydG/Fm2NpIGRvbXnFm2xuZSB3IHByenlwYWRrdSBicmFrdSB6bWllbm55Y2ggxZtyb2Rvd2lza293eWNoXHJcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIHx8ICcnO1xyXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8ICcnO1xyXG5cclxuLy8gU3ByYXdkemVuaWUgY3p5IHptaWVubmUgxZtyb2Rvd2lza293ZSBzxIUgdXN0YXdpb25lXHJcbmlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZUtleSkge1xyXG4gIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAnTWlzc2luZyBlbnZpcm9ubWVudCB2YXJpYWJsZXM6IE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBvciBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZJ1xyXG4gICk7XHJcbn1cclxuXHJcbi8vIFNwcmF3ZMW6LCBjenkgem1pZW5uZSBzxIUgcG9wcmF3bmUgcHJ6ZWQgdXR3b3J6ZW5pZW0ga2xpZW50YVxyXG5jb25zdCBpc0NvbmZpZ1ZhbGlkID0gc3VwYWJhc2VVcmwgJiYgc3VwYWJhc2VTZXJ2aWNlS2V5O1xyXG5cclxuLy8gVXdhZ2E6IFRlbiBrbGllbnQgbWEgcGXFgm5lIHVwcmF3bmllbmlhIGRvIGJhenkgZGFueWNoLCB1xbx5d2FqIG9zdHJvxbxuaWUhXHJcbmNvbnN0IHN1cGFiYXNlQWRtaW4gPSBpc0NvbmZpZ1ZhbGlkIFxyXG4gID8gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXksIHtcclxuICAgICAgYXV0aDoge1xyXG4gICAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSxcclxuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcclxuICAgICAgfSxcclxuICAgIH0pXHJcbiAgOiBudWxsO1xyXG5cclxuLy8gRnVua2NqYSBwb21vY25pY3phIGRvIG9ic8WCdWdpIGLFgsSZZMOzdyBTdXBhYmFzZVxyXG5leHBvcnQgY29uc3QgaGFuZGxlU3VwYWJhc2VBZG1pbkVycm9yID0gKGVycm9yKSA9PiB7XHJcbiAgY29uc29sZS5lcnJvcignU3VwYWJhc2UgQWRtaW4gZXJyb3I6JywgZXJyb3IpO1xyXG4gIFxyXG4gIHJldHVybiB7XHJcbiAgICBlcnJvcjogdHJ1ZSxcclxuICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ05pZW9jemVraXdhbnkgYsWCxIVkIGFkbWluaXN0cmF0b3JhJyxcclxuICAgIGNvZGU6IGVycm9yLmNvZGUgfHwgJ3Vua25vd25fZXJyb3InLFxyXG4gICAgZGV0YWlsczogZXJyb3IuZGV0YWlscyB8fCBudWxsLFxyXG4gIH07XHJcbn07XHJcblxyXG4vLyBGdW5rY2plIGFkbWluaXN0cmF0b3JhIGRvIHphcnrEhWR6YW5pYSB1xbx5dGtvd25pa2FtaVxyXG5cclxuLy8gRnVua2NqYSBkbyB0d29yemVuaWEgcHJvZmlsdSB1xbx5dGtvd25pa2EgcHJ6ZXogYWRtaW5pc3RyYXRvcmFcclxuZXhwb3J0IGNvbnN0IGNyZWF0ZVVzZXJQcm9maWxlQWRtaW4gPSBhc3luYyAodXNlclByb2ZpbGUpID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gU3ByYXdkxbogY3p5IGtsaWVudCBqZXN0IGRvc3TEmXBueVxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAuaW5zZXJ0KFt1c2VyUHJvZmlsZV0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJzIzNTA1Jykge1xyXG4gICAgICAgIGNvbnNvbGUud2FybignQWRtaW46IFByw7NiYSB1dHdvcnplbmlhIGR1cGxpa2F0dSBwcm9maWx1IHXFvHl0a293bmlrYTonLCBlcnJvcik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSmXFm2xpIHByb2ZpbCBqdcW8IGlzdG5pZWplLCBwb2JpZXJ6IGdvXHJcbiAgICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZ1VzZXIsIGVycm9yOiBmZXRjaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIHVzZXJQcm9maWxlLmV4dGVybmFsX2F1dGhfaWQpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICBpZiAoZmV0Y2hFcnJvcikge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOaWUgbW/FvG5hIHBvYnJhxIcgaXN0bmllasSFY2VnbyBwcm9maWx1OiAnICsgZmV0Y2hFcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nVXNlcjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSB8fCAnTmllIHVkYcWCbyBzacSZIHV0d29yennEhyBwcm9maWx1IHXFvHl0a293bmlrYScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVua2NqYSBkbyBwb2JpZXJhbmlhIHByb2ZpbHUgdcW8eXRrb3duaWthIHByemV6IGFkbWluaXN0cmF0b3JhXHJcbmV4cG9ydCBjb25zdCBnZXRVc2VyQnlBdXRoSWRBZG1pbiA9IGFzeW5jIChhdXRoSWQpID0+IHtcclxuICBpZiAoIWF1dGhJZCkgcmV0dXJuIG51bGw7XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIC8vIFNwcmF3ZMW6IGN6eSBrbGllbnQgamVzdCBkb3N0xJlwbnlcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNsaWVudCBpcyBub3QgaW5pdGlhbGl6ZWQuIENoZWNrIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIGF1dGhJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgICAgICAvLyBOaWUgem5hbGV6aW9ubyAtIHRvIG5vcm1hbG55IHByenlwYWRla1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FkbWluOiBCxYLEhWQgcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYTonLCBlcnJvcik7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSBwb2JyYcSHIHByb2ZpbHUgdcW8eXRrb3duaWthJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIGFrdHVhbGl6YWNqaSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VySWQsIHVwZGF0ZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gU3ByYXdkxbogY3p5IGtsaWVudCBqZXN0IGRvc3TEmXBueVxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAudXBkYXRlKHVwZGF0ZXMpXHJcbiAgICAgIC5lcSgnaWQnLCB1c2VySWQpXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVua2NqYSBkbyBwb2JpZXJhbmlhIHBsYXRmb3JtIHN1YnNrcnlwY3lqbnljaCBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgZ2V0U3Vic2NyaXB0aW9uUGxhdGZvcm1zQWRtaW4gPSBhc3luYyAoKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFNwcmF3ZMW6IGN6eSBrbGllbnQgamVzdCBkb3N0xJlwbnlcclxuICAgIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNsaWVudCBpcyBub3QgaW5pdGlhbGl6ZWQuIENoZWNrIGVudmlyb25tZW50IHZhcmlhYmxlcy4nKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzdWJzY3JpcHRpb25fcGxhdGZvcm1zJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5vcmRlcignbmFtZScpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgaGFuZGxlU3VwYWJhc2VBZG1pbkVycm9yKGVycm9yKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIHBvYmllcmFuaWEgY3rFgm9ua8OzdyBncnVweSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgZ2V0R3JvdXBNZW1iZXJzQWRtaW4gPSBhc3luYyAoZ3JvdXBJZCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBTcHJhd2TFuiBjenkga2xpZW50IGplc3QgZG9zdMSZcG55XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBjbGllbnQgaXMgbm90IGluaXRpYWxpemVkLiBDaGVjayBlbnZpcm9ubWVudCB2YXJpYWJsZXMuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnZ3JvdXBfbWVtYmVycycpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICosXHJcbiAgICAgICAgdXNlcjp1c2VyX3Byb2ZpbGVzKGlkLCBkaXNwbGF5X25hbWUsIGF2YXRhcl91cmwsIGVtYWlsKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ2dyb3VwX2lkJywgZ3JvdXBJZCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFphcGlzeiB3c3p5c3RraWUgYWt0eXdub8WbY2kgYWRtaW5pc3RyYXRvcmEgZG8gbG9ndSBiZXpwaWVjemXFhHN0d2FcclxuZXhwb3J0IGNvbnN0IGxvZ0FkbWluQWN0aXZpdHkgPSBhc3luYyAoYWN0aW9uLCByZXNvdXJjZVR5cGUsIHJlc291cmNlSWQsIGRldGFpbHMgPSB7fSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBTcHJhd2TFuiBjenkga2xpZW50IGplc3QgZG9zdMSZcG55XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRGF0YWJhc2UgY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZC4gQ291bGQgbm90IGxvZyBhY3Rpdml0eS4nKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2xvZ3MnKVxyXG4gICAgICAuaW5zZXJ0KFt7XHJcbiAgICAgICAgYWN0aW9uX3R5cGU6IGFjdGlvbixcclxuICAgICAgICByZXNvdXJjZV90eXBlOiByZXNvdXJjZVR5cGUsXHJcbiAgICAgICAgcmVzb3VyY2VfaWQ6IHJlc291cmNlSWQsXHJcbiAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXHJcbiAgICAgICAgZGV0YWlsczogZGV0YWlscyxcclxuICAgICAgfV0pO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIGNvbnNvbGUuZXJyb3IoJ0LFgsSFZCBsb2dvd2FuaWEgYWt0eXdub8WbY2kgYWRtaW5pc3RyYXRvcmE6JywgZXJyb3IpO1xyXG4gICAgXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1d5asSFdGVrIHBvZGN6YXMgbG9nb3dhbmlhIGFrdHl3bm/Fm2NpIGFkbWluaXN0cmF0b3JhOicsIGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIHphcnrEhWR6YW5pYSBwb3dpYWRvbWllbmlhbWkgdcW8eXRrb3duaWvDs3dcclxuZXhwb3J0IGNvbnN0IGNyZWF0ZU5vdGlmaWNhdGlvbiA9IGFzeW5jICh1c2VySWQsIHR5cGUsIHRpdGxlLCBjb250ZW50LCByZWxhdGVkRW50aXR5VHlwZSA9IG51bGwsIHJlbGF0ZWRFbnRpdHlJZCA9IG51bGwpID0+IHtcclxuICB0cnkge1xyXG4gICAgLy8gU3ByYXdkxbogY3p5IGtsaWVudCBqZXN0IGRvc3TEmXBueVxyXG4gICAgaWYgKCFzdXBhYmFzZUFkbWluKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2UgY2xpZW50IGlzIG5vdCBpbml0aWFsaXplZC4gQ2hlY2sgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbnMnKVxyXG4gICAgICAuaW5zZXJ0KFt7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgIHR5cGUsXHJcbiAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgY29udGVudCxcclxuICAgICAgICByZWxhdGVkX2VudGl0eV90eXBlOiByZWxhdGVkRW50aXR5VHlwZSxcclxuICAgICAgICByZWxhdGVkX2VudGl0eV9pZDogcmVsYXRlZEVudGl0eUlkLFxyXG4gICAgICAgIGlzX3JlYWQ6IGZhbHNlLFxyXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfV0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVua2NqYSBkbyBwb2JpZXJhbmlhIG5pZXByemVjenl0YW55Y2ggcG93aWFkb21pZcWEIHXFvHl0a293bmlrYVxyXG5leHBvcnQgY29uc3QgZ2V0VW5yZWFkTm90aWZpY2F0aW9uc0NvdW50ID0gYXN5bmMgKHVzZXJJZCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBTcHJhd2TFuiBjenkga2xpZW50IGplc3QgZG9zdMSZcG55XHJcbiAgICBpZiAoIXN1cGFiYXNlQWRtaW4pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBjbGllbnQgaXMgbm90IGluaXRpYWxpemVkLiBDaGVjayBlbnZpcm9ubWVudCB2YXJpYWJsZXMuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBjb3VudCwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxyXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXHJcbiAgICAgIC5lcSgnaXNfcmVhZCcsIGZhbHNlKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGNvdW50IHx8IDA7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbn07XHJcblxyXG4vLyBTcHJhd2TFuiBjenkga2xpZW50IGplc3QgcG9wcmF3bmllIHNrb25maWd1cm93YW55XHJcbmlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gIGNvbnNvbGUuZXJyb3IoJ1VXQUdBOiBLbGllbnQgc3VwYWJhc2VBZG1pbiBuaWUgem9zdGHFgiB6YWluaWNqYWxpem93YW55IHBvcHJhd25pZS4gVXBld25paiBzacSZLCDFvGUgem1pZW5uZSDFm3JvZG93aXNrb3dlIHPEhSB1c3Rhd2lvbmUuJyk7XHJcbn1cclxuXHJcbi8vIEVrc3BvcnQga2xpZW50YSBhZG1pbmlzdHJhdG9yYSBqYWtvIGRvbXnFm2xueVxyXG5leHBvcnQgZGVmYXVsdCBzdXBhYmFzZUFkbWluOyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiY29uc29sZSIsImVycm9yIiwiaXNDb25maWdWYWxpZCIsInN1cGFiYXNlQWRtaW4iLCJhdXRoIiwicGVyc2lzdFNlc3Npb24iLCJhdXRvUmVmcmVzaFRva2VuIiwiaGFuZGxlU3VwYWJhc2VBZG1pbkVycm9yIiwibWVzc2FnZSIsImNvZGUiLCJkZXRhaWxzIiwiY3JlYXRlVXNlclByb2ZpbGVBZG1pbiIsInVzZXJQcm9maWxlIiwiRXJyb3IiLCJkYXRhIiwiZnJvbSIsImluc2VydCIsInNlbGVjdCIsInNpbmdsZSIsIndhcm4iLCJleGlzdGluZ1VzZXIiLCJmZXRjaEVycm9yIiwiZXEiLCJleHRlcm5hbF9hdXRoX2lkIiwiZ2V0VXNlckJ5QXV0aElkQWRtaW4iLCJhdXRoSWQiLCJ1cGRhdGVVc2VyUHJvZmlsZUFkbWluIiwidXNlcklkIiwidXBkYXRlcyIsInVwZGF0ZSIsImdldFN1YnNjcmlwdGlvblBsYXRmb3Jtc0FkbWluIiwib3JkZXIiLCJnZXRHcm91cE1lbWJlcnNBZG1pbiIsImdyb3VwSWQiLCJsb2dBZG1pbkFjdGl2aXR5IiwiYWN0aW9uIiwicmVzb3VyY2VUeXBlIiwicmVzb3VyY2VJZCIsImFjdGlvbl90eXBlIiwicmVzb3VyY2VfdHlwZSIsInJlc291cmNlX2lkIiwic3RhdHVzIiwiY3JlYXRlTm90aWZpY2F0aW9uIiwidHlwZSIsInRpdGxlIiwiY29udGVudCIsInJlbGF0ZWRFbnRpdHlUeXBlIiwicmVsYXRlZEVudGl0eUlkIiwidXNlcl9pZCIsInJlbGF0ZWRfZW50aXR5X3R5cGUiLCJyZWxhdGVkX2VudGl0eV9pZCIsImlzX3JlYWQiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwidXBkYXRlZF9hdCIsImdldFVucmVhZE5vdGlmaWNhdGlvbnNDb3VudCIsImNvdW50IiwiaGVhZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database/supabase-admin-client.js\n");

/***/ }),

/***/ "(rsc)/./src/services/notification/notification-service.js":
/*!***********************************************************!*\
  !*** ./src/services/notification/notification-service.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   notificationService: () => (/* binding */ notificationService)\n/* harmony export */ });\n/* harmony import */ var _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/database/supabase-admin-client */ \"(rsc)/./src/lib/database/supabase-admin-client.js\");\n// src/services/notification/notification-service.js\n\nclass NotificationService {\n    /**\r\n   * Creates a new notification with duplication check\r\n   * @param {string} userId - ID of the user to notify\r\n   * @param {string} type - Type of notification (invite, message, purchase, dispute)\r\n   * @param {string} title - Title of the notification\r\n   * @param {string} content - Content of the notification\r\n   * @param {string} relatedEntityType - Type of related entity (optional)\r\n   * @param {string} relatedEntityId - ID of related entity (optional)\r\n   * @param {string} priority - Priority (high, normal, low) (optional)\r\n   * @param {number} ttl - Time to live in days (0 = no expiration) (optional)\r\n   * @param {boolean} skipDuplicateCheck - Whether to skip duplicate check (optional)\r\n   * @returns {Promise<Object>} Created notification\r\n   */ async createNotification(userId, type, title, content, relatedEntityType = null, relatedEntityId = null, priority = \"normal\", ttl = 0, skipDuplicateCheck = false) {\n        try {\n            // Verify user exists\n            if (!userId || !await this.verifyUserExists(userId)) {\n                console.warn(`User ${userId} does not exist. Skipping notification.`);\n                return null;\n            }\n            // Verify entity exists if entityId and entityType are provided\n            if (relatedEntityId && relatedEntityType && !skipDuplicateCheck) {\n                const entityExists = await this.verifyEntityExists(relatedEntityType, relatedEntityId);\n                if (!entityExists) {\n                    console.warn(`Entity ${relatedEntityType}:${relatedEntityId} does not exist. Skipping notification.`);\n                    return null;\n                }\n            }\n            // Check for similar recent notifications to avoid duplication\n            if (!skipDuplicateCheck && relatedEntityType && relatedEntityId) {\n                const hasDuplicate = await this.checkForDuplicateNotification(userId, type, relatedEntityType, relatedEntityId);\n                if (hasDuplicate) {\n                    console.log(`Skipping duplicate notification: ${type} for ${relatedEntityType}:${relatedEntityId}`);\n                    return null;\n                }\n            }\n            const notification = {\n                user_id: userId,\n                type,\n                title,\n                content,\n                related_entity_type: relatedEntityType,\n                related_entity_id: relatedEntityId,\n                priority,\n                is_read: false,\n                created_at: new Date().toISOString()\n            };\n            // Try insertion with retry logic for important notifications\n            let retryCount = 0;\n            const maxRetries = priority === \"high\" ? 3 : 1;\n            while(retryCount <= maxRetries){\n                try {\n                    const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").insert(notification).select().single();\n                    if (error) throw error;\n                    return data;\n                } catch (insertError) {\n                    retryCount++;\n                    console.warn(`Notification insertion failed (attempt ${retryCount}/${maxRetries + 1}):`, insertError);\n                    if (retryCount <= maxRetries) {\n                        // Exponential backoff\n                        await new Promise((r)=>setTimeout(r, Math.pow(2, retryCount) * 100));\n                    } else {\n                        throw insertError;\n                    }\n                }\n            }\n        } catch (error) {\n            console.error(\"Error creating notification:\", error);\n            // Don't throw - fail silently for notifications\n            return null;\n        }\n    }\n    /**\r\n   * Verify if a user exists\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<boolean>} Whether the user exists\r\n   */ async verifyUserExists(userId) {\n        try {\n            const { count, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"user_profiles\").select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"id\", userId);\n            if (error) throw error;\n            return count > 0;\n        } catch (error) {\n            console.error(`Error verifying user ${userId}:`, error);\n            // Assume user exists if verification fails to ensure notification delivery\n            return true;\n        }\n    }\n    /**\r\n   * Create consolidated notifications for a transaction\r\n   * Sends notifications to all involved parties (buyer, seller)\r\n   * \r\n   * @param {Object} options - Transaction notification options\r\n   * @param {string} options.transactionId - Transaction ID\r\n   * @param {string} options.purchaseId - Purchase ID\r\n   * @param {string} options.status - Transaction status\r\n   * @param {boolean} options.sendToSeller - Whether to send notification to seller\r\n   * @returns {Promise<Object[]>} Created notifications\r\n   */ async createTransactionNotification({ transactionId, purchaseId, status = \"completed\", sendToSeller = true }) {\n        try {\n            // Get complete transaction details with related entities\n            const { data: transaction1, error: transactionError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"transactions\").select(`\r\n          *,\r\n          buyer:buyer_id(id, display_name),\r\n          seller:seller_id(id, display_name),\r\n          purchase:purchase_records!purchase_record_id(\r\n            group_sub_id,\r\n            group_sub:group_subs(\r\n              subscription_platforms(name)\r\n            )\r\n          )\r\n        `).eq(\"id\", transactionId).single();\n            if (transactionError || !transaction1) {\n                console.error(\"Error fetching transaction for notification:\", transactionError);\n                return [];\n            }\n            const result = [];\n            const platformName = transaction1.purchase?.group_sub?.subscription_platforms?.name || \"subskrypcji\";\n            // 1. Notification for buyer\n            if (transaction1.buyer_id) {\n                let buyerType, buyerTitle, buyerContent, buyerPriority;\n                if (status === \"completed\") {\n                    buyerType = \"purchase_completed\";\n                    buyerTitle = `Zakup ${platformName} zakończony pomyślnie`;\n                    buyerContent = `Twój zakup subskrypcji ${platformName} został pomyślnie zrealizowany. Możesz teraz uzyskać dostęp do instrukcji.`;\n                    buyerPriority = \"normal\";\n                } else if (status === \"failed\") {\n                    buyerType = \"purchase_failed\";\n                    buyerTitle = `Problem z zakupem ${platformName}`;\n                    buyerContent = `Wystąpił problem z Twoim zakupem subskrypcji ${platformName}. Sprawdź szczegóły płatności.`;\n                    buyerPriority = \"high\";\n                } else {\n                    buyerType = \"purchase_update\";\n                    buyerTitle = `Aktualizacja zakupu ${platformName}`;\n                    buyerContent = `Status Twojego zakupu subskrypcji ${platformName} został zaktualizowany.`;\n                    buyerPriority = \"normal\";\n                }\n                const buyerNotification = await this.createNotification(transaction1.buyer_id, buyerType, buyerTitle, buyerContent, \"transaction\", transactionId, buyerPriority, 0, true // Skip duplicate check\n                );\n                if (buyerNotification) {\n                    result.push(buyerNotification);\n                }\n            }\n            // 2. Notification for seller (if enabled)\n            if (sendToSeller && transaction1.seller_id && status === \"completed\") {\n                const sellerNotification = await this.createNotification(transaction1.seller_id, \"sale_completed\", \"Sprzedaż zakończona pomyślnie\", `Użytkownik ${transaction1.buyer?.display_name || \"Ktoś\"} właśnie kupił miejsce w Twojej subskrypcji ${platformName}.`, \"transaction\", transactionId, \"normal\", 0, true // Skip duplicate check\n                );\n                if (sellerNotification) {\n                    result.push(sellerNotification);\n                }\n            }\n            return result;\n        } catch (error) {\n            console.error(\"Error creating transaction notifications:\", error);\n            // Fall back to basic notification\n            const buyerNotification = await this.createNotification(transaction?.buyer_id, \"purchase_update\", \"Aktualizacja zakupu\", \"Tw\\xf3j zakup został zaktualizowany.\", \"purchase_record\", purchaseId);\n            return buyerNotification ? [\n                buyerNotification\n            ] : [];\n        }\n    }\n    /**\r\n   * Create consolidated notifications for a dispute\r\n   * Sends notifications to all involved parties\r\n   * \r\n   * @param {Object} options - Dispute notification options\r\n   * @param {string} options.disputeId - Dispute ID\r\n   * @param {string} options.reporterId - User ID who reported the dispute\r\n   * @param {string} options.reportedId - User ID being reported\r\n   * @param {string} options.type - Dispute type\r\n   * @returns {Promise<Object[]>} Created notifications\r\n   */ async createDisputeNotifications({ disputeId, reporterId, reportedId, type = \"access\" }) {\n        try {\n            // Get dispute details\n            const { data: dispute, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"disputes\").select(\"*\").eq(\"id\", disputeId).single();\n            if (error || !dispute) {\n                console.error(\"Error fetching dispute for notification:\", error);\n                return [];\n            }\n            const result = [];\n            // 1. Notification for reporter\n            const reporterNotification = await this.createNotification(reporterId, \"dispute_created\", \"Zgłoszenie problemu zostało zarejestrowane\", `Twoje zgłoszenie problemu z ${type === \"access\" ? \"dostępem\" : \"usługą\"} zostało zarejestrowane. Skontaktujemy się z Tobą wkrótce.`, \"dispute\", disputeId, \"normal\", 0, true // Skip duplicate check\n            );\n            if (reporterNotification) {\n                result.push(reporterNotification);\n            }\n            // 2. Notification for reported user\n            if (reportedId) {\n                const reportedNotification = await this.createNotification(reportedId, \"dispute_filed\", \"Zgłoszono problem z Twoją ofertą\", `Kupujący zgłosił problem z ${type === \"access\" ? \"dostępem do subskrypcji\" : \"usługą\"}. Prosimy o pilną weryfikację.`, \"dispute\", disputeId, \"high\", 0, true // Skip duplicate check\n                );\n                if (reportedNotification) {\n                    result.push(reportedNotification);\n                }\n            }\n            return result;\n        } catch (error) {\n            console.error(\"Error creating dispute notifications:\", error);\n            return [];\n        }\n    }\n    /**\r\n   * Check if a similar notification already exists for this entity and user\r\n   * to prevent duplicate notifications\r\n   * @param {string} userId - User ID\r\n   * @param {string} type - Notification type\r\n   * @param {string} entityType - Entity type\r\n   * @param {string} entityId - Entity ID\r\n   * @returns {Promise<boolean>} Whether a duplicate exists\r\n   */ async checkForDuplicateNotification(userId, type, entityType, entityId) {\n        try {\n            // Check for similar notifications in the last hour\n            const oneHourAgo = new Date();\n            oneHourAgo.setHours(oneHourAgo.getHours() - 1);\n            const { count, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").select(\"*\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId).eq(\"type\", type).eq(\"related_entity_type\", entityType).eq(\"related_entity_id\", entityId).gte(\"created_at\", oneHourAgo.toISOString());\n            if (error) throw error;\n            return count > 0;\n        } catch (error) {\n            console.error(\"Error checking for duplicate notifications:\", error);\n            // If check fails, assume no duplicate to ensure notification is sent\n            return false;\n        }\n    }\n    /**\r\n   * Verify that an entity exists before sending a notification about it\r\n   * @param {string} entityType - Type of entity\r\n   * @param {string} entityId - ID of entity\r\n   * @returns {Promise<boolean>} Whether the entity exists\r\n   */ async verifyEntityExists(entityType, entityId) {\n        try {\n            let table;\n            switch(entityType){\n                case \"group\":\n                    table = \"groups\";\n                    break;\n                case \"purchase\":\n                case \"purchase_record\":\n                    table = \"purchase_records\";\n                    break;\n                case \"dispute\":\n                    table = \"disputes\";\n                    break;\n                case \"transaction\":\n                    table = \"transactions\";\n                    break;\n                case \"group_invitation\":\n                    table = \"group_invitations\";\n                    break;\n                case \"group_sub\":\n                    table = \"group_subs\";\n                    break;\n                case \"conversation\":\n                    table = \"conversations\";\n                    break;\n                default:\n                    console.warn(`Unknown entity type: ${entityType}`);\n                    return false;\n            }\n            const { count, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(table).select(\"id\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"id\", entityId);\n            if (error) throw error;\n            return count > 0;\n        } catch (error) {\n            console.error(`Error verifying entity ${entityType}:${entityId}:`, error);\n            // If verification fails, assume entity exists to ensure notification is sent\n            return true;\n        }\n    }\n    /**\r\n   * Create system notification for multiple recipients\r\n   * @param {string[]} userIds - Array of user IDs to notify\r\n   * @param {string} type - Notification type\r\n   * @param {string} title - Notification title\r\n   * @param {string} content - Notification content\r\n   * @param {string} relatedEntityType - Entity type\r\n   * @param {string} relatedEntityId - Entity ID\r\n   * @returns {Promise<Object[]>} Created notifications\r\n   */ async createBulkNotifications(userIds, type, title, content, relatedEntityType = null, relatedEntityId = null) {\n        if (!userIds || !Array.isArray(userIds) || userIds.length === 0) {\n            return [];\n        }\n        try {\n            // Verify entity exists\n            if (relatedEntityType && relatedEntityId) {\n                const entityExists = await this.verifyEntityExists(relatedEntityType, relatedEntityId);\n                if (!entityExists) {\n                    console.warn(`Entity ${relatedEntityType}:${relatedEntityId} does not exist. Skipping bulk notifications.`);\n                    return [];\n                }\n            }\n            // Create notification objects for each user\n            const notifications = userIds.map((userId)=>({\n                    user_id: userId,\n                    type,\n                    title,\n                    content,\n                    related_entity_type: relatedEntityType,\n                    related_entity_id: relatedEntityId,\n                    is_read: false,\n                    created_at: new Date().toISOString()\n                }));\n            const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").insert(notifications).select();\n            if (error) throw error;\n            return data || [];\n        } catch (error) {\n            console.error(\"Error creating bulk notifications:\", error);\n            // Don't throw - fail silently for notifications\n            return [];\n        }\n    }\n    /**\r\n   * Create a transaction notification that consolidates payment/purchase info\r\n   * @param {string} userId - User ID\r\n   * @param {string} transactionId - Transaction ID\r\n   * @param {string} purchaseId - Purchase ID\r\n   * @param {string} status - Transaction status\r\n   * @returns {Promise<Object>} Created notification\r\n   */ async createTransactionNotification(userId, transactionId, purchaseId, status = \"completed\") {\n        try {\n            // Get transaction details\n            const { data: transaction1, error: transactionError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"transactions\").select(`\r\n          *,\r\n          purchase:purchase_records!purchase_record_id(\r\n            group_sub_id,\r\n            group_sub:group_subs(\r\n              subscription_platforms(name)\r\n            )\r\n          )\r\n        `).eq(\"id\", transactionId).single();\n            if (transactionError || !transaction1) {\n                console.error(\"Error fetching transaction for notification:\", transactionError);\n                return null;\n            }\n            // Determine notification content based on status\n            let title, content, type;\n            const platformName = transaction1.purchase?.group_sub?.subscription_platforms?.name || \"subskrypcji\";\n            if (status === \"completed\") {\n                type = \"purchase_completed\";\n                title = `Zakup ${platformName} zakończony pomyślnie`;\n                content = `Twój zakup subskrypcji ${platformName} został pomyślnie zrealizowany. Możesz teraz uzyskać dostęp do instrukcji.`;\n            } else if (status === \"failed\") {\n                type = \"purchase_failed\";\n                title = `Problem z zakupem ${platformName}`;\n                content = `Wystąpił problem z Twoim zakupem subskrypcji ${platformName}. Sprawdź szczegóły płatności.`;\n            } else {\n                type = \"purchase_update\";\n                title = `Aktualizacja zakupu ${platformName}`;\n                content = `Status Twojego zakupu subskrypcji ${platformName} został zaktualizowany.`;\n            }\n            // Create notification with transaction as the related entity\n            return this.createNotification(userId, type, title, content, \"transaction\", transactionId, status === \"failed\" ? \"high\" : \"normal\", 0, true // Skip duplicate check since we've already customized this\n            );\n        } catch (error) {\n            console.error(\"Error creating transaction notification:\", error);\n            // Fall back to basic notification\n            return this.createNotification(userId, \"purchase\", \"Aktualizacja zakupu\", \"Tw\\xf3j zakup został zaktualizowany.\", \"purchase_record\", purchaseId);\n        }\n    }\n    /**\r\n   * Get unread notification count for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<number>} Number of unread notifications\r\n   */ async getUnreadCount(userId) {\n        try {\n            const { count, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").select(\"*\", {\n                count: \"exact\",\n                head: true\n            }).eq(\"user_id\", userId).eq(\"is_read\", false);\n            if (error) throw error;\n            return count || 0;\n        } catch (error) {\n            console.error(\"Error counting unread notifications:\", error);\n            return 0;\n        }\n    }\n    /**\r\n   * Mark notification as read\r\n   * @param {string|string[]} notificationIds - Notification ID or array of IDs\r\n   * @param {string} userId - User ID for verification\r\n   * @returns {Promise<boolean>} Success status\r\n   */ async markAsRead(notificationIds, userId) {\n        try {\n            // Convert single ID to array if needed\n            const ids = Array.isArray(notificationIds) ? notificationIds : [\n                notificationIds\n            ];\n            const { error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").update({\n                is_read: true\n            }).in(\"id\", ids).eq(\"user_id\", userId);\n            if (error) throw error;\n            return true;\n        } catch (error) {\n            console.error(\"Error marking notifications as read:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * Mark all notifications as read for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<boolean>} Success status\r\n   */ async markAllAsRead(userId) {\n        try {\n            const { error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").update({\n                is_read: true\n            }).eq(\"user_id\", userId).eq(\"is_read\", false);\n            if (error) throw error;\n            return true;\n        } catch (error) {\n            console.error(\"Error marking all notifications as read:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * Delete a notification\r\n   * @param {string} notificationId - Notification ID\r\n   * @param {string} userId - User ID for verification\r\n   * @returns {Promise<boolean>} Success status\r\n   */ async deleteNotification(notificationId, userId) {\n        try {\n            const { error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").delete().eq(\"id\", notificationId).eq(\"user_id\", userId);\n            if (error) throw error;\n            return true;\n        } catch (error) {\n            console.error(\"Error deleting notification:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * Get user notifications with filtering and pagination\r\n   * @param {string} userId - User ID\r\n   * @param {Object} options - Filter and pagination options\r\n   * @returns {Promise<Object>} Notifications and pagination info\r\n   */ async getUserNotifications(userId, options = {}) {\n        try {\n            // Build the query\n            let query = _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notifications\").select(\"*\", {\n                count: \"exact\"\n            }).eq(\"user_id\", userId);\n            // Apply filters\n            if (options.type) {\n                query = query.eq(\"type\", options.type);\n            }\n            if (options.read !== null && options.read !== undefined) {\n                query = query.eq(\"is_read\", options.read);\n            }\n            if (options.priority) {\n                query = query.eq(\"priority\", options.priority);\n            }\n            if (options.relatedEntityType) {\n                query = query.eq(\"related_entity_type\", options.relatedEntityType);\n            }\n            if (options.relatedEntityId) {\n                query = query.eq(\"related_entity_id\", options.relatedEntityId);\n            }\n            // Order by creation date, newest first\n            query = query.order(\"created_at\", {\n                ascending: false\n            });\n            // Apply pagination\n            const page = options.page || 1;\n            const pageSize = options.pageSize || 10;\n            const start = (page - 1) * pageSize;\n            const end = start + pageSize - 1;\n            query = query.range(start, end);\n            // Execute the query\n            const { data, error, count } = await query;\n            if (error) throw error;\n            // Calculate pagination info\n            const totalPages = Math.ceil((count || 0) / pageSize);\n            return {\n                notifications: data || [],\n                pagination: {\n                    page,\n                    pageSize,\n                    total: count || 0,\n                    totalPages\n                }\n            };\n        } catch (error) {\n            console.error(\"Exception in getUserNotifications:\", error);\n            throw new Error(`Failed to fetch notifications: ${error.message}`);\n        }\n    }\n    /**\r\n   * Get notification preferences for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<Object>} Notification preferences\r\n   */ async getNotificationPreferences(userId) {\n        try {\n            const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notification_preferences\").select(\"*\").eq(\"user_id\", userId).maybeSingle();\n            if (error) throw error;\n            // If no preferences exist, return defaults\n            if (!data) {\n                return {\n                    user_id: userId,\n                    email_enabled: true,\n                    push_enabled: false,\n                    notify_on_invite: true,\n                    notify_on_message: true,\n                    notify_on_purchase: true,\n                    notify_on_dispute: true,\n                    email_digest: \"daily\"\n                };\n            }\n            return data;\n        } catch (error) {\n            console.error(\"Error fetching notification preferences:\", error);\n            // Return defaults on error\n            return {\n                user_id: userId,\n                email_enabled: true,\n                push_enabled: false,\n                notify_on_invite: true,\n                notify_on_message: true,\n                notify_on_purchase: true,\n                notify_on_dispute: true,\n                email_digest: \"daily\"\n            };\n        }\n    }\n    /**\r\n   * Update notification preferences for a user\r\n   * @param {string} userId - User ID\r\n   * @param {Object} preferences - Updated preferences\r\n   * @returns {Promise<Object>} Updated preferences\r\n   */ async updateNotificationPreferences(userId, preferences) {\n        try {\n            // Check if preferences already exist\n            const { data: existing } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notification_preferences\").select(\"id\").eq(\"user_id\", userId).maybeSingle();\n            let result;\n            if (existing) {\n                // Update existing preferences\n                const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notification_preferences\").update(preferences).eq(\"user_id\", userId).select().single();\n                if (error) throw error;\n                result = data;\n            } else {\n                // Create new preferences\n                const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"notification_preferences\").insert({\n                    user_id: userId,\n                    ...preferences\n                }).select().single();\n                if (error) throw error;\n                result = data;\n            }\n            return result;\n        } catch (error) {\n            console.error(\"Error updating notification preferences:\", error);\n            throw new Error(`Failed to update notification preferences: ${error.message}`);\n        }\n    }\n}\n// Create and export a singleton instance\nconst notificationService = new NotificationService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvc2VydmljZXMvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1zZXJ2aWNlLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsb0RBQW9EO0FBQ2E7QUFFakUsTUFBTUM7SUFDSjs7Ozs7Ozs7Ozs7O0dBWUMsR0FDRCxNQUFNQyxtQkFDSkMsTUFBTSxFQUNOQyxJQUFJLEVBQ0pDLEtBQUssRUFDTEMsT0FBTyxFQUNQQyxvQkFBb0IsSUFBSSxFQUN4QkMsa0JBQWtCLElBQUksRUFDdEJDLFdBQVcsUUFBUSxFQUNuQkMsTUFBTSxDQUFDLEVBQ1BDLHFCQUFxQixLQUFLLEVBQzFCO1FBQ0EsSUFBSTtZQUNGLHFCQUFxQjtZQUNyQixJQUFJLENBQUNSLFVBQVUsQ0FBRSxNQUFNLElBQUksQ0FBQ1MsZ0JBQWdCLENBQUNULFNBQVU7Z0JBQ3JEVSxRQUFRQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUVYLE9BQU8sdUNBQXVDLENBQUM7Z0JBQ3BFLE9BQU87WUFDVDtZQUVBLCtEQUErRDtZQUMvRCxJQUFJSyxtQkFBbUJELHFCQUFxQixDQUFDSSxvQkFBb0I7Z0JBQy9ELE1BQU1JLGVBQWUsTUFBTSxJQUFJLENBQUNDLGtCQUFrQixDQUFDVCxtQkFBbUJDO2dCQUN0RSxJQUFJLENBQUNPLGNBQWM7b0JBQ2pCRixRQUFRQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUVQLGtCQUFrQixDQUFDLEVBQUVDLGdCQUFnQix1Q0FBdUMsQ0FBQztvQkFDcEcsT0FBTztnQkFDVDtZQUNGO1lBRUEsOERBQThEO1lBQzlELElBQUksQ0FBQ0csc0JBQXNCSixxQkFBcUJDLGlCQUFpQjtnQkFDL0QsTUFBTVMsZUFBZSxNQUFNLElBQUksQ0FBQ0MsNkJBQTZCLENBQzNEZixRQUNBQyxNQUNBRyxtQkFDQUM7Z0JBR0YsSUFBSVMsY0FBYztvQkFDaEJKLFFBQVFNLEdBQUcsQ0FBQyxDQUFDLGlDQUFpQyxFQUFFZixLQUFLLEtBQUssRUFBRUcsa0JBQWtCLENBQUMsRUFBRUMsZ0JBQWdCLENBQUM7b0JBQ2xHLE9BQU87Z0JBQ1Q7WUFDRjtZQUVBLE1BQU1ZLGVBQWU7Z0JBQ25CQyxTQUFTbEI7Z0JBQ1RDO2dCQUNBQztnQkFDQUM7Z0JBQ0FnQixxQkFBcUJmO2dCQUNyQmdCLG1CQUFtQmY7Z0JBQ25CQztnQkFDQWUsU0FBUztnQkFDVEMsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO1lBQ3BDO1lBRUEsNkRBQTZEO1lBQzdELElBQUlDLGFBQWE7WUFDakIsTUFBTUMsYUFBYXBCLGFBQWEsU0FBUyxJQUFJO1lBRTdDLE1BQU9tQixjQUFjQyxXQUFZO2dCQUMvQixJQUFJO29CQUNGLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNL0IsMkVBQWFBLENBQ3hDZ0MsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUNiLGNBQ1BjLE1BQU0sR0FDTkMsTUFBTTtvQkFFVCxJQUFJSixPQUFPLE1BQU1BO29CQUNqQixPQUFPRDtnQkFDVCxFQUFFLE9BQU9NLGFBQWE7b0JBQ3BCUjtvQkFDQWYsUUFBUUMsSUFBSSxDQUFDLENBQUMsdUNBQXVDLEVBQUVjLFdBQVcsQ0FBQyxFQUFFQyxhQUFhLEVBQUUsRUFBRSxDQUFDLEVBQUVPO29CQUV6RixJQUFJUixjQUFjQyxZQUFZO3dCQUM1QixzQkFBc0I7d0JBQ3RCLE1BQU0sSUFBSVEsUUFBUUMsQ0FBQUEsSUFBS0MsV0FBV0QsR0FBR0UsS0FBS0MsR0FBRyxDQUFDLEdBQUdiLGNBQWM7b0JBQ2pFLE9BQU87d0JBQ0wsTUFBTVE7b0JBQ1I7Z0JBQ0Y7WUFDRjtRQUNGLEVBQUUsT0FBT0wsT0FBTztZQUNkbEIsUUFBUWtCLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLGdEQUFnRDtZQUNoRCxPQUFPO1FBQ1Q7SUFDRjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNbkIsaUJBQWlCVCxNQUFNLEVBQUU7UUFDN0IsSUFBSTtZQUNGLE1BQU0sRUFBRXVDLEtBQUssRUFBRVgsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUN6Q2dDLElBQUksQ0FBQyxpQkFDTEUsTUFBTSxDQUFDLE1BQU07Z0JBQUVRLE9BQU87Z0JBQVNDLE1BQU07WUFBSyxHQUMxQ0MsRUFBRSxDQUFDLE1BQU16QztZQUVaLElBQUk0QixPQUFPLE1BQU1BO1lBQ2pCLE9BQU9XLFFBQVE7UUFDakIsRUFBRSxPQUFPWCxPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLENBQUMscUJBQXFCLEVBQUU1QixPQUFPLENBQUMsQ0FBQyxFQUFFNEI7WUFDakQsMkVBQTJFO1lBQzNFLE9BQU87UUFDVDtJQUNGO0lBRUE7Ozs7Ozs7Ozs7R0FVQyxHQUNELE1BQU1jLDhCQUE4QixFQUNsQ0MsYUFBYSxFQUNiQyxVQUFVLEVBQ1ZDLFNBQVMsV0FBVyxFQUNwQkMsZUFBZSxJQUFJLEVBQ3BCLEVBQUU7UUFDRCxJQUFJO1lBQ0YseURBQXlEO1lBQ3pELE1BQU0sRUFBRW5CLE1BQU1vQixZQUFXLEVBQUVuQixPQUFPb0IsZ0JBQWdCLEVBQUUsR0FBRyxNQUFNbkQsMkVBQWFBLENBQ3ZFZ0MsSUFBSSxDQUFDLGdCQUNMRSxNQUFNLENBQUMsQ0FBQzs7Ozs7Ozs7OztRQVVULENBQUMsRUFDQVUsRUFBRSxDQUFDLE1BQU1FLGVBQ1RYLE1BQU07WUFFVCxJQUFJZ0Isb0JBQW9CLENBQUNELGNBQWE7Z0JBQ3BDckMsUUFBUWtCLEtBQUssQ0FBQyxnREFBZ0RvQjtnQkFDOUQsT0FBTyxFQUFFO1lBQ1g7WUFFQSxNQUFNQyxTQUFTLEVBQUU7WUFDakIsTUFBTUMsZUFBZUgsYUFBWUksUUFBUSxFQUFFQyxXQUFXQyx3QkFBd0JDLFFBQVE7WUFFdEYsNEJBQTRCO1lBQzVCLElBQUlQLGFBQVlRLFFBQVEsRUFBRTtnQkFDeEIsSUFBSUMsV0FBV0MsWUFBWUMsY0FBY0M7Z0JBRXpDLElBQUlkLFdBQVcsYUFBYTtvQkFDMUJXLFlBQVk7b0JBQ1pDLGFBQWEsQ0FBQyxNQUFNLEVBQUVQLGFBQWEscUJBQXFCLENBQUM7b0JBQ3pEUSxlQUFlLENBQUMsdUJBQXVCLEVBQUVSLGFBQWEsMEVBQTBFLENBQUM7b0JBQ2pJUyxnQkFBZ0I7Z0JBQ2xCLE9BQU8sSUFBSWQsV0FBVyxVQUFVO29CQUM5QlcsWUFBWTtvQkFDWkMsYUFBYSxDQUFDLGtCQUFrQixFQUFFUCxhQUFhLENBQUM7b0JBQ2hEUSxlQUFlLENBQUMsNkNBQTZDLEVBQUVSLGFBQWEsOEJBQThCLENBQUM7b0JBQzNHUyxnQkFBZ0I7Z0JBQ2xCLE9BQU87b0JBQ0xILFlBQVk7b0JBQ1pDLGFBQWEsQ0FBQyxvQkFBb0IsRUFBRVAsYUFBYSxDQUFDO29CQUNsRFEsZUFBZSxDQUFDLGtDQUFrQyxFQUFFUixhQUFhLHVCQUF1QixDQUFDO29CQUN6RlMsZ0JBQWdCO2dCQUNsQjtnQkFFQSxNQUFNQyxvQkFBb0IsTUFBTSxJQUFJLENBQUM3RCxrQkFBa0IsQ0FDckRnRCxhQUFZUSxRQUFRLEVBQ3BCQyxXQUNBQyxZQUNBQyxjQUNBLGVBQ0FmLGVBQ0FnQixlQUNBLEdBQ0EsS0FBSyx1QkFBdUI7O2dCQUc5QixJQUFJQyxtQkFBbUI7b0JBQ3JCWCxPQUFPWSxJQUFJLENBQUNEO2dCQUNkO1lBQ0Y7WUFFQSwwQ0FBMEM7WUFDMUMsSUFBSWQsZ0JBQWdCQyxhQUFZZSxTQUFTLElBQUlqQixXQUFXLGFBQWE7Z0JBQ25FLE1BQU1rQixxQkFBcUIsTUFBTSxJQUFJLENBQUNoRSxrQkFBa0IsQ0FDdERnRCxhQUFZZSxTQUFTLEVBQ3JCLGtCQUNBLGlDQUNBLENBQUMsV0FBVyxFQUFFZixhQUFZaUIsS0FBSyxFQUFFQyxnQkFBZ0IsT0FBTyw0Q0FBNEMsRUFBRWYsYUFBYSxDQUFDLENBQUMsRUFDckgsZUFDQVAsZUFDQSxVQUNBLEdBQ0EsS0FBSyx1QkFBdUI7O2dCQUc5QixJQUFJb0Isb0JBQW9CO29CQUN0QmQsT0FBT1ksSUFBSSxDQUFDRTtnQkFDZDtZQUNGO1lBRUEsT0FBT2Q7UUFDVCxFQUFFLE9BQU9yQixPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLDZDQUE2Q0E7WUFDM0Qsa0NBQWtDO1lBQ2xDLE1BQU1nQyxvQkFBb0IsTUFBTSxJQUFJLENBQUM3RCxrQkFBa0IsQ0FDckRnRCxhQUFhUSxVQUNiLG1CQUNBLHVCQUNBLHdDQUNBLG1CQUNBWDtZQUdGLE9BQU9nQixvQkFBb0I7Z0JBQUNBO2FBQWtCLEdBQUcsRUFBRTtRQUNyRDtJQUNGO0lBRUE7Ozs7Ozs7Ozs7R0FVQyxHQUNELE1BQU1NLDJCQUEyQixFQUMvQkMsU0FBUyxFQUNUQyxVQUFVLEVBQ1ZDLFVBQVUsRUFDVnBFLE9BQU8sUUFBUSxFQUNoQixFQUFFO1FBQ0QsSUFBSTtZQUNGLHNCQUFzQjtZQUN0QixNQUFNLEVBQUUwQixNQUFNMkMsT0FBTyxFQUFFMUMsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUNqRGdDLElBQUksQ0FBQyxZQUNMRSxNQUFNLENBQUMsS0FDUFUsRUFBRSxDQUFDLE1BQU0wQixXQUNUbkMsTUFBTTtZQUVULElBQUlKLFNBQVMsQ0FBQzBDLFNBQVM7Z0JBQ3JCNUQsUUFBUWtCLEtBQUssQ0FBQyw0Q0FBNENBO2dCQUMxRCxPQUFPLEVBQUU7WUFDWDtZQUVBLE1BQU1xQixTQUFTLEVBQUU7WUFFakIsK0JBQStCO1lBQy9CLE1BQU1zQix1QkFBdUIsTUFBTSxJQUFJLENBQUN4RSxrQkFBa0IsQ0FDeERxRSxZQUNBLG1CQUNBLDhDQUNBLENBQUMsNEJBQTRCLEVBQUVuRSxTQUFTLFdBQVcsYUFBYSxTQUFTLDBEQUEwRCxDQUFDLEVBQ3BJLFdBQ0FrRSxXQUNBLFVBQ0EsR0FDQSxLQUFLLHVCQUF1Qjs7WUFHOUIsSUFBSUksc0JBQXNCO2dCQUN4QnRCLE9BQU9ZLElBQUksQ0FBQ1U7WUFDZDtZQUVBLG9DQUFvQztZQUNwQyxJQUFJRixZQUFZO2dCQUNkLE1BQU1HLHVCQUF1QixNQUFNLElBQUksQ0FBQ3pFLGtCQUFrQixDQUN4RHNFLFlBQ0EsaUJBQ0Esb0NBQ0EsQ0FBQywyQkFBMkIsRUFBRXBFLFNBQVMsV0FBVyw0QkFBNEIsU0FBUyw4QkFBOEIsQ0FBQyxFQUN0SCxXQUNBa0UsV0FDQSxRQUNBLEdBQ0EsS0FBSyx1QkFBdUI7O2dCQUc5QixJQUFJSyxzQkFBc0I7b0JBQ3hCdkIsT0FBT1ksSUFBSSxDQUFDVztnQkFDZDtZQUNGO1lBRUEsT0FBT3ZCO1FBQ1QsRUFBRSxPQUFPckIsT0FBTztZQUNkbEIsUUFBUWtCLEtBQUssQ0FBQyx5Q0FBeUNBO1lBQ3ZELE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFQTs7Ozs7Ozs7R0FRQyxHQUNELE1BQU1iLDhCQUE4QmYsTUFBTSxFQUFFQyxJQUFJLEVBQUV3RSxVQUFVLEVBQUVDLFFBQVEsRUFBRTtRQUN0RSxJQUFJO1lBQ0YsbURBQW1EO1lBQ25ELE1BQU1DLGFBQWEsSUFBSXBEO1lBQ3ZCb0QsV0FBV0MsUUFBUSxDQUFDRCxXQUFXRSxRQUFRLEtBQUs7WUFFNUMsTUFBTSxFQUFFdEMsS0FBSyxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNL0IsMkVBQWFBLENBQ3pDZ0MsSUFBSSxDQUFDLGlCQUNMRSxNQUFNLENBQUMsS0FBSztnQkFBRVEsT0FBTztnQkFBU0MsTUFBTTtZQUFLLEdBQ3pDQyxFQUFFLENBQUMsV0FBV3pDLFFBQ2R5QyxFQUFFLENBQUMsUUFBUXhDLE1BQ1h3QyxFQUFFLENBQUMsdUJBQXVCZ0MsWUFDMUJoQyxFQUFFLENBQUMscUJBQXFCaUMsVUFDeEJJLEdBQUcsQ0FBQyxjQUFjSCxXQUFXbkQsV0FBVztZQUUzQyxJQUFJSSxPQUFPLE1BQU1BO1lBRWpCLE9BQU9XLFFBQVE7UUFDakIsRUFBRSxPQUFPWCxPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLCtDQUErQ0E7WUFDN0QscUVBQXFFO1lBQ3JFLE9BQU87UUFDVDtJQUNGO0lBRUE7Ozs7O0dBS0MsR0FDRCxNQUFNZixtQkFBbUI0RCxVQUFVLEVBQUVDLFFBQVEsRUFBRTtRQUM3QyxJQUFJO1lBQ0YsSUFBSUs7WUFDSixPQUFRTjtnQkFDTixLQUFLO29CQUNITSxRQUFRO29CQUNSO2dCQUNGLEtBQUs7Z0JBQ0wsS0FBSztvQkFDSEEsUUFBUTtvQkFDUjtnQkFDRixLQUFLO29CQUNIQSxRQUFRO29CQUNSO2dCQUNGLEtBQUs7b0JBQ0hBLFFBQVE7b0JBQ1I7Z0JBQ0YsS0FBSztvQkFDSEEsUUFBUTtvQkFDUjtnQkFDRixLQUFLO29CQUNIQSxRQUFRO29CQUNSO2dCQUNGLEtBQUs7b0JBQ0hBLFFBQVE7b0JBQ1I7Z0JBQ0Y7b0JBQ0VyRSxRQUFRQyxJQUFJLENBQUMsQ0FBQyxxQkFBcUIsRUFBRThELFdBQVcsQ0FBQztvQkFDakQsT0FBTztZQUNYO1lBRUEsTUFBTSxFQUFFbEMsS0FBSyxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNL0IsMkVBQWFBLENBQ3pDZ0MsSUFBSSxDQUFDa0QsT0FDTGhELE1BQU0sQ0FBQyxNQUFNO2dCQUFFUSxPQUFPO2dCQUFTQyxNQUFNO1lBQUssR0FDMUNDLEVBQUUsQ0FBQyxNQUFNaUM7WUFFWixJQUFJOUMsT0FBTyxNQUFNQTtZQUVqQixPQUFPVyxRQUFRO1FBQ2pCLEVBQUUsT0FBT1gsT0FBTztZQUNkbEIsUUFBUWtCLEtBQUssQ0FBQyxDQUFDLHVCQUF1QixFQUFFNkMsV0FBVyxDQUFDLEVBQUVDLFNBQVMsQ0FBQyxDQUFDLEVBQUU5QztZQUNuRSw2RUFBNkU7WUFDN0UsT0FBTztRQUNUO0lBQ0Y7SUFFQTs7Ozs7Ozs7O0dBU0MsR0FDRCxNQUFNb0Qsd0JBQXdCQyxPQUFPLEVBQUVoRixJQUFJLEVBQUVDLEtBQUssRUFBRUMsT0FBTyxFQUFFQyxvQkFBb0IsSUFBSSxFQUFFQyxrQkFBa0IsSUFBSSxFQUFFO1FBQzdHLElBQUksQ0FBQzRFLFdBQVcsQ0FBQ0MsTUFBTUMsT0FBTyxDQUFDRixZQUFZQSxRQUFRRyxNQUFNLEtBQUssR0FBRztZQUMvRCxPQUFPLEVBQUU7UUFDWDtRQUVBLElBQUk7WUFDRix1QkFBdUI7WUFDdkIsSUFBSWhGLHFCQUFxQkMsaUJBQWlCO2dCQUN4QyxNQUFNTyxlQUFlLE1BQU0sSUFBSSxDQUFDQyxrQkFBa0IsQ0FBQ1QsbUJBQW1CQztnQkFDdEUsSUFBSSxDQUFDTyxjQUFjO29CQUNqQkYsUUFBUUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFUCxrQkFBa0IsQ0FBQyxFQUFFQyxnQkFBZ0IsNkNBQTZDLENBQUM7b0JBQzFHLE9BQU8sRUFBRTtnQkFDWDtZQUNGO1lBRUEsNENBQTRDO1lBQzVDLE1BQU1nRixnQkFBZ0JKLFFBQVFLLEdBQUcsQ0FBQ3RGLENBQUFBLFNBQVc7b0JBQzNDa0IsU0FBU2xCO29CQUNUQztvQkFDQUM7b0JBQ0FDO29CQUNBZ0IscUJBQXFCZjtvQkFDckJnQixtQkFBbUJmO29CQUNuQmdCLFNBQVM7b0JBQ1RDLFlBQVksSUFBSUMsT0FBT0MsV0FBVztnQkFDcEM7WUFFQSxNQUFNLEVBQUVHLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUN4Q2dDLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDdUQsZUFDUHRELE1BQU07WUFFVCxJQUFJSCxPQUFPLE1BQU1BO1lBRWpCLE9BQU9ELFFBQVEsRUFBRTtRQUNuQixFQUFFLE9BQU9DLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsc0NBQXNDQTtZQUNwRCxnREFBZ0Q7WUFDaEQsT0FBTyxFQUFFO1FBQ1g7SUFDRjtJQUVBOzs7Ozs7O0dBT0MsR0FDRCxNQUFNYyw4QkFBOEIxQyxNQUFNLEVBQUUyQyxhQUFhLEVBQUVDLFVBQVUsRUFBRUMsU0FBUyxXQUFXLEVBQUU7UUFDM0YsSUFBSTtZQUNGLDBCQUEwQjtZQUMxQixNQUFNLEVBQUVsQixNQUFNb0IsWUFBVyxFQUFFbkIsT0FBT29CLGdCQUFnQixFQUFFLEdBQUcsTUFBTW5ELDJFQUFhQSxDQUN2RWdDLElBQUksQ0FBQyxnQkFDTEUsTUFBTSxDQUFDLENBQUM7Ozs7Ozs7O1FBUVQsQ0FBQyxFQUNBVSxFQUFFLENBQUMsTUFBTUUsZUFDVFgsTUFBTTtZQUVULElBQUlnQixvQkFBb0IsQ0FBQ0QsY0FBYTtnQkFDcENyQyxRQUFRa0IsS0FBSyxDQUFDLGdEQUFnRG9CO2dCQUM5RCxPQUFPO1lBQ1Q7WUFFQSxpREFBaUQ7WUFDakQsSUFBSTlDLE9BQU9DLFNBQVNGO1lBQ3BCLE1BQU1pRCxlQUFlSCxhQUFZSSxRQUFRLEVBQUVDLFdBQVdDLHdCQUF3QkMsUUFBUTtZQUV0RixJQUFJVCxXQUFXLGFBQWE7Z0JBQzFCNUMsT0FBTztnQkFDUEMsUUFBUSxDQUFDLE1BQU0sRUFBRWdELGFBQWEscUJBQXFCLENBQUM7Z0JBQ3BEL0MsVUFBVSxDQUFDLHVCQUF1QixFQUFFK0MsYUFBYSwwRUFBMEUsQ0FBQztZQUM5SCxPQUFPLElBQUlMLFdBQVcsVUFBVTtnQkFDOUI1QyxPQUFPO2dCQUNQQyxRQUFRLENBQUMsa0JBQWtCLEVBQUVnRCxhQUFhLENBQUM7Z0JBQzNDL0MsVUFBVSxDQUFDLDZDQUE2QyxFQUFFK0MsYUFBYSw4QkFBOEIsQ0FBQztZQUN4RyxPQUFPO2dCQUNMakQsT0FBTztnQkFDUEMsUUFBUSxDQUFDLG9CQUFvQixFQUFFZ0QsYUFBYSxDQUFDO2dCQUM3Qy9DLFVBQVUsQ0FBQyxrQ0FBa0MsRUFBRStDLGFBQWEsdUJBQXVCLENBQUM7WUFDdEY7WUFFQSw2REFBNkQ7WUFDN0QsT0FBTyxJQUFJLENBQUNuRCxrQkFBa0IsQ0FDNUJDLFFBQ0FDLE1BQ0FDLE9BQ0FDLFNBQ0EsZUFDQXdDLGVBQ0FFLFdBQVcsV0FBVyxTQUFTLFVBQy9CLEdBQ0EsS0FBSywyREFBMkQ7O1FBRXBFLEVBQUUsT0FBT2pCLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsNENBQTRDQTtZQUMxRCxrQ0FBa0M7WUFDbEMsT0FBTyxJQUFJLENBQUM3QixrQkFBa0IsQ0FDNUJDLFFBQ0EsWUFDQSx1QkFDQSx3Q0FDQSxtQkFDQTRDO1FBRUo7SUFDRjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNMkMsZUFBZXZGLE1BQU0sRUFBRTtRQUMzQixJQUFJO1lBQ0YsTUFBTSxFQUFFdUMsS0FBSyxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNL0IsMkVBQWFBLENBQ3pDZ0MsSUFBSSxDQUFDLGlCQUNMRSxNQUFNLENBQUMsS0FBSztnQkFBRVEsT0FBTztnQkFBU0MsTUFBTTtZQUFLLEdBQ3pDQyxFQUFFLENBQUMsV0FBV3pDLFFBQ2R5QyxFQUFFLENBQUMsV0FBVztZQUVqQixJQUFJYixPQUFPLE1BQU1BO1lBRWpCLE9BQU9XLFNBQVM7UUFDbEIsRUFBRSxPQUFPWCxPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLHdDQUF3Q0E7WUFDdEQsT0FBTztRQUNUO0lBQ0Y7SUFFQTs7Ozs7R0FLQyxHQUNELE1BQU00RCxXQUFXQyxlQUFlLEVBQUV6RixNQUFNLEVBQUU7UUFDeEMsSUFBSTtZQUNGLHVDQUF1QztZQUN2QyxNQUFNMEYsTUFBTVIsTUFBTUMsT0FBTyxDQUFDTSxtQkFBbUJBLGtCQUFrQjtnQkFBQ0E7YUFBZ0I7WUFFaEYsTUFBTSxFQUFFN0QsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUNsQ2dDLElBQUksQ0FBQyxpQkFDTDhELE1BQU0sQ0FBQztnQkFDTnRFLFNBQVM7WUFDWCxHQUNDdUUsRUFBRSxDQUFDLE1BQU1GLEtBQ1RqRCxFQUFFLENBQUMsV0FBV3pDO1lBRWpCLElBQUk0QixPQUFPLE1BQU1BO1lBRWpCLE9BQU87UUFDVCxFQUFFLE9BQU9BLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsd0NBQXdDQTtZQUN0RCxPQUFPO1FBQ1Q7SUFDRjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNaUUsY0FBYzdGLE1BQU0sRUFBRTtRQUMxQixJQUFJO1lBQ0YsTUFBTSxFQUFFNEIsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUNsQ2dDLElBQUksQ0FBQyxpQkFDTDhELE1BQU0sQ0FBQztnQkFDTnRFLFNBQVM7WUFDWCxHQUNDb0IsRUFBRSxDQUFDLFdBQVd6QyxRQUNkeUMsRUFBRSxDQUFDLFdBQVc7WUFFakIsSUFBSWIsT0FBTyxNQUFNQTtZQUVqQixPQUFPO1FBQ1QsRUFBRSxPQUFPQSxPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLDRDQUE0Q0E7WUFDMUQsT0FBTztRQUNUO0lBQ0Y7SUFFQTs7Ozs7R0FLQyxHQUNELE1BQU1rRSxtQkFBbUJDLGNBQWMsRUFBRS9GLE1BQU0sRUFBRTtRQUMvQyxJQUFJO1lBQ0YsTUFBTSxFQUFFNEIsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUNsQ2dDLElBQUksQ0FBQyxpQkFDTG1FLE1BQU0sR0FDTnZELEVBQUUsQ0FBQyxNQUFNc0QsZ0JBQ1R0RCxFQUFFLENBQUMsV0FBV3pDO1lBRWpCLElBQUk0QixPQUFPLE1BQU1BO1lBRWpCLE9BQU87UUFDVCxFQUFFLE9BQU9BLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsZ0NBQWdDQTtZQUM5QyxPQUFPO1FBQ1Q7SUFDRjtJQUVBOzs7OztHQUtDLEdBQ0QsTUFBTXFFLHFCQUFxQmpHLE1BQU0sRUFBRWtHLFVBQVUsQ0FBQyxDQUFDLEVBQUU7UUFDL0MsSUFBSTtZQUNGLGtCQUFrQjtZQUNsQixJQUFJQyxRQUFRdEcsMkVBQWFBLENBQ3RCZ0MsSUFBSSxDQUFDLGlCQUNMRSxNQUFNLENBQUMsS0FBSztnQkFBRVEsT0FBTztZQUFRLEdBQzdCRSxFQUFFLENBQUMsV0FBV3pDO1lBRWpCLGdCQUFnQjtZQUNoQixJQUFJa0csUUFBUWpHLElBQUksRUFBRTtnQkFDaEJrRyxRQUFRQSxNQUFNMUQsRUFBRSxDQUFDLFFBQVF5RCxRQUFRakcsSUFBSTtZQUN2QztZQUVBLElBQUlpRyxRQUFRRSxJQUFJLEtBQUssUUFBUUYsUUFBUUUsSUFBSSxLQUFLQyxXQUFXO2dCQUN2REYsUUFBUUEsTUFBTTFELEVBQUUsQ0FBQyxXQUFXeUQsUUFBUUUsSUFBSTtZQUMxQztZQUVBLElBQUlGLFFBQVE1RixRQUFRLEVBQUU7Z0JBQ3BCNkYsUUFBUUEsTUFBTTFELEVBQUUsQ0FBQyxZQUFZeUQsUUFBUTVGLFFBQVE7WUFDL0M7WUFFQSxJQUFJNEYsUUFBUTlGLGlCQUFpQixFQUFFO2dCQUM3QitGLFFBQVFBLE1BQU0xRCxFQUFFLENBQUMsdUJBQXVCeUQsUUFBUTlGLGlCQUFpQjtZQUNuRTtZQUVBLElBQUk4RixRQUFRN0YsZUFBZSxFQUFFO2dCQUMzQjhGLFFBQVFBLE1BQU0xRCxFQUFFLENBQUMscUJBQXFCeUQsUUFBUTdGLGVBQWU7WUFDL0Q7WUFFQSx1Q0FBdUM7WUFDdkM4RixRQUFRQSxNQUFNRyxLQUFLLENBQUMsY0FBYztnQkFBRUMsV0FBVztZQUFNO1lBRXJELG1CQUFtQjtZQUNuQixNQUFNQyxPQUFPTixRQUFRTSxJQUFJLElBQUk7WUFDN0IsTUFBTUMsV0FBV1AsUUFBUU8sUUFBUSxJQUFJO1lBQ3JDLE1BQU1DLFFBQVEsQ0FBQ0YsT0FBTyxLQUFLQztZQUMzQixNQUFNRSxNQUFNRCxRQUFRRCxXQUFXO1lBRS9CTixRQUFRQSxNQUFNUyxLQUFLLENBQUNGLE9BQU9DO1lBRTNCLG9CQUFvQjtZQUNwQixNQUFNLEVBQUVoRixJQUFJLEVBQUVDLEtBQUssRUFBRVcsS0FBSyxFQUFFLEdBQUcsTUFBTTREO1lBRXJDLElBQUl2RSxPQUFPLE1BQU1BO1lBRWpCLDRCQUE0QjtZQUM1QixNQUFNaUYsYUFBYXhFLEtBQUt5RSxJQUFJLENBQUMsQ0FBQ3ZFLFNBQVMsS0FBS2tFO1lBRTVDLE9BQU87Z0JBQ0xwQixlQUFlMUQsUUFBUSxFQUFFO2dCQUN6Qm9GLFlBQVk7b0JBQ1ZQO29CQUNBQztvQkFDQU8sT0FBT3pFLFNBQVM7b0JBQ2hCc0U7Z0JBQ0Y7WUFDRjtRQUNGLEVBQUUsT0FBT2pGLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsc0NBQXNDQTtZQUNwRCxNQUFNLElBQUlxRixNQUFNLENBQUMsK0JBQStCLEVBQUVyRixNQUFNc0YsT0FBTyxDQUFDLENBQUM7UUFDbkU7SUFDRjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNQywyQkFBMkJuSCxNQUFNLEVBQUU7UUFDdkMsSUFBSTtZQUNGLE1BQU0sRUFBRTJCLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUN4Q2dDLElBQUksQ0FBQyw0QkFDTEUsTUFBTSxDQUFDLEtBQ1BVLEVBQUUsQ0FBQyxXQUFXekMsUUFDZG9ILFdBQVc7WUFFZCxJQUFJeEYsT0FBTyxNQUFNQTtZQUVqQiwyQ0FBMkM7WUFDM0MsSUFBSSxDQUFDRCxNQUFNO2dCQUNULE9BQU87b0JBQ0xULFNBQVNsQjtvQkFDVHFILGVBQWU7b0JBQ2ZDLGNBQWM7b0JBQ2RDLGtCQUFrQjtvQkFDbEJDLG1CQUFtQjtvQkFDbkJDLG9CQUFvQjtvQkFDcEJDLG1CQUFtQjtvQkFDbkJDLGNBQWM7Z0JBQ2hCO1lBQ0Y7WUFFQSxPQUFPaEc7UUFDVCxFQUFFLE9BQU9DLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsNENBQTRDQTtZQUMxRCwyQkFBMkI7WUFDM0IsT0FBTztnQkFDTFYsU0FBU2xCO2dCQUNUcUgsZUFBZTtnQkFDZkMsY0FBYztnQkFDZEMsa0JBQWtCO2dCQUNsQkMsbUJBQW1CO2dCQUNuQkMsb0JBQW9CO2dCQUNwQkMsbUJBQW1CO2dCQUNuQkMsY0FBYztZQUNoQjtRQUNGO0lBQ0Y7SUFFQTs7Ozs7R0FLQyxHQUNELE1BQU1DLDhCQUE4QjVILE1BQU0sRUFBRTZILFdBQVcsRUFBRTtRQUN2RCxJQUFJO1lBQ0YscUNBQXFDO1lBQ3JDLE1BQU0sRUFBRWxHLE1BQU1tRyxRQUFRLEVBQUUsR0FBRyxNQUFNakksMkVBQWFBLENBQzNDZ0MsSUFBSSxDQUFDLDRCQUNMRSxNQUFNLENBQUMsTUFDUFUsRUFBRSxDQUFDLFdBQVd6QyxRQUNkb0gsV0FBVztZQUVkLElBQUluRTtZQUVKLElBQUk2RSxVQUFVO2dCQUNaLDhCQUE4QjtnQkFDOUIsTUFBTSxFQUFFbkcsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNL0IsMkVBQWFBLENBQ3hDZ0MsSUFBSSxDQUFDLDRCQUNMOEQsTUFBTSxDQUFDa0MsYUFDUHBGLEVBQUUsQ0FBQyxXQUFXekMsUUFDZCtCLE1BQU0sR0FDTkMsTUFBTTtnQkFFVCxJQUFJSixPQUFPLE1BQU1BO2dCQUNqQnFCLFNBQVN0QjtZQUNYLE9BQU87Z0JBQ0wseUJBQXlCO2dCQUN6QixNQUFNLEVBQUVBLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTS9CLDJFQUFhQSxDQUN4Q2dDLElBQUksQ0FBQyw0QkFDTEMsTUFBTSxDQUFDO29CQUNOWixTQUFTbEI7b0JBQ1QsR0FBRzZILFdBQVc7Z0JBQ2hCLEdBQ0M5RixNQUFNLEdBQ05DLE1BQU07Z0JBRVQsSUFBSUosT0FBTyxNQUFNQTtnQkFDakJxQixTQUFTdEI7WUFDWDtZQUVBLE9BQU9zQjtRQUNULEVBQUUsT0FBT3JCLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsNENBQTRDQTtZQUMxRCxNQUFNLElBQUlxRixNQUFNLENBQUMsMkNBQTJDLEVBQUVyRixNQUFNc0YsT0FBTyxDQUFDLENBQUM7UUFDL0U7SUFDRjtBQUNGO0FBRUEseUNBQXlDO0FBQ2xDLE1BQU1hLHNCQUFzQixJQUFJakksc0JBQXNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL3NlcnZpY2VzL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24tc2VydmljZS5qcz9iMjk3Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9zZXJ2aWNlcy9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLXNlcnZpY2UuanNcclxuaW1wb3J0IHN1cGFiYXNlQWRtaW4gZnJvbSAnQC9saWIvZGF0YWJhc2Uvc3VwYWJhc2UtYWRtaW4tY2xpZW50JztcclxuXHJcbmNsYXNzIE5vdGlmaWNhdGlvblNlcnZpY2Uge1xyXG4gIC8qKlxyXG4gICAqIENyZWF0ZXMgYSBuZXcgbm90aWZpY2F0aW9uIHdpdGggZHVwbGljYXRpb24gY2hlY2tcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gSUQgb2YgdGhlIHVzZXIgdG8gbm90aWZ5XHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUeXBlIG9mIG5vdGlmaWNhdGlvbiAoaW52aXRlLCBtZXNzYWdlLCBwdXJjaGFzZSwgZGlzcHV0ZSlcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdGl0bGUgLSBUaXRsZSBvZiB0aGUgbm90aWZpY2F0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnRlbnQgLSBDb250ZW50IG9mIHRoZSBub3RpZmljYXRpb25cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRlZEVudGl0eVR5cGUgLSBUeXBlIG9mIHJlbGF0ZWQgZW50aXR5IChvcHRpb25hbClcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRlZEVudGl0eUlkIC0gSUQgb2YgcmVsYXRlZCBlbnRpdHkgKG9wdGlvbmFsKVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwcmlvcml0eSAtIFByaW9yaXR5IChoaWdoLCBub3JtYWwsIGxvdykgKG9wdGlvbmFsKVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0dGwgLSBUaW1lIHRvIGxpdmUgaW4gZGF5cyAoMCA9IG5vIGV4cGlyYXRpb24pIChvcHRpb25hbClcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNraXBEdXBsaWNhdGVDaGVjayAtIFdoZXRoZXIgdG8gc2tpcCBkdXBsaWNhdGUgY2hlY2sgKG9wdGlvbmFsKVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IENyZWF0ZWQgbm90aWZpY2F0aW9uXHJcbiAgICovXHJcbiAgYXN5bmMgY3JlYXRlTm90aWZpY2F0aW9uKFxyXG4gICAgdXNlcklkLFxyXG4gICAgdHlwZSxcclxuICAgIHRpdGxlLFxyXG4gICAgY29udGVudCxcclxuICAgIHJlbGF0ZWRFbnRpdHlUeXBlID0gbnVsbCxcclxuICAgIHJlbGF0ZWRFbnRpdHlJZCA9IG51bGwsXHJcbiAgICBwcmlvcml0eSA9ICdub3JtYWwnLFxyXG4gICAgdHRsID0gMCxcclxuICAgIHNraXBEdXBsaWNhdGVDaGVjayA9IGZhbHNlXHJcbiAgKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBWZXJpZnkgdXNlciBleGlzdHNcclxuICAgICAgaWYgKCF1c2VySWQgfHwgIShhd2FpdCB0aGlzLnZlcmlmeVVzZXJFeGlzdHModXNlcklkKSkpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oYFVzZXIgJHt1c2VySWR9IGRvZXMgbm90IGV4aXN0LiBTa2lwcGluZyBub3RpZmljYXRpb24uYCk7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFZlcmlmeSBlbnRpdHkgZXhpc3RzIGlmIGVudGl0eUlkIGFuZCBlbnRpdHlUeXBlIGFyZSBwcm92aWRlZFxyXG4gICAgICBpZiAocmVsYXRlZEVudGl0eUlkICYmIHJlbGF0ZWRFbnRpdHlUeXBlICYmICFza2lwRHVwbGljYXRlQ2hlY2spIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlFeGlzdHMgPSBhd2FpdCB0aGlzLnZlcmlmeUVudGl0eUV4aXN0cyhyZWxhdGVkRW50aXR5VHlwZSwgcmVsYXRlZEVudGl0eUlkKTtcclxuICAgICAgICBpZiAoIWVudGl0eUV4aXN0cykge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKGBFbnRpdHkgJHtyZWxhdGVkRW50aXR5VHlwZX06JHtyZWxhdGVkRW50aXR5SWR9IGRvZXMgbm90IGV4aXN0LiBTa2lwcGluZyBub3RpZmljYXRpb24uYCk7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENoZWNrIGZvciBzaW1pbGFyIHJlY2VudCBub3RpZmljYXRpb25zIHRvIGF2b2lkIGR1cGxpY2F0aW9uXHJcbiAgICAgIGlmICghc2tpcER1cGxpY2F0ZUNoZWNrICYmIHJlbGF0ZWRFbnRpdHlUeXBlICYmIHJlbGF0ZWRFbnRpdHlJZCkge1xyXG4gICAgICAgIGNvbnN0IGhhc0R1cGxpY2F0ZSA9IGF3YWl0IHRoaXMuY2hlY2tGb3JEdXBsaWNhdGVOb3RpZmljYXRpb24oXHJcbiAgICAgICAgICB1c2VySWQsIFxyXG4gICAgICAgICAgdHlwZSwgXHJcbiAgICAgICAgICByZWxhdGVkRW50aXR5VHlwZSwgXHJcbiAgICAgICAgICByZWxhdGVkRW50aXR5SWRcclxuICAgICAgICApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChoYXNEdXBsaWNhdGUpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBTa2lwcGluZyBkdXBsaWNhdGUgbm90aWZpY2F0aW9uOiAke3R5cGV9IGZvciAke3JlbGF0ZWRFbnRpdHlUeXBlfToke3JlbGF0ZWRFbnRpdHlJZH1gKTtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0ge1xyXG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcclxuICAgICAgICB0eXBlLFxyXG4gICAgICAgIHRpdGxlLFxyXG4gICAgICAgIGNvbnRlbnQsXHJcbiAgICAgICAgcmVsYXRlZF9lbnRpdHlfdHlwZTogcmVsYXRlZEVudGl0eVR5cGUsXHJcbiAgICAgICAgcmVsYXRlZF9lbnRpdHlfaWQ6IHJlbGF0ZWRFbnRpdHlJZCxcclxuICAgICAgICBwcmlvcml0eSxcclxuICAgICAgICBpc19yZWFkOiBmYWxzZSxcclxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBUcnkgaW5zZXJ0aW9uIHdpdGggcmV0cnkgbG9naWMgZm9yIGltcG9ydGFudCBub3RpZmljYXRpb25zXHJcbiAgICAgIGxldCByZXRyeUNvdW50ID0gMDtcclxuICAgICAgY29uc3QgbWF4UmV0cmllcyA9IHByaW9yaXR5ID09PSAnaGlnaCcgPyAzIDogMTtcclxuICAgICAgXHJcbiAgICAgIHdoaWxlIChyZXRyeUNvdW50IDw9IG1heFJldHJpZXMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgICAuZnJvbSgnbm90aWZpY2F0aW9ucycpXHJcbiAgICAgICAgICAgIC5pbnNlcnQobm90aWZpY2F0aW9uKVxyXG4gICAgICAgICAgICAuc2VsZWN0KClcclxuICAgICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICB9IGNhdGNoIChpbnNlcnRFcnJvcikge1xyXG4gICAgICAgICAgcmV0cnlDb3VudCsrO1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKGBOb3RpZmljYXRpb24gaW5zZXJ0aW9uIGZhaWxlZCAoYXR0ZW1wdCAke3JldHJ5Q291bnR9LyR7bWF4UmV0cmllcyArIDF9KTpgLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmIChyZXRyeUNvdW50IDw9IG1heFJldHJpZXMpIHtcclxuICAgICAgICAgICAgLy8gRXhwb25lbnRpYWwgYmFja29mZlxyXG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgTWF0aC5wb3coMiwgcmV0cnlDb3VudCkgKiAxMDApKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IGluc2VydEVycm9yO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgbm90aWZpY2F0aW9uOicsIGVycm9yKTtcclxuICAgICAgLy8gRG9uJ3QgdGhyb3cgLSBmYWlsIHNpbGVudGx5IGZvciBub3RpZmljYXRpb25zXHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IGlmIGEgdXNlciBleGlzdHNcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gVXNlciBJRFxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBXaGV0aGVyIHRoZSB1c2VyIGV4aXN0c1xyXG4gICAqL1xyXG4gIGFzeW5jIHZlcmlmeVVzZXJFeGlzdHModXNlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGNvdW50LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgICAuc2VsZWN0KCdpZCcsIHsgY291bnQ6ICdleGFjdCcsIGhlYWQ6IHRydWUgfSlcclxuICAgICAgICAuZXEoJ2lkJywgdXNlcklkKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICAgIHJldHVybiBjb3VudCA+IDA7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciB2ZXJpZnlpbmcgdXNlciAke3VzZXJJZH06YCwgZXJyb3IpO1xyXG4gICAgICAvLyBBc3N1bWUgdXNlciBleGlzdHMgaWYgdmVyaWZpY2F0aW9uIGZhaWxzIHRvIGVuc3VyZSBub3RpZmljYXRpb24gZGVsaXZlcnlcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgY29uc29saWRhdGVkIG5vdGlmaWNhdGlvbnMgZm9yIGEgdHJhbnNhY3Rpb25cclxuICAgKiBTZW5kcyBub3RpZmljYXRpb25zIHRvIGFsbCBpbnZvbHZlZCBwYXJ0aWVzIChidXllciwgc2VsbGVyKVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVHJhbnNhY3Rpb24gbm90aWZpY2F0aW9uIG9wdGlvbnNcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy50cmFuc2FjdGlvbklkIC0gVHJhbnNhY3Rpb24gSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5wdXJjaGFzZUlkIC0gUHVyY2hhc2UgSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5zdGF0dXMgLSBUcmFuc2FjdGlvbiBzdGF0dXNcclxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMuc2VuZFRvU2VsbGVyIC0gV2hldGhlciB0byBzZW5kIG5vdGlmaWNhdGlvbiB0byBzZWxsZXJcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3RbXT59IENyZWF0ZWQgbm90aWZpY2F0aW9uc1xyXG4gICAqL1xyXG4gIGFzeW5jIGNyZWF0ZVRyYW5zYWN0aW9uTm90aWZpY2F0aW9uKHtcclxuICAgIHRyYW5zYWN0aW9uSWQsIFxyXG4gICAgcHVyY2hhc2VJZCwgXHJcbiAgICBzdGF0dXMgPSAnY29tcGxldGVkJyxcclxuICAgIHNlbmRUb1NlbGxlciA9IHRydWVcclxuICB9KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBHZXQgY29tcGxldGUgdHJhbnNhY3Rpb24gZGV0YWlscyB3aXRoIHJlbGF0ZWQgZW50aXRpZXNcclxuICAgICAgY29uc3QgeyBkYXRhOiB0cmFuc2FjdGlvbiwgZXJyb3I6IHRyYW5zYWN0aW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgndHJhbnNhY3Rpb25zJylcclxuICAgICAgICAuc2VsZWN0KGBcclxuICAgICAgICAgICosXHJcbiAgICAgICAgICBidXllcjpidXllcl9pZChpZCwgZGlzcGxheV9uYW1lKSxcclxuICAgICAgICAgIHNlbGxlcjpzZWxsZXJfaWQoaWQsIGRpc3BsYXlfbmFtZSksXHJcbiAgICAgICAgICBwdXJjaGFzZTpwdXJjaGFzZV9yZWNvcmRzIXB1cmNoYXNlX3JlY29yZF9pZChcclxuICAgICAgICAgICAgZ3JvdXBfc3ViX2lkLFxyXG4gICAgICAgICAgICBncm91cF9zdWI6Z3JvdXBfc3VicyhcclxuICAgICAgICAgICAgICBzdWJzY3JpcHRpb25fcGxhdGZvcm1zKG5hbWUpXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICBgKVxyXG4gICAgICAgIC5lcSgnaWQnLCB0cmFuc2FjdGlvbklkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgXHJcbiAgICAgIGlmICh0cmFuc2FjdGlvbkVycm9yIHx8ICF0cmFuc2FjdGlvbikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHRyYW5zYWN0aW9uIGZvciBub3RpZmljYXRpb246JywgdHJhbnNhY3Rpb25FcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgICAgY29uc3QgcGxhdGZvcm1OYW1lID0gdHJhbnNhY3Rpb24ucHVyY2hhc2U/Lmdyb3VwX3N1Yj8uc3Vic2NyaXB0aW9uX3BsYXRmb3Jtcz8ubmFtZSB8fCAnc3Vic2tyeXBjamknO1xyXG4gICAgICBcclxuICAgICAgLy8gMS4gTm90aWZpY2F0aW9uIGZvciBidXllclxyXG4gICAgICBpZiAodHJhbnNhY3Rpb24uYnV5ZXJfaWQpIHtcclxuICAgICAgICBsZXQgYnV5ZXJUeXBlLCBidXllclRpdGxlLCBidXllckNvbnRlbnQsIGJ1eWVyUHJpb3JpdHk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpIHtcclxuICAgICAgICAgIGJ1eWVyVHlwZSA9ICdwdXJjaGFzZV9jb21wbGV0ZWQnO1xyXG4gICAgICAgICAgYnV5ZXJUaXRsZSA9IGBaYWt1cCAke3BsYXRmb3JtTmFtZX0gemFrb8WEY3pvbnkgcG9tecWbbG5pZWA7XHJcbiAgICAgICAgICBidXllckNvbnRlbnQgPSBgVHfDs2ogemFrdXAgc3Vic2tyeXBjamkgJHtwbGF0Zm9ybU5hbWV9IHpvc3RhxYIgcG9tecWbbG5pZSB6cmVhbGl6b3dhbnkuIE1vxbxlc3ogdGVyYXogdXp5c2thxIcgZG9zdMSZcCBkbyBpbnN0cnVrY2ppLmA7XHJcbiAgICAgICAgICBidXllclByaW9yaXR5ID0gJ25vcm1hbCc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09ICdmYWlsZWQnKSB7XHJcbiAgICAgICAgICBidXllclR5cGUgPSAncHVyY2hhc2VfZmFpbGVkJztcclxuICAgICAgICAgIGJ1eWVyVGl0bGUgPSBgUHJvYmxlbSB6IHpha3VwZW0gJHtwbGF0Zm9ybU5hbWV9YDtcclxuICAgICAgICAgIGJ1eWVyQ29udGVudCA9IGBXeXN0xIVwacWCIHByb2JsZW0geiBUd29pbSB6YWt1cGVtIHN1YnNrcnlwY2ppICR7cGxhdGZvcm1OYW1lfS4gU3ByYXdkxbogc3pjemVnw7PFgnkgcMWCYXRub8WbY2kuYDtcclxuICAgICAgICAgIGJ1eWVyUHJpb3JpdHkgPSAnaGlnaCc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGJ1eWVyVHlwZSA9ICdwdXJjaGFzZV91cGRhdGUnO1xyXG4gICAgICAgICAgYnV5ZXJUaXRsZSA9IGBBa3R1YWxpemFjamEgemFrdXB1ICR7cGxhdGZvcm1OYW1lfWA7XHJcbiAgICAgICAgICBidXllckNvbnRlbnQgPSBgU3RhdHVzIFR3b2plZ28gemFrdXB1IHN1YnNrcnlwY2ppICR7cGxhdGZvcm1OYW1lfSB6b3N0YcWCIHpha3R1YWxpem93YW55LmA7XHJcbiAgICAgICAgICBidXllclByaW9yaXR5ID0gJ25vcm1hbCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IGJ1eWVyTm90aWZpY2F0aW9uID0gYXdhaXQgdGhpcy5jcmVhdGVOb3RpZmljYXRpb24oXHJcbiAgICAgICAgICB0cmFuc2FjdGlvbi5idXllcl9pZCxcclxuICAgICAgICAgIGJ1eWVyVHlwZSxcclxuICAgICAgICAgIGJ1eWVyVGl0bGUsXHJcbiAgICAgICAgICBidXllckNvbnRlbnQsXHJcbiAgICAgICAgICAndHJhbnNhY3Rpb24nLFxyXG4gICAgICAgICAgdHJhbnNhY3Rpb25JZCxcclxuICAgICAgICAgIGJ1eWVyUHJpb3JpdHksXHJcbiAgICAgICAgICAwLFxyXG4gICAgICAgICAgdHJ1ZSAvLyBTa2lwIGR1cGxpY2F0ZSBjaGVja1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGJ1eWVyTm90aWZpY2F0aW9uKSB7XHJcbiAgICAgICAgICByZXN1bHQucHVzaChidXllck5vdGlmaWNhdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyAyLiBOb3RpZmljYXRpb24gZm9yIHNlbGxlciAoaWYgZW5hYmxlZClcclxuICAgICAgaWYgKHNlbmRUb1NlbGxlciAmJiB0cmFuc2FjdGlvbi5zZWxsZXJfaWQgJiYgc3RhdHVzID09PSAnY29tcGxldGVkJykge1xyXG4gICAgICAgIGNvbnN0IHNlbGxlck5vdGlmaWNhdGlvbiA9IGF3YWl0IHRoaXMuY3JlYXRlTm90aWZpY2F0aW9uKFxyXG4gICAgICAgICAgdHJhbnNhY3Rpb24uc2VsbGVyX2lkLFxyXG4gICAgICAgICAgJ3NhbGVfY29tcGxldGVkJyxcclxuICAgICAgICAgICdTcHJ6ZWRhxbwgemFrb8WEY3pvbmEgcG9tecWbbG5pZScsXHJcbiAgICAgICAgICBgVcW8eXRrb3duaWsgJHt0cmFuc2FjdGlvbi5idXllcj8uZGlzcGxheV9uYW1lIHx8ICdLdG/Fmyd9IHfFgmHFm25pZSBrdXBpxYIgbWllanNjZSB3IFR3b2plaiBzdWJza3J5cGNqaSAke3BsYXRmb3JtTmFtZX0uYCxcclxuICAgICAgICAgICd0cmFuc2FjdGlvbicsXHJcbiAgICAgICAgICB0cmFuc2FjdGlvbklkLFxyXG4gICAgICAgICAgJ25vcm1hbCcsXHJcbiAgICAgICAgICAwLFxyXG4gICAgICAgICAgdHJ1ZSAvLyBTa2lwIGR1cGxpY2F0ZSBjaGVja1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHNlbGxlck5vdGlmaWNhdGlvbikge1xyXG4gICAgICAgICAgcmVzdWx0LnB1c2goc2VsbGVyTm90aWZpY2F0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyB0cmFuc2FjdGlvbiBub3RpZmljYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgLy8gRmFsbCBiYWNrIHRvIGJhc2ljIG5vdGlmaWNhdGlvblxyXG4gICAgICBjb25zdCBidXllck5vdGlmaWNhdGlvbiA9IGF3YWl0IHRoaXMuY3JlYXRlTm90aWZpY2F0aW9uKFxyXG4gICAgICAgIHRyYW5zYWN0aW9uPy5idXllcl9pZCxcclxuICAgICAgICAncHVyY2hhc2VfdXBkYXRlJyxcclxuICAgICAgICAnQWt0dWFsaXphY2phIHpha3VwdScsXHJcbiAgICAgICAgJ1R3w7NqIHpha3VwIHpvc3RhxYIgemFrdHVhbGl6b3dhbnkuJyxcclxuICAgICAgICAncHVyY2hhc2VfcmVjb3JkJyxcclxuICAgICAgICBwdXJjaGFzZUlkXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gYnV5ZXJOb3RpZmljYXRpb24gPyBbYnV5ZXJOb3RpZmljYXRpb25dIDogW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgY29uc29saWRhdGVkIG5vdGlmaWNhdGlvbnMgZm9yIGEgZGlzcHV0ZVxyXG4gICAqIFNlbmRzIG5vdGlmaWNhdGlvbnMgdG8gYWxsIGludm9sdmVkIHBhcnRpZXNcclxuICAgKiBcclxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIERpc3B1dGUgbm90aWZpY2F0aW9uIG9wdGlvbnNcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5kaXNwdXRlSWQgLSBEaXNwdXRlIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMucmVwb3J0ZXJJZCAtIFVzZXIgSUQgd2hvIHJlcG9ydGVkIHRoZSBkaXNwdXRlXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMucmVwb3J0ZWRJZCAtIFVzZXIgSUQgYmVpbmcgcmVwb3J0ZWRcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy50eXBlIC0gRGlzcHV0ZSB0eXBlXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0W10+fSBDcmVhdGVkIG5vdGlmaWNhdGlvbnNcclxuICAgKi9cclxuICBhc3luYyBjcmVhdGVEaXNwdXRlTm90aWZpY2F0aW9ucyh7XHJcbiAgICBkaXNwdXRlSWQsXHJcbiAgICByZXBvcnRlcklkLFxyXG4gICAgcmVwb3J0ZWRJZCxcclxuICAgIHR5cGUgPSAnYWNjZXNzJ1xyXG4gIH0pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEdldCBkaXNwdXRlIGRldGFpbHNcclxuICAgICAgY29uc3QgeyBkYXRhOiBkaXNwdXRlLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdkaXNwdXRlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgLmVxKCdpZCcsIGRpc3B1dGVJZClcclxuICAgICAgICAuc2luZ2xlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgIGlmIChlcnJvciB8fCAhZGlzcHV0ZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGRpc3B1dGUgZm9yIG5vdGlmaWNhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgICAgXHJcbiAgICAgIC8vIDEuIE5vdGlmaWNhdGlvbiBmb3IgcmVwb3J0ZXJcclxuICAgICAgY29uc3QgcmVwb3J0ZXJOb3RpZmljYXRpb24gPSBhd2FpdCB0aGlzLmNyZWF0ZU5vdGlmaWNhdGlvbihcclxuICAgICAgICByZXBvcnRlcklkLFxyXG4gICAgICAgICdkaXNwdXRlX2NyZWF0ZWQnLFxyXG4gICAgICAgICdaZ8WCb3N6ZW5pZSBwcm9ibGVtdSB6b3N0YcWCbyB6YXJlamVzdHJvd2FuZScsXHJcbiAgICAgICAgYFR3b2plIHpnxYJvc3plbmllIHByb2JsZW11IHogJHt0eXBlID09PSAnYWNjZXNzJyA/ICdkb3N0xJlwZW0nIDogJ3VzxYJ1Z8SFJ30gem9zdGHFgm8gemFyZWplc3Ryb3dhbmUuIFNrb250YWt0dWplbXkgc2nEmSB6IFRvYsSFIHdrcsOzdGNlLmAsXHJcbiAgICAgICAgJ2Rpc3B1dGUnLFxyXG4gICAgICAgIGRpc3B1dGVJZCxcclxuICAgICAgICAnbm9ybWFsJyxcclxuICAgICAgICAwLFxyXG4gICAgICAgIHRydWUgLy8gU2tpcCBkdXBsaWNhdGUgY2hlY2tcclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChyZXBvcnRlck5vdGlmaWNhdGlvbikge1xyXG4gICAgICAgIHJlc3VsdC5wdXNoKHJlcG9ydGVyTm90aWZpY2F0aW9uKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gMi4gTm90aWZpY2F0aW9uIGZvciByZXBvcnRlZCB1c2VyXHJcbiAgICAgIGlmIChyZXBvcnRlZElkKSB7XHJcbiAgICAgICAgY29uc3QgcmVwb3J0ZWROb3RpZmljYXRpb24gPSBhd2FpdCB0aGlzLmNyZWF0ZU5vdGlmaWNhdGlvbihcclxuICAgICAgICAgIHJlcG9ydGVkSWQsXHJcbiAgICAgICAgICAnZGlzcHV0ZV9maWxlZCcsXHJcbiAgICAgICAgICAnWmfFgm9zem9ubyBwcm9ibGVtIHogVHdvasSFIG9mZXJ0xIUnLFxyXG4gICAgICAgICAgYEt1cHVqxIVjeSB6Z8WCb3NpxYIgcHJvYmxlbSB6ICR7dHlwZSA9PT0gJ2FjY2VzcycgPyAnZG9zdMSZcGVtIGRvIHN1YnNrcnlwY2ppJyA6ICd1c8WCdWfEhSd9LiBQcm9zaW15IG8gcGlsbsSFIHdlcnlmaWthY2rEmS5gLFxyXG4gICAgICAgICAgJ2Rpc3B1dGUnLFxyXG4gICAgICAgICAgZGlzcHV0ZUlkLFxyXG4gICAgICAgICAgJ2hpZ2gnLFxyXG4gICAgICAgICAgMCxcclxuICAgICAgICAgIHRydWUgLy8gU2tpcCBkdXBsaWNhdGUgY2hlY2tcclxuICAgICAgICApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChyZXBvcnRlZE5vdGlmaWNhdGlvbikge1xyXG4gICAgICAgICAgcmVzdWx0LnB1c2gocmVwb3J0ZWROb3RpZmljYXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGRpc3B1dGUgbm90aWZpY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIGEgc2ltaWxhciBub3RpZmljYXRpb24gYWxyZWFkeSBleGlzdHMgZm9yIHRoaXMgZW50aXR5IGFuZCB1c2VyXHJcbiAgICogdG8gcHJldmVudCBkdXBsaWNhdGUgbm90aWZpY2F0aW9uc1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBOb3RpZmljYXRpb24gdHlwZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbnRpdHlUeXBlIC0gRW50aXR5IHR5cGVcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gZW50aXR5SWQgLSBFbnRpdHkgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gV2hldGhlciBhIGR1cGxpY2F0ZSBleGlzdHNcclxuICAgKi9cclxuICBhc3luYyBjaGVja0ZvckR1cGxpY2F0ZU5vdGlmaWNhdGlvbih1c2VySWQsIHR5cGUsIGVudGl0eVR5cGUsIGVudGl0eUlkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDaGVjayBmb3Igc2ltaWxhciBub3RpZmljYXRpb25zIGluIHRoZSBsYXN0IGhvdXJcclxuICAgICAgY29uc3Qgb25lSG91ckFnbyA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIG9uZUhvdXJBZ28uc2V0SG91cnMob25lSG91ckFnby5nZXRIb3VycygpIC0gMSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGNvdW50LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdub3RpZmljYXRpb25zJylcclxuICAgICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAuZXEoJ3R5cGUnLCB0eXBlKVxyXG4gICAgICAgIC5lcSgncmVsYXRlZF9lbnRpdHlfdHlwZScsIGVudGl0eVR5cGUpXHJcbiAgICAgICAgLmVxKCdyZWxhdGVkX2VudGl0eV9pZCcsIGVudGl0eUlkKVxyXG4gICAgICAgIC5ndGUoJ2NyZWF0ZWRfYXQnLCBvbmVIb3VyQWdvLnRvSVNPU3RyaW5nKCkpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBjb3VudCA+IDA7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBmb3IgZHVwbGljYXRlIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICAvLyBJZiBjaGVjayBmYWlscywgYXNzdW1lIG5vIGR1cGxpY2F0ZSB0byBlbnN1cmUgbm90aWZpY2F0aW9uIGlzIHNlbnRcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmVyaWZ5IHRoYXQgYW4gZW50aXR5IGV4aXN0cyBiZWZvcmUgc2VuZGluZyBhIG5vdGlmaWNhdGlvbiBhYm91dCBpdFxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbnRpdHlUeXBlIC0gVHlwZSBvZiBlbnRpdHlcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gZW50aXR5SWQgLSBJRCBvZiBlbnRpdHlcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gV2hldGhlciB0aGUgZW50aXR5IGV4aXN0c1xyXG4gICAqL1xyXG4gIGFzeW5jIHZlcmlmeUVudGl0eUV4aXN0cyhlbnRpdHlUeXBlLCBlbnRpdHlJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHRhYmxlO1xyXG4gICAgICBzd2l0Y2ggKGVudGl0eVR5cGUpIHtcclxuICAgICAgICBjYXNlICdncm91cCc6XHJcbiAgICAgICAgICB0YWJsZSA9ICdncm91cHMnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncHVyY2hhc2UnOlxyXG4gICAgICAgIGNhc2UgJ3B1cmNoYXNlX3JlY29yZCc6XHJcbiAgICAgICAgICB0YWJsZSA9ICdwdXJjaGFzZV9yZWNvcmRzJztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Rpc3B1dGUnOlxyXG4gICAgICAgICAgdGFibGUgPSAnZGlzcHV0ZXMnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndHJhbnNhY3Rpb24nOlxyXG4gICAgICAgICAgdGFibGUgPSAndHJhbnNhY3Rpb25zJztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2dyb3VwX2ludml0YXRpb24nOlxyXG4gICAgICAgICAgdGFibGUgPSAnZ3JvdXBfaW52aXRhdGlvbnMnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZ3JvdXBfc3ViJzpcclxuICAgICAgICAgIHRhYmxlID0gJ2dyb3VwX3N1YnMnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnY29udmVyc2F0aW9uJzpcclxuICAgICAgICAgIHRhYmxlID0gJ2NvbnZlcnNhdGlvbnMnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGNvbnNvbGUud2FybihgVW5rbm93biBlbnRpdHkgdHlwZTogJHtlbnRpdHlUeXBlfWApO1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGNvdW50LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKHRhYmxlKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxyXG4gICAgICAgIC5lcSgnaWQnLCBlbnRpdHlJZCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIGNvdW50ID4gMDtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHZlcmlmeWluZyBlbnRpdHkgJHtlbnRpdHlUeXBlfToke2VudGl0eUlkfTpgLCBlcnJvcik7XHJcbiAgICAgIC8vIElmIHZlcmlmaWNhdGlvbiBmYWlscywgYXNzdW1lIGVudGl0eSBleGlzdHMgdG8gZW5zdXJlIG5vdGlmaWNhdGlvbiBpcyBzZW50XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIHN5c3RlbSBub3RpZmljYXRpb24gZm9yIG11bHRpcGxlIHJlY2lwaWVudHNcclxuICAgKiBAcGFyYW0ge3N0cmluZ1tdfSB1c2VySWRzIC0gQXJyYXkgb2YgdXNlciBJRHMgdG8gbm90aWZ5XHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBOb3RpZmljYXRpb24gdHlwZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZSAtIE5vdGlmaWNhdGlvbiB0aXRsZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjb250ZW50IC0gTm90aWZpY2F0aW9uIGNvbnRlbnRcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcmVsYXRlZEVudGl0eVR5cGUgLSBFbnRpdHkgdHlwZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZWxhdGVkRW50aXR5SWQgLSBFbnRpdHkgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3RbXT59IENyZWF0ZWQgbm90aWZpY2F0aW9uc1xyXG4gICAqL1xyXG4gIGFzeW5jIGNyZWF0ZUJ1bGtOb3RpZmljYXRpb25zKHVzZXJJZHMsIHR5cGUsIHRpdGxlLCBjb250ZW50LCByZWxhdGVkRW50aXR5VHlwZSA9IG51bGwsIHJlbGF0ZWRFbnRpdHlJZCA9IG51bGwpIHtcclxuICAgIGlmICghdXNlcklkcyB8fCAhQXJyYXkuaXNBcnJheSh1c2VySWRzKSB8fCB1c2VySWRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFZlcmlmeSBlbnRpdHkgZXhpc3RzXHJcbiAgICAgIGlmIChyZWxhdGVkRW50aXR5VHlwZSAmJiByZWxhdGVkRW50aXR5SWQpIHtcclxuICAgICAgICBjb25zdCBlbnRpdHlFeGlzdHMgPSBhd2FpdCB0aGlzLnZlcmlmeUVudGl0eUV4aXN0cyhyZWxhdGVkRW50aXR5VHlwZSwgcmVsYXRlZEVudGl0eUlkKTtcclxuICAgICAgICBpZiAoIWVudGl0eUV4aXN0cykge1xyXG4gICAgICAgICAgY29uc29sZS53YXJuKGBFbnRpdHkgJHtyZWxhdGVkRW50aXR5VHlwZX06JHtyZWxhdGVkRW50aXR5SWR9IGRvZXMgbm90IGV4aXN0LiBTa2lwcGluZyBidWxrIG5vdGlmaWNhdGlvbnMuYCk7XHJcbiAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBDcmVhdGUgbm90aWZpY2F0aW9uIG9iamVjdHMgZm9yIGVhY2ggdXNlclxyXG4gICAgICBjb25zdCBub3RpZmljYXRpb25zID0gdXNlcklkcy5tYXAodXNlcklkID0+ICh7XHJcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgIHR5cGUsXHJcbiAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgY29udGVudCxcclxuICAgICAgICByZWxhdGVkX2VudGl0eV90eXBlOiByZWxhdGVkRW50aXR5VHlwZSxcclxuICAgICAgICByZWxhdGVkX2VudGl0eV9pZDogcmVsYXRlZEVudGl0eUlkLFxyXG4gICAgICAgIGlzX3JlYWQ6IGZhbHNlLFxyXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbnMnKVxyXG4gICAgICAgIC5pbnNlcnQobm90aWZpY2F0aW9ucylcclxuICAgICAgICAuc2VsZWN0KCk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIGRhdGEgfHwgW107XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBidWxrIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICAvLyBEb24ndCB0aHJvdyAtIGZhaWwgc2lsZW50bHkgZm9yIG5vdGlmaWNhdGlvbnNcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgdHJhbnNhY3Rpb24gbm90aWZpY2F0aW9uIHRoYXQgY29uc29saWRhdGVzIHBheW1lbnQvcHVyY2hhc2UgaW5mb1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHRyYW5zYWN0aW9uSWQgLSBUcmFuc2FjdGlvbiBJRFxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwdXJjaGFzZUlkIC0gUHVyY2hhc2UgSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RhdHVzIC0gVHJhbnNhY3Rpb24gc3RhdHVzXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gQ3JlYXRlZCBub3RpZmljYXRpb25cclxuICAgKi9cclxuICBhc3luYyBjcmVhdGVUcmFuc2FjdGlvbk5vdGlmaWNhdGlvbih1c2VySWQsIHRyYW5zYWN0aW9uSWQsIHB1cmNoYXNlSWQsIHN0YXR1cyA9ICdjb21wbGV0ZWQnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBHZXQgdHJhbnNhY3Rpb24gZGV0YWlsc1xyXG4gICAgICBjb25zdCB7IGRhdGE6IHRyYW5zYWN0aW9uLCBlcnJvcjogdHJhbnNhY3Rpb25FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCd0cmFuc2FjdGlvbnMnKVxyXG4gICAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICAgKixcclxuICAgICAgICAgIHB1cmNoYXNlOnB1cmNoYXNlX3JlY29yZHMhcHVyY2hhc2VfcmVjb3JkX2lkKFxyXG4gICAgICAgICAgICBncm91cF9zdWJfaWQsXHJcbiAgICAgICAgICAgIGdyb3VwX3N1Yjpncm91cF9zdWJzKFxyXG4gICAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9wbGF0Zm9ybXMobmFtZSlcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIGApXHJcbiAgICAgICAgLmVxKCdpZCcsIHRyYW5zYWN0aW9uSWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHRyYW5zYWN0aW9uRXJyb3IgfHwgIXRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdHJhbnNhY3Rpb24gZm9yIG5vdGlmaWNhdGlvbjonLCB0cmFuc2FjdGlvbkVycm9yKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gRGV0ZXJtaW5lIG5vdGlmaWNhdGlvbiBjb250ZW50IGJhc2VkIG9uIHN0YXR1c1xyXG4gICAgICBsZXQgdGl0bGUsIGNvbnRlbnQsIHR5cGU7XHJcbiAgICAgIGNvbnN0IHBsYXRmb3JtTmFtZSA9IHRyYW5zYWN0aW9uLnB1cmNoYXNlPy5ncm91cF9zdWI/LnN1YnNjcmlwdGlvbl9wbGF0Zm9ybXM/Lm5hbWUgfHwgJ3N1YnNrcnlwY2ppJztcclxuICAgICAgXHJcbiAgICAgIGlmIChzdGF0dXMgPT09ICdjb21wbGV0ZWQnKSB7XHJcbiAgICAgICAgdHlwZSA9ICdwdXJjaGFzZV9jb21wbGV0ZWQnO1xyXG4gICAgICAgIHRpdGxlID0gYFpha3VwICR7cGxhdGZvcm1OYW1lfSB6YWtvxYRjem9ueSBwb215xZtsbmllYDtcclxuICAgICAgICBjb250ZW50ID0gYFR3w7NqIHpha3VwIHN1YnNrcnlwY2ppICR7cGxhdGZvcm1OYW1lfSB6b3N0YcWCIHBvbXnFm2xuaWUgenJlYWxpem93YW55LiBNb8W8ZXN6IHRlcmF6IHV6eXNrYcSHIGRvc3TEmXAgZG8gaW5zdHJ1a2NqaS5gO1xyXG4gICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gJ2ZhaWxlZCcpIHtcclxuICAgICAgICB0eXBlID0gJ3B1cmNoYXNlX2ZhaWxlZCc7XHJcbiAgICAgICAgdGl0bGUgPSBgUHJvYmxlbSB6IHpha3VwZW0gJHtwbGF0Zm9ybU5hbWV9YDtcclxuICAgICAgICBjb250ZW50ID0gYFd5c3TEhXBpxYIgcHJvYmxlbSB6IFR3b2ltIHpha3VwZW0gc3Vic2tyeXBjamkgJHtwbGF0Zm9ybU5hbWV9LiBTcHJhd2TFuiBzemN6ZWfDs8WCeSBwxYJhdG5vxZtjaS5gO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHR5cGUgPSAncHVyY2hhc2VfdXBkYXRlJztcclxuICAgICAgICB0aXRsZSA9IGBBa3R1YWxpemFjamEgemFrdXB1ICR7cGxhdGZvcm1OYW1lfWA7XHJcbiAgICAgICAgY29udGVudCA9IGBTdGF0dXMgVHdvamVnbyB6YWt1cHUgc3Vic2tyeXBjamkgJHtwbGF0Zm9ybU5hbWV9IHpvc3RhxYIgemFrdHVhbGl6b3dhbnkuYDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG5vdGlmaWNhdGlvbiB3aXRoIHRyYW5zYWN0aW9uIGFzIHRoZSByZWxhdGVkIGVudGl0eVxyXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVOb3RpZmljYXRpb24oXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgIHR5cGUsXHJcbiAgICAgICAgdGl0bGUsXHJcbiAgICAgICAgY29udGVudCxcclxuICAgICAgICAndHJhbnNhY3Rpb24nLFxyXG4gICAgICAgIHRyYW5zYWN0aW9uSWQsXHJcbiAgICAgICAgc3RhdHVzID09PSAnZmFpbGVkJyA/ICdoaWdoJyA6ICdub3JtYWwnLFxyXG4gICAgICAgIDAsXHJcbiAgICAgICAgdHJ1ZSAvLyBTa2lwIGR1cGxpY2F0ZSBjaGVjayBzaW5jZSB3ZSd2ZSBhbHJlYWR5IGN1c3RvbWl6ZWQgdGhpc1xyXG4gICAgICApO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgdHJhbnNhY3Rpb24gbm90aWZpY2F0aW9uOicsIGVycm9yKTtcclxuICAgICAgLy8gRmFsbCBiYWNrIHRvIGJhc2ljIG5vdGlmaWNhdGlvblxyXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVOb3RpZmljYXRpb24oXHJcbiAgICAgICAgdXNlcklkLFxyXG4gICAgICAgICdwdXJjaGFzZScsXHJcbiAgICAgICAgJ0FrdHVhbGl6YWNqYSB6YWt1cHUnLFxyXG4gICAgICAgICdUd8OzaiB6YWt1cCB6b3N0YcWCIHpha3R1YWxpem93YW55LicsXHJcbiAgICAgICAgJ3B1cmNoYXNlX3JlY29yZCcsXHJcbiAgICAgICAgcHVyY2hhc2VJZFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHVucmVhZCBub3RpZmljYXRpb24gY291bnQgZm9yIGEgdXNlclxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8bnVtYmVyPn0gTnVtYmVyIG9mIHVucmVhZCBub3RpZmljYXRpb25zXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0VW5yZWFkQ291bnQodXNlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGNvdW50LCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdub3RpZmljYXRpb25zJylcclxuICAgICAgICAuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JywgaGVhZDogdHJ1ZSB9KVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAuZXEoJ2lzX3JlYWQnLCBmYWxzZSk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgICAgcmV0dXJuIGNvdW50IHx8IDA7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjb3VudGluZyB1bnJlYWQgbm90aWZpY2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFyayBub3RpZmljYXRpb24gYXMgcmVhZFxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfHN0cmluZ1tdfSBub3RpZmljYXRpb25JZHMgLSBOb3RpZmljYXRpb24gSUQgb3IgYXJyYXkgb2YgSURzXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSUQgZm9yIHZlcmlmaWNhdGlvblxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBTdWNjZXNzIHN0YXR1c1xyXG4gICAqL1xyXG4gIGFzeW5jIG1hcmtBc1JlYWQobm90aWZpY2F0aW9uSWRzLCB1c2VySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENvbnZlcnQgc2luZ2xlIElEIHRvIGFycmF5IGlmIG5lZWRlZFxyXG4gICAgICBjb25zdCBpZHMgPSBBcnJheS5pc0FycmF5KG5vdGlmaWNhdGlvbklkcykgPyBub3RpZmljYXRpb25JZHMgOiBbbm90aWZpY2F0aW9uSWRzXTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgnbm90aWZpY2F0aW9ucycpXHJcbiAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICBpc19yZWFkOiB0cnVlXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuaW4oJ2lkJywgaWRzKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBtYXJraW5nIG5vdGlmaWNhdGlvbnMgYXMgcmVhZDonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcmsgYWxsIG5vdGlmaWNhdGlvbnMgYXMgcmVhZCBmb3IgYSB1c2VyXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gU3VjY2VzcyBzdGF0dXNcclxuICAgKi9cclxuICBhc3luYyBtYXJrQWxsQXNSZWFkKHVzZXJJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdub3RpZmljYXRpb25zJylcclxuICAgICAgICAudXBkYXRlKHtcclxuICAgICAgICAgIGlzX3JlYWQ6IHRydWVcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAuZXEoJ2lzX3JlYWQnLCBmYWxzZSk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBtYXJraW5nIGFsbCBub3RpZmljYXRpb25zIGFzIHJlYWQ6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZWxldGUgYSBub3RpZmljYXRpb25cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbm90aWZpY2F0aW9uSWQgLSBOb3RpZmljYXRpb24gSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gVXNlciBJRCBmb3IgdmVyaWZpY2F0aW9uXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFN1Y2Nlc3Mgc3RhdHVzXHJcbiAgICovXHJcbiAgYXN5bmMgZGVsZXRlTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbklkLCB1c2VySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgnbm90aWZpY2F0aW9ucycpXHJcbiAgICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgICAgLmVxKCdpZCcsIG5vdGlmaWNhdGlvbklkKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZCk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZWxldGluZyBub3RpZmljYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdXNlciBub3RpZmljYXRpb25zIHdpdGggZmlsdGVyaW5nIGFuZCBwYWdpbmF0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIEZpbHRlciBhbmQgcGFnaW5hdGlvbiBvcHRpb25zXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gTm90aWZpY2F0aW9ucyBhbmQgcGFnaW5hdGlvbiBpbmZvXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0VXNlck5vdGlmaWNhdGlvbnModXNlcklkLCBvcHRpb25zID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEJ1aWxkIHRoZSBxdWVyeVxyXG4gICAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbnMnKVxyXG4gICAgICAgIC5zZWxlY3QoJyonLCB7IGNvdW50OiAnZXhhY3QnIH0pXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKTtcclxuXHJcbiAgICAgIC8vIEFwcGx5IGZpbHRlcnNcclxuICAgICAgaWYgKG9wdGlvbnMudHlwZSkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3R5cGUnLCBvcHRpb25zLnR5cGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAob3B0aW9ucy5yZWFkICE9PSBudWxsICYmIG9wdGlvbnMucmVhZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnaXNfcmVhZCcsIG9wdGlvbnMucmVhZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zLnByaW9yaXR5KSB7XHJcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncHJpb3JpdHknLCBvcHRpb25zLnByaW9yaXR5KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG9wdGlvbnMucmVsYXRlZEVudGl0eVR5cGUpIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdyZWxhdGVkX2VudGl0eV90eXBlJywgb3B0aW9ucy5yZWxhdGVkRW50aXR5VHlwZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvcHRpb25zLnJlbGF0ZWRFbnRpdHlJZCkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3JlbGF0ZWRfZW50aXR5X2lkJywgb3B0aW9ucy5yZWxhdGVkRW50aXR5SWQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBPcmRlciBieSBjcmVhdGlvbiBkYXRlLCBuZXdlc3QgZmlyc3RcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cclxuICAgICAgY29uc3QgcGFnZSA9IG9wdGlvbnMucGFnZSB8fCAxO1xyXG4gICAgICBjb25zdCBwYWdlU2l6ZSA9IG9wdGlvbnMucGFnZVNpemUgfHwgMTA7XHJcbiAgICAgIGNvbnN0IHN0YXJ0ID0gKHBhZ2UgLSAxKSAqIHBhZ2VTaXplO1xyXG4gICAgICBjb25zdCBlbmQgPSBzdGFydCArIHBhZ2VTaXplIC0gMTtcclxuXHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkucmFuZ2Uoc3RhcnQsIGVuZCk7XHJcblxyXG4gICAgICAvLyBFeGVjdXRlIHRoZSBxdWVyeVxyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnk7XHJcblxyXG4gICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgICAgLy8gQ2FsY3VsYXRlIHBhZ2luYXRpb24gaW5mb1xyXG4gICAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKChjb3VudCB8fCAwKSAvIHBhZ2VTaXplKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbm90aWZpY2F0aW9uczogZGF0YSB8fCBbXSxcclxuICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICBwYWdlLFxyXG4gICAgICAgICAgcGFnZVNpemUsXHJcbiAgICAgICAgICB0b3RhbDogY291bnQgfHwgMCxcclxuICAgICAgICAgIHRvdGFsUGFnZXNcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb24gaW4gZ2V0VXNlck5vdGlmaWNhdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBub3RpZmljYXRpb25zOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgbm90aWZpY2F0aW9uIHByZWZlcmVuY2VzIGZvciBhIHVzZXJcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gVXNlciBJRFxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IE5vdGlmaWNhdGlvbiBwcmVmZXJlbmNlc1xyXG4gICAqL1xyXG4gIGFzeW5jIGdldE5vdGlmaWNhdGlvblByZWZlcmVuY2VzKHVzZXJJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdub3RpZmljYXRpb25fcHJlZmVyZW5jZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcblxyXG4gICAgICAvLyBJZiBubyBwcmVmZXJlbmNlcyBleGlzdCwgcmV0dXJuIGRlZmF1bHRzXHJcbiAgICAgIGlmICghZGF0YSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgICBlbWFpbF9lbmFibGVkOiB0cnVlLFxyXG4gICAgICAgICAgcHVzaF9lbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgIG5vdGlmeV9vbl9pbnZpdGU6IHRydWUsXHJcbiAgICAgICAgICBub3RpZnlfb25fbWVzc2FnZTogdHJ1ZSxcclxuICAgICAgICAgIG5vdGlmeV9vbl9wdXJjaGFzZTogdHJ1ZSxcclxuICAgICAgICAgIG5vdGlmeV9vbl9kaXNwdXRlOiB0cnVlLFxyXG4gICAgICAgICAgZW1haWxfZGlnZXN0OiAnZGFpbHknXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBub3RpZmljYXRpb24gcHJlZmVyZW5jZXM6JywgZXJyb3IpO1xyXG4gICAgICAvLyBSZXR1cm4gZGVmYXVsdHMgb24gZXJyb3JcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgZW1haWxfZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICBwdXNoX2VuYWJsZWQ6IGZhbHNlLFxyXG4gICAgICAgIG5vdGlmeV9vbl9pbnZpdGU6IHRydWUsXHJcbiAgICAgICAgbm90aWZ5X29uX21lc3NhZ2U6IHRydWUsXHJcbiAgICAgICAgbm90aWZ5X29uX3B1cmNoYXNlOiB0cnVlLFxyXG4gICAgICAgIG5vdGlmeV9vbl9kaXNwdXRlOiB0cnVlLFxyXG4gICAgICAgIGVtYWlsX2RpZ2VzdDogJ2RhaWx5J1xyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIG5vdGlmaWNhdGlvbiBwcmVmZXJlbmNlcyBmb3IgYSB1c2VyXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcHJlZmVyZW5jZXMgLSBVcGRhdGVkIHByZWZlcmVuY2VzXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gVXBkYXRlZCBwcmVmZXJlbmNlc1xyXG4gICAqL1xyXG4gIGFzeW5jIHVwZGF0ZU5vdGlmaWNhdGlvblByZWZlcmVuY2VzKHVzZXJJZCwgcHJlZmVyZW5jZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENoZWNrIGlmIHByZWZlcmVuY2VzIGFscmVhZHkgZXhpc3RcclxuICAgICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdub3RpZmljYXRpb25fcHJlZmVyZW5jZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VySWQpXHJcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gICAgICBsZXQgcmVzdWx0O1xyXG5cclxuICAgICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHByZWZlcmVuY2VzXHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcycpXHJcbiAgICAgICAgICAudXBkYXRlKHByZWZlcmVuY2VzKVxyXG4gICAgICAgICAgLmVxKCd1c2VyX2lkJywgdXNlcklkKVxyXG4gICAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgICAuc2luZ2xlKCk7XHJcblxyXG4gICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgcmVzdWx0ID0gZGF0YTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBDcmVhdGUgbmV3IHByZWZlcmVuY2VzXHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbl9wcmVmZXJlbmNlcycpXHJcbiAgICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxyXG4gICAgICAgICAgICAuLi5wcmVmZXJlbmNlc1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgICAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG4gICAgICAgIHJlc3VsdCA9IGRhdGE7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBub3RpZmljYXRpb24gcHJlZmVyZW5jZXM6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgbm90aWZpY2F0aW9uIHByZWZlcmVuY2VzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyBDcmVhdGUgYW5kIGV4cG9ydCBhIHNpbmdsZXRvbiBpbnN0YW5jZVxyXG5leHBvcnQgY29uc3Qgbm90aWZpY2F0aW9uU2VydmljZSA9IG5ldyBOb3RpZmljYXRpb25TZXJ2aWNlKCk7Il0sIm5hbWVzIjpbInN1cGFiYXNlQWRtaW4iLCJOb3RpZmljYXRpb25TZXJ2aWNlIiwiY3JlYXRlTm90aWZpY2F0aW9uIiwidXNlcklkIiwidHlwZSIsInRpdGxlIiwiY29udGVudCIsInJlbGF0ZWRFbnRpdHlUeXBlIiwicmVsYXRlZEVudGl0eUlkIiwicHJpb3JpdHkiLCJ0dGwiLCJza2lwRHVwbGljYXRlQ2hlY2siLCJ2ZXJpZnlVc2VyRXhpc3RzIiwiY29uc29sZSIsIndhcm4iLCJlbnRpdHlFeGlzdHMiLCJ2ZXJpZnlFbnRpdHlFeGlzdHMiLCJoYXNEdXBsaWNhdGUiLCJjaGVja0ZvckR1cGxpY2F0ZU5vdGlmaWNhdGlvbiIsImxvZyIsIm5vdGlmaWNhdGlvbiIsInVzZXJfaWQiLCJyZWxhdGVkX2VudGl0eV90eXBlIiwicmVsYXRlZF9lbnRpdHlfaWQiLCJpc19yZWFkIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInJldHJ5Q291bnQiLCJtYXhSZXRyaWVzIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsImluc2VydCIsInNlbGVjdCIsInNpbmdsZSIsImluc2VydEVycm9yIiwiUHJvbWlzZSIsInIiLCJzZXRUaW1lb3V0IiwiTWF0aCIsInBvdyIsImNvdW50IiwiaGVhZCIsImVxIiwiY3JlYXRlVHJhbnNhY3Rpb25Ob3RpZmljYXRpb24iLCJ0cmFuc2FjdGlvbklkIiwicHVyY2hhc2VJZCIsInN0YXR1cyIsInNlbmRUb1NlbGxlciIsInRyYW5zYWN0aW9uIiwidHJhbnNhY3Rpb25FcnJvciIsInJlc3VsdCIsInBsYXRmb3JtTmFtZSIsInB1cmNoYXNlIiwiZ3JvdXBfc3ViIiwic3Vic2NyaXB0aW9uX3BsYXRmb3JtcyIsIm5hbWUiLCJidXllcl9pZCIsImJ1eWVyVHlwZSIsImJ1eWVyVGl0bGUiLCJidXllckNvbnRlbnQiLCJidXllclByaW9yaXR5IiwiYnV5ZXJOb3RpZmljYXRpb24iLCJwdXNoIiwic2VsbGVyX2lkIiwic2VsbGVyTm90aWZpY2F0aW9uIiwiYnV5ZXIiLCJkaXNwbGF5X25hbWUiLCJjcmVhdGVEaXNwdXRlTm90aWZpY2F0aW9ucyIsImRpc3B1dGVJZCIsInJlcG9ydGVySWQiLCJyZXBvcnRlZElkIiwiZGlzcHV0ZSIsInJlcG9ydGVyTm90aWZpY2F0aW9uIiwicmVwb3J0ZWROb3RpZmljYXRpb24iLCJlbnRpdHlUeXBlIiwiZW50aXR5SWQiLCJvbmVIb3VyQWdvIiwic2V0SG91cnMiLCJnZXRIb3VycyIsImd0ZSIsInRhYmxlIiwiY3JlYXRlQnVsa05vdGlmaWNhdGlvbnMiLCJ1c2VySWRzIiwiQXJyYXkiLCJpc0FycmF5IiwibGVuZ3RoIiwibm90aWZpY2F0aW9ucyIsIm1hcCIsImdldFVucmVhZENvdW50IiwibWFya0FzUmVhZCIsIm5vdGlmaWNhdGlvbklkcyIsImlkcyIsInVwZGF0ZSIsImluIiwibWFya0FsbEFzUmVhZCIsImRlbGV0ZU5vdGlmaWNhdGlvbiIsIm5vdGlmaWNhdGlvbklkIiwiZGVsZXRlIiwiZ2V0VXNlck5vdGlmaWNhdGlvbnMiLCJvcHRpb25zIiwicXVlcnkiLCJyZWFkIiwidW5kZWZpbmVkIiwib3JkZXIiLCJhc2NlbmRpbmciLCJwYWdlIiwicGFnZVNpemUiLCJzdGFydCIsImVuZCIsInJhbmdlIiwidG90YWxQYWdlcyIsImNlaWwiLCJwYWdpbmF0aW9uIiwidG90YWwiLCJFcnJvciIsIm1lc3NhZ2UiLCJnZXROb3RpZmljYXRpb25QcmVmZXJlbmNlcyIsIm1heWJlU2luZ2xlIiwiZW1haWxfZW5hYmxlZCIsInB1c2hfZW5hYmxlZCIsIm5vdGlmeV9vbl9pbnZpdGUiLCJub3RpZnlfb25fbWVzc2FnZSIsIm5vdGlmeV9vbl9wdXJjaGFzZSIsIm5vdGlmeV9vbl9kaXNwdXRlIiwiZW1haWxfZGlnZXN0IiwidXBkYXRlTm90aWZpY2F0aW9uUHJlZmVyZW5jZXMiLCJwcmVmZXJlbmNlcyIsImV4aXN0aW5nIiwibm90aWZpY2F0aW9uU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/services/notification/notification-service.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@clerk","vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/tslib","vendor-chunks/cookie","vendor-chunks/map-obj","vendor-chunks/no-case","vendor-chunks/lower-case","vendor-chunks/snakecase-keys","vendor-chunks/snake-case","vendor-chunks/dot-case"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fnotifications%2Fcount%2Froute&page=%2Fapi%2Fnotifications%2Fcount%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fnotifications%2Fcount%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();