"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/offers/route";
exports.ids = ["app/api/offers/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_offers_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/offers/route.js */ \"(rsc)/./src/app/api/offers/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/offers/route\",\n        pathname: \"/api/offers\",\n        filename: \"route\",\n        bundlePath: \"app/api/offers/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\bacze\\\\Project\\\\GroupShare\\\\groupshare-project\\\\src\\\\app\\\\api\\\\offers\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_offers_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/offers/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZvZmZlcnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm9mZmVycyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9mZmVycyUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMwQztBQUN2SDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8/MjEzNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxiYWN6ZVxcXFxQcm9qZWN0XFxcXEdyb3VwU2hhcmVcXFxcZ3JvdXBzaGFyZS1wcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXG9mZmVyc1xcXFxyb3V0ZS5qc1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvb2ZmZXJzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvb2ZmZXJzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9vZmZlcnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxiYWN6ZVxcXFxQcm9qZWN0XFxcXEdyb3VwU2hhcmVcXFxcZ3JvdXBzaGFyZS1wcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXG9mZmVyc1xcXFxyb3V0ZS5qc1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvb2ZmZXJzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/offers/route.js":
/*!*************************************!*\
  !*** ./src/app/api/offers/route.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/currentUser.js\");\n/* harmony import */ var _lib_database_supabase_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/database/supabase-client */ \"(rsc)/./src/lib/database/supabase-client.js\");\n/* harmony import */ var _lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/api/error-handler */ \"(rsc)/./src/lib/api/error-handler.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_3__);\n// src/app/api/offers/route.js\n\n\n\n\n\n// Schemat walidacji dla tworzenia oferty\nconst createOfferSchema = {\n    groupId: {\n        required: true\n    },\n    platformId: {\n        required: true\n    },\n    slotsTotal: {\n        required: true,\n        type: \"number\",\n        min: 1\n    },\n    pricePerSlot: {\n        required: true,\n        type: \"number\",\n        min: 0.01\n    },\n    accessInstructions: {\n        required: true,\n        minLength: 10\n    },\n    currency: {\n        type: \"string\"\n    }\n};\n/**\r\n * GET /api/offers\r\n * Pobiera oferty subskrypcji z opcjonalnym filtrowaniem\r\n */ async function GET(request) {\n    try {\n        // Parsuj parametry zapytania\n        const { searchParams } = new URL(request.url);\n        // Przygotuj filtry na podstawie parametrów\n        const filters = {\n            platformId: searchParams.get(\"platformId\"),\n            minPrice: searchParams.get(\"minPrice\") ? parseFloat(searchParams.get(\"minPrice\")) : undefined,\n            maxPrice: searchParams.get(\"maxPrice\") ? parseFloat(searchParams.get(\"maxPrice\")) : undefined,\n            availableSlots: searchParams.get(\"availableSlots\") !== \"false\",\n            orderBy: searchParams.get(\"orderBy\") || \"created_at\",\n            ascending: searchParams.get(\"ascending\") === \"true\",\n            limit: searchParams.get(\"limit\") ? parseInt(searchParams.get(\"limit\")) : 10,\n            page: searchParams.get(\"page\") ? parseInt(searchParams.get(\"page\")) : 1\n        };\n        // Oblicz offset na podstawie strony i limitu\n        filters.offset = (filters.page - 1) * filters.limit;\n        // Pobierz oferty z repozytorium\n        const offers = await _lib_database_supabase_client__WEBPACK_IMPORTED_MODULE_1__.offersRepository.getAll(filters);\n        return (0,_lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.apiResponse)(offers);\n    } catch (error) {\n        return (0,_lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.handleApiError)(error, \"Nie udało się pobrać ofert subskrypcji\");\n    }\n}\n/**\r\n * POST /api/offers\r\n * Tworzy nową ofertę subskrypcji\r\n */ async function POST(request) {\n    // Używamy protectApiRoute do zabezpieczenia endpointu z uwierzytelnianiem i walidacją\n    return (0,_lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.protectApiRoute)(async (req)=>{\n        try {\n            // Pobierz dane z żądania (już zwalidowane przez protectApiRoute)\n            const body = await req.json();\n            // Dodatkowa walidacja\n            const { isValid, errors } = (0,_lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.validateRequestBody)(createOfferSchema, body);\n            if (!isValid) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Validation error\",\n                    details: errors\n                }, {\n                    status: 400\n                });\n            }\n            // Pobierz użytkownika z Clerk\n            const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_4__.currentUser)();\n            // Pobierz profil użytkownika\n            const userProfile = await _lib_database_supabase_client__WEBPACK_IMPORTED_MODULE_1__.userRepository.getByAuthId(user.id);\n            if (!userProfile) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"User profile not found\"\n                }, {\n                    status: 404\n                });\n            }\n            // Sprawdź, czy użytkownik jest właścicielem lub adminem grupy\n            const isAuthorized = await checkGroupPermission(body.groupId, userProfile.id);\n            if (!isAuthorized) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"You do not have permission to create offers for this group\"\n                }, {\n                    status: 403\n                });\n            }\n            // Przygotuj dane oferty\n            const offerData = {\n                group_id: body.groupId,\n                platform_id: body.platformId,\n                status: \"active\",\n                slots_total: body.slotsTotal,\n                slots_available: body.slotsTotal,\n                price_per_slot: body.pricePerSlot,\n                currency: body.currency || \"PLN\",\n                created_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            };\n            // Utwórz ofertę\n            const createdOffer = await _lib_database_supabase_client__WEBPACK_IMPORTED_MODULE_1__.offersRepository.create(offerData);\n            if (!createdOffer) {\n                throw new Error(\"Failed to create subscription offer\");\n            }\n            // Zapisz instrukcje dostępu\n            await saveAccessInstructions(createdOffer.id, body.accessInstructions);\n            // Zaloguj operację\n            await logSecurityEvent(userProfile.id, \"create\", \"group_sub\", createdOffer.id, {\n                group_id: body.groupId\n            });\n            return (0,_lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.apiResponse)(createdOffer, 201, \"Oferta subskrypcji została utworzona pomyślnie\");\n        } catch (error) {\n            return (0,_lib_api_error_handler__WEBPACK_IMPORTED_MODULE_2__.handleApiError)(error, \"Failed to create subscription offer\");\n        }\n    })(request, {});\n}\n/**\r\n * Sprawdza uprawnienia użytkownika w grupie\r\n * @param {string} groupId - ID grupy\r\n * @param {string} userId - ID użytkownika\r\n * @returns {Promise<boolean>} - Czy użytkownik ma uprawnienia\r\n */ async function checkGroupPermission(groupId, userId) {\n    try {\n        // Sprawdź, czy użytkownik jest właścicielem grupy\n        const { data: group } = await supabaseAdmin.from(\"groups\").select(\"owner_id\").eq(\"id\", groupId).single();\n        if (group && group.owner_id === userId) {\n            return true;\n        }\n        // Jeśli nie jest właścicielem, sprawdź czy jest adminem\n        const { data: membership } = await supabaseAdmin.from(\"group_members\").select(\"role\").eq(\"group_id\", groupId).eq(\"user_id\", userId).eq(\"status\", \"active\").single();\n        return membership && membership.role === \"admin\";\n    } catch (error) {\n        console.error(\"Error checking group permission:\", error);\n        return false;\n    }\n}\n/**\r\n * Zapisuje instrukcje dostępu dla oferty\r\n * @param {string} groupSubId - ID oferty\r\n * @param {string} instructions - Instrukcje dostępu\r\n * @returns {Promise<boolean>} - Czy operacja się powiodła\r\n */ async function saveAccessInstructions(groupSubId, instructions) {\n    try {\n        // Pobierz lub wygeneruj klucz szyfrowania\n        let encryptionKeyId;\n        const { data: existingKey } = await supabaseAdmin.from(\"encryption_keys\").select(\"id\").eq(\"key_type\", \"master\").eq(\"active\", true).single();\n        if (existingKey) {\n            encryptionKeyId = existingKey.id;\n        } else {\n            // Generuj nowy klucz\n            const newKey = {\n                key_type: \"master\",\n                public_key: \"dummy_public_key_\" + Math.random().toString(36).substring(2),\n                private_key_enc: \"dummy_encrypted_private_key_\" + Math.random().toString(36).substring(2),\n                active: true,\n                created_at: new Date().toISOString()\n            };\n            const { data: createdKey } = await supabaseAdmin.from(\"encryption_keys\").insert([\n                newKey\n            ]).select(\"id\").single();\n            encryptionKeyId = createdKey?.id;\n        }\n        if (!encryptionKeyId) {\n            throw new Error(\"Failed to get or create encryption key\");\n        }\n        // \"Szyfrowanie\" instrukcji\n        const encryptedData = \"ENCRYPTED:\" + Buffer.from(instructions).toString(\"base64\");\n        const iv = generateRandomBytes(16).toString(\"hex\");\n        const dataKeyEnc = \"dummy_key_enc_\" + Math.random().toString(36).substring(2);\n        // Zapisz instrukcje\n        const { error } = await supabaseAdmin.from(\"access_instructions\").insert({\n            group_sub_id: groupSubId,\n            encrypted_data: encryptedData,\n            data_key_enc: dataKeyEnc,\n            encryption_key_id: encryptionKeyId,\n            iv: iv,\n            encryption_version: \"1.0\",\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        });\n        return !error;\n    } catch (error) {\n        console.error(\"Error saving access instructions:\", error);\n        // Kontynuujemy mimo błędu, główna funkcjonalność została wykonana\n        return false;\n    }\n}\n/**\r\n * Loguje zdarzenie bezpieczeństwa\r\n * @param {string} userId - ID użytkownika\r\n * @param {string} actionType - Typ akcji\r\n * @param {string} resourceType - Typ zasobu\r\n * @param {string} resourceId - ID zasobu\r\n * @param {Object} details - Dodatkowe szczegóły\r\n */ async function logSecurityEvent(userId, actionType, resourceType, resourceId, details = {}) {\n    try {\n        await supabaseAdmin.from(\"security_logs\").insert({\n            user_id: userId,\n            action_type: actionType,\n            resource_type: resourceType,\n            resource_id: String(resourceId),\n            status: \"success\",\n            details: details,\n            created_at: new Date().toISOString()\n        });\n    } catch (error) {\n        console.error(\"Error logging security event:\", error);\n    }\n}\n/**\r\n * Funkcja generująca losowe bajty (alternatywa dla crypto.randomBytes)\r\n * Zmieniono nazwę z crypto() na generateRandomBytes() aby uniknąć konfliktu\r\n */ function generateRandomBytes(size) {\n    const values = new Uint8Array(size);\n    for(let i = 0; i < size; i++){\n        values[i] = Math.floor(Math.random() * 256);\n    }\n    return {\n        toString: (encoding)=>{\n            if (encoding === \"hex\") {\n                return Array.from(values).map((b)=>b.toString(16).padStart(2, \"0\")).join(\"\");\n            }\n            return String.fromCharCode.apply(null, values);\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1lBQ2ZLLGFBQWFDLE9BQU9MO1lBQ3BCN0QsUUFBUTtZQUNSRCxTQUFTQTtZQUNUYyxZQUFZLElBQUlDLE9BQU9DLFdBQVc7UUFDcEM7SUFDSixFQUFFLE9BQU92QixPQUFPO1FBQ2R5QyxRQUFRekMsS0FBSyxDQUFDLGlDQUFpQ0E7SUFDakQ7QUFDRjtBQUVBOzs7Q0FHQyxHQUNELFNBQVM0RCxvQkFBb0JlLElBQUk7SUFDL0IsTUFBTUMsU0FBUyxJQUFJQyxXQUFXRjtJQUM5QixJQUFLLElBQUlHLElBQUksR0FBR0EsSUFBSUgsTUFBTUcsSUFBSztRQUM3QkYsTUFBTSxDQUFDRSxFQUFFLEdBQUc3QixLQUFLOEIsS0FBSyxDQUFDOUIsS0FBS0MsTUFBTSxLQUFLO0lBQ3pDO0lBQ0EsT0FBTztRQUNMQyxVQUFVLENBQUM2QjtZQUNULElBQUlBLGFBQWEsT0FBTztnQkFDdEIsT0FBT0MsTUFBTS9DLElBQUksQ0FBQzBDLFFBQ2ZNLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRWhDLFFBQVEsQ0FBQyxJQUFJaUMsUUFBUSxDQUFDLEdBQUcsTUFDcENDLElBQUksQ0FBQztZQUNWO1lBQ0EsT0FBT1gsT0FBT1ksWUFBWSxDQUFDQyxLQUFLLENBQUMsTUFBTVg7UUFDekM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2FwcC9hcGkvb2ZmZXJzL3JvdXRlLmpzPzlmMzIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2FwcC9hcGkvb2ZmZXJzL3JvdXRlLmpzXHJcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHsgY3VycmVudFVzZXIgfSBmcm9tICdAY2xlcmsvbmV4dGpzL3NlcnZlcic7XHJcbmltcG9ydCB7IG9mZmVyc1JlcG9zaXRvcnksIHVzZXJSZXBvc2l0b3J5IH0gZnJvbSAnQC9saWIvZGF0YWJhc2Uvc3VwYWJhc2UtY2xpZW50JztcclxuaW1wb3J0IHsgaGFuZGxlQXBpRXJyb3IsIGFwaVJlc3BvbnNlLCB2YWxpZGF0ZVJlcXVlc3RCb2R5LCBwcm90ZWN0QXBpUm91dGUgfSBmcm9tICdAL2xpYi9hcGkvZXJyb3ItaGFuZGxlcic7XHJcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcclxuXHJcbi8vIFNjaGVtYXQgd2FsaWRhY2ppIGRsYSB0d29yemVuaWEgb2ZlcnR5XHJcbmNvbnN0IGNyZWF0ZU9mZmVyU2NoZW1hID0ge1xyXG4gIGdyb3VwSWQ6IHsgcmVxdWlyZWQ6IHRydWUgfSxcclxuICBwbGF0Zm9ybUlkOiB7IHJlcXVpcmVkOiB0cnVlIH0sXHJcbiAgc2xvdHNUb3RhbDogeyByZXF1aXJlZDogdHJ1ZSwgdHlwZTogJ251bWJlcicsIG1pbjogMSB9LFxyXG4gIHByaWNlUGVyU2xvdDogeyByZXF1aXJlZDogdHJ1ZSwgdHlwZTogJ251bWJlcicsIG1pbjogMC4wMSB9LFxyXG4gIGFjY2Vzc0luc3RydWN0aW9uczogeyByZXF1aXJlZDogdHJ1ZSwgbWluTGVuZ3RoOiAxMCB9LFxyXG4gIGN1cnJlbmN5OiB7IHR5cGU6ICdzdHJpbmcnIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBHRVQgL2FwaS9vZmZlcnNcclxuICogUG9iaWVyYSBvZmVydHkgc3Vic2tyeXBjamkgeiBvcGNqb25hbG55bSBmaWx0cm93YW5pZW1cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBQYXJzdWogcGFyYW1ldHJ5IHphcHl0YW5pYVxyXG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xyXG4gICAgXHJcbiAgICAvLyBQcnp5Z290dWogZmlsdHJ5IG5hIHBvZHN0YXdpZSBwYXJhbWV0csOzd1xyXG4gICAgY29uc3QgZmlsdGVycyA9IHtcclxuICAgICAgcGxhdGZvcm1JZDogc2VhcmNoUGFyYW1zLmdldCgncGxhdGZvcm1JZCcpLFxyXG4gICAgICBtaW5QcmljZTogc2VhcmNoUGFyYW1zLmdldCgnbWluUHJpY2UnKSA/IHBhcnNlRmxvYXQoc2VhcmNoUGFyYW1zLmdldCgnbWluUHJpY2UnKSkgOiB1bmRlZmluZWQsXHJcbiAgICAgIG1heFByaWNlOiBzZWFyY2hQYXJhbXMuZ2V0KCdtYXhQcmljZScpID8gcGFyc2VGbG9hdChzZWFyY2hQYXJhbXMuZ2V0KCdtYXhQcmljZScpKSA6IHVuZGVmaW5lZCxcclxuICAgICAgYXZhaWxhYmxlU2xvdHM6IHNlYXJjaFBhcmFtcy5nZXQoJ2F2YWlsYWJsZVNsb3RzJykgIT09ICdmYWxzZScsIC8vIERvbXnFm2xuaWUgdHJ1ZVxyXG4gICAgICBvcmRlckJ5OiBzZWFyY2hQYXJhbXMuZ2V0KCdvcmRlckJ5JykgfHwgJ2NyZWF0ZWRfYXQnLFxyXG4gICAgICBhc2NlbmRpbmc6IHNlYXJjaFBhcmFtcy5nZXQoJ2FzY2VuZGluZycpID09PSAndHJ1ZScsXHJcbiAgICAgIGxpbWl0OiBzZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpID8gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSkgOiAxMCxcclxuICAgICAgcGFnZTogc2VhcmNoUGFyYW1zLmdldCgncGFnZScpID8gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgncGFnZScpKSA6IDFcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIE9ibGljeiBvZmZzZXQgbmEgcG9kc3Rhd2llIHN0cm9ueSBpIGxpbWl0dVxyXG4gICAgZmlsdGVycy5vZmZzZXQgPSAoZmlsdGVycy5wYWdlIC0gMSkgKiBmaWx0ZXJzLmxpbWl0O1xyXG4gICAgXHJcbiAgICAvLyBQb2JpZXJ6IG9mZXJ0eSB6IHJlcG96eXRvcml1bVxyXG4gICAgY29uc3Qgb2ZmZXJzID0gYXdhaXQgb2ZmZXJzUmVwb3NpdG9yeS5nZXRBbGwoZmlsdGVycyk7XHJcbiAgICBcclxuICAgIHJldHVybiBhcGlSZXNwb25zZShvZmZlcnMpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gaGFuZGxlQXBpRXJyb3IoZXJyb3IsICdOaWUgdWRhxYJvIHNpxJkgcG9icmHEhyBvZmVydCBzdWJza3J5cGNqaScpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFBPU1QgL2FwaS9vZmZlcnNcclxuICogVHdvcnp5IG5vd8SFIG9mZXJ0xJkgc3Vic2tyeXBjamlcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3QpIHtcclxuICAvLyBVxbx5d2FteSBwcm90ZWN0QXBpUm91dGUgZG8gemFiZXpwaWVjemVuaWEgZW5kcG9pbnR1IHogdXdpZXJ6eXRlbG5pYW5pZW0gaSB3YWxpZGFjasSFXHJcbiAgcmV0dXJuIHByb3RlY3RBcGlSb3V0ZShhc3luYyAocmVxKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBQb2JpZXJ6IGRhbmUgeiDFvMSFZGFuaWEgKGp1xbwgendhbGlkb3dhbmUgcHJ6ZXogcHJvdGVjdEFwaVJvdXRlKVxyXG4gICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcclxuICAgICAgXHJcbiAgICAgIC8vIERvZGF0a293YSB3YWxpZGFjamFcclxuICAgICAgY29uc3QgeyBpc1ZhbGlkLCBlcnJvcnMgfSA9IHZhbGlkYXRlUmVxdWVzdEJvZHkoY3JlYXRlT2ZmZXJTY2hlbWEsIGJvZHkpO1xyXG4gICAgICBpZiAoIWlzVmFsaWQpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsIGRldGFpbHM6IGVycm9ycyB9LFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gUG9iaWVyeiB1xbx5dGtvd25pa2EgeiBDbGVya1xyXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgY3VycmVudFVzZXIoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFBvYmllcnogcHJvZmlsIHXFvHl0a293bmlrYVxyXG4gICAgICBjb25zdCB1c2VyUHJvZmlsZSA9IGF3YWl0IHVzZXJSZXBvc2l0b3J5LmdldEJ5QXV0aElkKHVzZXIuaWQpO1xyXG4gICAgICBpZiAoIXVzZXJQcm9maWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogJ1VzZXIgcHJvZmlsZSBub3QgZm91bmQnIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDA0IH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBTcHJhd2TFuiwgY3p5IHXFvHl0a293bmlrIGplc3Qgd8WCYcWbY2ljaWVsZW0gbHViIGFkbWluZW0gZ3J1cHlcclxuICAgICAgY29uc3QgaXNBdXRob3JpemVkID0gYXdhaXQgY2hlY2tHcm91cFBlcm1pc3Npb24oYm9keS5ncm91cElkLCB1c2VyUHJvZmlsZS5pZCk7XHJcbiAgICAgIGlmICghaXNBdXRob3JpemVkKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogJ1lvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGNyZWF0ZSBvZmZlcnMgZm9yIHRoaXMgZ3JvdXAnIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBQcnp5Z290dWogZGFuZSBvZmVydHlcclxuICAgICAgY29uc3Qgb2ZmZXJEYXRhID0ge1xyXG4gICAgICAgIGdyb3VwX2lkOiBib2R5Lmdyb3VwSWQsXHJcbiAgICAgICAgcGxhdGZvcm1faWQ6IGJvZHkucGxhdGZvcm1JZCxcclxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxyXG4gICAgICAgIHNsb3RzX3RvdGFsOiBib2R5LnNsb3RzVG90YWwsXHJcbiAgICAgICAgc2xvdHNfYXZhaWxhYmxlOiBib2R5LnNsb3RzVG90YWwsXHJcbiAgICAgICAgcHJpY2VfcGVyX3Nsb3Q6IGJvZHkucHJpY2VQZXJTbG90LFxyXG4gICAgICAgIGN1cnJlbmN5OiBib2R5LmN1cnJlbmN5IHx8ICdQTE4nLFxyXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIC8vIFV0d8Ozcnogb2ZlcnTEmVxyXG4gICAgICBjb25zdCBjcmVhdGVkT2ZmZXIgPSBhd2FpdCBvZmZlcnNSZXBvc2l0b3J5LmNyZWF0ZShvZmZlckRhdGEpO1xyXG4gICAgICBpZiAoIWNyZWF0ZWRPZmZlcikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBzdWJzY3JpcHRpb24gb2ZmZXInKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gWmFwaXN6IGluc3RydWtjamUgZG9zdMSZcHVcclxuICAgICAgYXdhaXQgc2F2ZUFjY2Vzc0luc3RydWN0aW9ucyhjcmVhdGVkT2ZmZXIuaWQsIGJvZHkuYWNjZXNzSW5zdHJ1Y3Rpb25zKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFphbG9ndWogb3BlcmFjasSZXHJcbiAgICAgIGF3YWl0IGxvZ1NlY3VyaXR5RXZlbnQodXNlclByb2ZpbGUuaWQsICdjcmVhdGUnLCAnZ3JvdXBfc3ViJywgY3JlYXRlZE9mZmVyLmlkLCB7XHJcbiAgICAgICAgZ3JvdXBfaWQ6IGJvZHkuZ3JvdXBJZFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBhcGlSZXNwb25zZShjcmVhdGVkT2ZmZXIsIDIwMSwgJ09mZXJ0YSBzdWJza3J5cGNqaSB6b3N0YcWCYSB1dHdvcnpvbmEgcG9tecWbbG5pZScpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIGhhbmRsZUFwaUVycm9yKGVycm9yLCAnRmFpbGVkIHRvIGNyZWF0ZSBzdWJzY3JpcHRpb24gb2ZmZXInKTtcclxuICAgIH1cclxuICB9KShyZXF1ZXN0LCB7fSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTcHJhd2R6YSB1cHJhd25pZW5pYSB1xbx5dGtvd25pa2EgdyBncnVwaWVcclxuICogQHBhcmFtIHtzdHJpbmd9IGdyb3VwSWQgLSBJRCBncnVweVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gSUQgdcW8eXRrb3duaWthXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIEN6eSB1xbx5dGtvd25payBtYSB1cHJhd25pZW5pYVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY2hlY2tHcm91cFBlcm1pc3Npb24oZ3JvdXBJZCwgdXNlcklkKSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFNwcmF3ZMW6LCBjenkgdcW8eXRrb3duaWsgamVzdCB3xYJhxZtjaWNpZWxlbSBncnVweVxyXG4gICAgY29uc3QgeyBkYXRhOiBncm91cCB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnZ3JvdXBzJylcclxuICAgICAgLnNlbGVjdCgnb3duZXJfaWQnKVxyXG4gICAgICAuZXEoJ2lkJywgZ3JvdXBJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZ3JvdXAgJiYgZ3JvdXAub3duZXJfaWQgPT09IHVzZXJJZCkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gSmXFm2xpIG5pZSBqZXN0IHfFgmHFm2NpY2llbGVtLCBzcHJhd2TFuiBjenkgamVzdCBhZG1pbmVtXHJcbiAgICBjb25zdCB7IGRhdGE6IG1lbWJlcnNoaXAgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ2dyb3VwX21lbWJlcnMnKVxyXG4gICAgICAuc2VsZWN0KCdyb2xlJylcclxuICAgICAgLmVxKCdncm91cF9pZCcsIGdyb3VwSWQpXHJcbiAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgLmVxKCdzdGF0dXMnLCAnYWN0aXZlJylcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICByZXR1cm4gbWVtYmVyc2hpcCAmJiBtZW1iZXJzaGlwLnJvbGUgPT09ICdhZG1pbic7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIGdyb3VwIHBlcm1pc3Npb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFphcGlzdWplIGluc3RydWtjamUgZG9zdMSZcHUgZGxhIG9mZXJ0eVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gZ3JvdXBTdWJJZCAtIElEIG9mZXJ0eVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5zdHJ1Y3Rpb25zIC0gSW5zdHJ1a2NqZSBkb3N0xJlwdVxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSBDenkgb3BlcmFjamEgc2nEmSBwb3dpb2TFgmFcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNhdmVBY2Nlc3NJbnN0cnVjdGlvbnMoZ3JvdXBTdWJJZCwgaW5zdHJ1Y3Rpb25zKSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFBvYmllcnogbHViIHd5Z2VuZXJ1aiBrbHVjeiBzenlmcm93YW5pYVxyXG4gICAgbGV0IGVuY3J5cHRpb25LZXlJZDtcclxuICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdLZXkgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ2VuY3J5cHRpb25fa2V5cycpXHJcbiAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgLmVxKCdrZXlfdHlwZScsICdtYXN0ZXInKVxyXG4gICAgICAuZXEoJ2FjdGl2ZScsIHRydWUpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGV4aXN0aW5nS2V5KSB7XHJcbiAgICAgIGVuY3J5cHRpb25LZXlJZCA9IGV4aXN0aW5nS2V5LmlkO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gR2VuZXJ1aiBub3d5IGtsdWN6XHJcbiAgICAgIGNvbnN0IG5ld0tleSA9IHtcclxuICAgICAgICBrZXlfdHlwZTogJ21hc3RlcicsXHJcbiAgICAgICAgcHVibGljX2tleTogJ2R1bW15X3B1YmxpY19rZXlfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKSxcclxuICAgICAgICBwcml2YXRlX2tleV9lbmM6ICdkdW1teV9lbmNyeXB0ZWRfcHJpdmF0ZV9rZXlfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyKSxcclxuICAgICAgICBhY3RpdmU6IHRydWUsXHJcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB7IGRhdGE6IGNyZWF0ZWRLZXkgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgnZW5jcnlwdGlvbl9rZXlzJylcclxuICAgICAgICAuaW5zZXJ0KFtuZXdLZXldKVxyXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcclxuICAgICAgICAuc2luZ2xlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgIGVuY3J5cHRpb25LZXlJZCA9IGNyZWF0ZWRLZXk/LmlkO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoIWVuY3J5cHRpb25LZXlJZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBnZXQgb3IgY3JlYXRlIGVuY3J5cHRpb24ga2V5Jyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFwiU3p5ZnJvd2FuaWVcIiBpbnN0cnVrY2ppXHJcbiAgICBjb25zdCBlbmNyeXB0ZWREYXRhID0gJ0VOQ1JZUFRFRDonICsgQnVmZmVyLmZyb20oaW5zdHJ1Y3Rpb25zKS50b1N0cmluZygnYmFzZTY0Jyk7XHJcbiAgICBjb25zdCBpdiA9IGdlbmVyYXRlUmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcclxuICAgIGNvbnN0IGRhdGFLZXlFbmMgPSAnZHVtbXlfa2V5X2VuY18nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpO1xyXG4gICAgXHJcbiAgICAvLyBaYXBpc3ogaW5zdHJ1a2NqZVxyXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnYWNjZXNzX2luc3RydWN0aW9ucycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIGdyb3VwX3N1Yl9pZDogZ3JvdXBTdWJJZCxcclxuICAgICAgICBlbmNyeXB0ZWRfZGF0YTogZW5jcnlwdGVkRGF0YSxcclxuICAgICAgICBkYXRhX2tleV9lbmM6IGRhdGFLZXlFbmMsXHJcbiAgICAgICAgZW5jcnlwdGlvbl9rZXlfaWQ6IGVuY3J5cHRpb25LZXlJZCxcclxuICAgICAgICBpdjogaXYsXHJcbiAgICAgICAgZW5jcnlwdGlvbl92ZXJzaW9uOiAnMS4wJyxcclxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIH0pO1xyXG4gICAgXHJcbiAgICByZXR1cm4gIWVycm9yO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgYWNjZXNzIGluc3RydWN0aW9uczonLCBlcnJvcik7XHJcbiAgICAvLyBLb250eW51dWplbXkgbWltbyBixYLEmWR1LCBnxYLDs3duYSBmdW5rY2pvbmFsbm/Fm8SHIHpvc3RhxYJhIHd5a29uYW5hXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogTG9ndWplIHpkYXJ6ZW5pZSBiZXpwaWVjemXFhHN0d2FcclxuICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIElEIHXFvHl0a293bmlrYVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uVHlwZSAtIFR5cCBha2NqaVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVzb3VyY2VUeXBlIC0gVHlwIHphc29idVxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVzb3VyY2VJZCAtIElEIHphc29idVxyXG4gKiBAcGFyYW0ge09iamVjdH0gZGV0YWlscyAtIERvZGF0a293ZSBzemN6ZWfDs8WCeVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gbG9nU2VjdXJpdHlFdmVudCh1c2VySWQsIGFjdGlvblR5cGUsIHJlc291cmNlVHlwZSwgcmVzb3VyY2VJZCwgZGV0YWlscyA9IHt9KSB7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2xvZ3MnKVxyXG4gICAgICAuaW5zZXJ0KHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgYWN0aW9uX3R5cGU6IGFjdGlvblR5cGUsXHJcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxyXG4gICAgICAgIHJlc291cmNlX2lkOiBTdHJpbmcocmVzb3VyY2VJZCksXHJcbiAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXHJcbiAgICAgICAgZGV0YWlsczogZGV0YWlscyxcclxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgc2VjdXJpdHkgZXZlbnQ6JywgZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEZ1bmtjamEgZ2VuZXJ1asSFY2EgbG9zb3dlIGJhanR5IChhbHRlcm5hdHl3YSBkbGEgY3J5cHRvLnJhbmRvbUJ5dGVzKVxyXG4gKiBabWllbmlvbm8gbmF6d8SZIHogY3J5cHRvKCkgbmEgZ2VuZXJhdGVSYW5kb21CeXRlcygpIGFieSB1bmlrbsSFxIcga29uZmxpa3R1XHJcbiAqL1xyXG5mdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbUJ5dGVzKHNpemUpIHtcclxuICBjb25zdCB2YWx1ZXMgPSBuZXcgVWludDhBcnJheShzaXplKTtcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykge1xyXG4gICAgdmFsdWVzW2ldID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIHRvU3RyaW5nOiAoZW5jb2RpbmcpID0+IHtcclxuICAgICAgaWYgKGVuY29kaW5nID09PSAnaGV4Jykge1xyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHZhbHVlcylcclxuICAgICAgICAgIC5tYXAoYiA9PiBiLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpKVxyXG4gICAgICAgICAgLmpvaW4oJycpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHZhbHVlcyk7XHJcbiAgICB9XHJcbiAgfTtcclxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjdXJyZW50VXNlciIsIm9mZmVyc1JlcG9zaXRvcnkiLCJ1c2VyUmVwb3NpdG9yeSIsImhhbmRsZUFwaUVycm9yIiwiYXBpUmVzcG9uc2UiLCJ2YWxpZGF0ZVJlcXVlc3RCb2R5IiwicHJvdGVjdEFwaVJvdXRlIiwiY3J5cHRvIiwiY3JlYXRlT2ZmZXJTY2hlbWEiLCJncm91cElkIiwicmVxdWlyZWQiLCJwbGF0Zm9ybUlkIiwic2xvdHNUb3RhbCIsInR5cGUiLCJtaW4iLCJwcmljZVBlclNsb3QiLCJhY2Nlc3NJbnN0cnVjdGlvbnMiLCJtaW5MZW5ndGgiLCJjdXJyZW5jeSIsIkdFVCIsInJlcXVlc3QiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJmaWx0ZXJzIiwiZ2V0IiwibWluUHJpY2UiLCJwYXJzZUZsb2F0IiwidW5kZWZpbmVkIiwibWF4UHJpY2UiLCJhdmFpbGFibGVTbG90cyIsIm9yZGVyQnkiLCJhc2NlbmRpbmciLCJsaW1pdCIsInBhcnNlSW50IiwicGFnZSIsIm9mZnNldCIsIm9mZmVycyIsImdldEFsbCIsImVycm9yIiwiUE9TVCIsInJlcSIsImJvZHkiLCJqc29uIiwiaXNWYWxpZCIsImVycm9ycyIsImRldGFpbHMiLCJzdGF0dXMiLCJ1c2VyIiwidXNlclByb2ZpbGUiLCJnZXRCeUF1dGhJZCIsImlkIiwiaXNBdXRob3JpemVkIiwiY2hlY2tHcm91cFBlcm1pc3Npb24iLCJvZmZlckRhdGEiLCJncm91cF9pZCIsInBsYXRmb3JtX2lkIiwic2xvdHNfdG90YWwiLCJzbG90c19hdmFpbGFibGUiLCJwcmljZV9wZXJfc2xvdCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkX2F0IiwiY3JlYXRlZE9mZmVyIiwiY3JlYXRlIiwiRXJyb3IiLCJzYXZlQWNjZXNzSW5zdHJ1Y3Rpb25zIiwibG9nU2VjdXJpdHlFdmVudCIsInVzZXJJZCIsImRhdGEiLCJncm91cCIsInN1cGFiYXNlQWRtaW4iLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJvd25lcl9pZCIsIm1lbWJlcnNoaXAiLCJyb2xlIiwiY29uc29sZSIsImdyb3VwU3ViSWQiLCJpbnN0cnVjdGlvbnMiLCJlbmNyeXB0aW9uS2V5SWQiLCJleGlzdGluZ0tleSIsIm5ld0tleSIsImtleV90eXBlIiwicHVibGljX2tleSIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsInByaXZhdGVfa2V5X2VuYyIsImFjdGl2ZSIsImNyZWF0ZWRLZXkiLCJpbnNlcnQiLCJlbmNyeXB0ZWREYXRhIiwiQnVmZmVyIiwiaXYiLCJnZW5lcmF0ZVJhbmRvbUJ5dGVzIiwiZGF0YUtleUVuYyIsImdyb3VwX3N1Yl9pZCIsImVuY3J5cHRlZF9kYXRhIiwiZGF0YV9rZXlfZW5jIiwiZW5jcnlwdGlvbl9rZXlfaWQiLCJlbmNyeXB0aW9uX3ZlcnNpb24iLCJhY3Rpb25UeXBlIiwicmVzb3VyY2VUeXBlIiwicmVzb3VyY2VJZCIsInVzZXJfaWQiLCJhY3Rpb25fdHlwZSIsInJlc291cmNlX3R5cGUiLCJyZXNvdXJjZV9pZCIsIlN0cmluZyIsInNpemUiLCJ2YWx1ZXMiLCJVaW50OEFycmF5IiwiaSIsImZsb29yIiwiZW5jb2RpbmciLCJBcnJheSIsIm1hcCIsImIiLCJwYWRTdGFydCIsImpvaW4iLCJmcm9tQ2hhckNvZGUiLCJhcHBseSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/offers/route.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/api/error-handler.js":
/*!**************************************!*\
  !*** ./src/lib/api/error-handler.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   apiResponse: () => (/* binding */ apiResponse),\n/* harmony export */   handleApiError: () => (/* binding */ handleApiError),\n/* harmony export */   protectApiRoute: () => (/* binding */ protectApiRoute),\n/* harmony export */   validateRequestBody: () => (/* binding */ validateRequestBody)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n// src/lib/api/error-handler.js\n\n/**\r\n * Standardowa obsługa błędów API\r\n * @param {Error} error - Obiekt błędu\r\n * @param {number} defaultStatus - Domyślny kod statusu HTTP (opcjonalny, domyślnie 500)\r\n * @returns {NextResponse} - Ujednolicona odpowiedź błędu\r\n */ function handleApiError(error, defaultStatus = 500) {\n    console.error(\"API error:\", error);\n    // Określ szczegóły błędu na podstawie typu\n    let status = defaultStatus;\n    let message = error.message || \"Wystąpił nieoczekiwany błąd\";\n    let code = error.code || \"unknown_error\";\n    let details = error.details || null;\n    // Obsługa standardowych kodów błędów Supabase\n    if (error.code === \"PGRST116\") {\n        // Nie znaleziono rekordu - kod 404\n        status = 404;\n        message = \"Żądany zas\\xf3b nie został znaleziony\";\n        code = \"not_found\";\n    } else if (error.code === \"42501\") {\n        // Brak uprawnień - kod 403\n        status = 403;\n        message = \"Brak uprawnień do wykonania tej operacji\";\n        code = \"permission_denied\";\n    } else if (error.code === \"23505\") {\n        // Konflikt unikalności - kod 409\n        status = 409;\n        message = \"Zas\\xf3b o podanych danych już istnieje\";\n        code = \"resource_conflict\";\n    } else if (error.code === \"23502\") {\n        // Brak wymaganego pola - kod 400\n        status = 400;\n        message = \"Brak wymaganego pola\";\n        code = \"missing_required_field\";\n    }\n    // Zwróć ustandaryzowaną odpowiedź błędu\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: true,\n        message,\n        code,\n        details,\n        timestamp: new Date().toISOString()\n    }, {\n        status\n    });\n}\n/**\r\n * Generator odpowiedzi sukcesu API\r\n * @param {any} data - Dane do zwrócenia\r\n * @param {number} status - Kod statusu HTTP (opcjonalny, domyślnie 200)\r\n * @param {string} message - Opcjonalna wiadomość sukcesu\r\n * @returns {NextResponse} - Ujednolicona odpowiedź sukcesu\r\n */ function apiResponse(data, status = 200, message = null) {\n    const response = {\n        success: true,\n        data\n    };\n    if (message) {\n        response.message = message;\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response, {\n        status\n    });\n}\n/**\r\n * Sprawdza, czy żądanie zawiera poprawne dane\r\n * @param {Object} schema - Schemat walidacji (prosty obiekt z polami i warunkami)\r\n * @param {Object} body - Ciało żądania do walidacji\r\n * @returns {Object} - Obiekt { isValid, errors }\r\n */ function validateRequestBody(schema, body) {\n    const errors = {};\n    let isValid = true;\n    // Sprawdź, czy wszystkie wymagane pola są obecne\n    for (const [field, requirements] of Object.entries(schema)){\n        if (requirements.required && (body[field] === undefined || body[field] === null || body[field] === \"\")) {\n            errors[field] = `Pole '${field}' jest wymagane`;\n            isValid = false;\n            continue;\n        }\n        if (body[field] === undefined) continue;\n        // Sprawdź typ\n        if (requirements.type && typeof body[field] !== requirements.type) {\n            errors[field] = `Pole '${field}' musi być typu ${requirements.type}`;\n            isValid = false;\n        }\n        // Sprawdź minimalną wartość dla liczb\n        if (requirements.min !== undefined && typeof body[field] === \"number\" && body[field] < requirements.min) {\n            errors[field] = `Pole '${field}' musi być większe lub równe ${requirements.min}`;\n            isValid = false;\n        }\n        // Sprawdź maksymalną wartość dla liczb\n        if (requirements.max !== undefined && typeof body[field] === \"number\" && body[field] > requirements.max) {\n            errors[field] = `Pole '${field}' musi być mniejsze lub równe ${requirements.max}`;\n            isValid = false;\n        }\n        // Sprawdź minimalną długość dla stringów\n        if (requirements.minLength !== undefined && typeof body[field] === \"string\" && body[field].length < requirements.minLength) {\n            errors[field] = `Pole '${field}' musi mieć co najmniej ${requirements.minLength} znaków`;\n            isValid = false;\n        }\n        // Sprawdź maksymalną długość dla stringów\n        if (requirements.maxLength !== undefined && typeof body[field] === \"string\" && body[field].length > requirements.maxLength) {\n            errors[field] = `Pole '${field}' może mieć maksymalnie ${requirements.maxLength} znaków`;\n            isValid = false;\n        }\n        // Sprawdź wzorzec regex\n        if (requirements.pattern && typeof body[field] === \"string\" && !requirements.pattern.test(body[field])) {\n            errors[field] = requirements.patternMessage || `Pole '${field}' ma nieprawidłowy format`;\n            isValid = false;\n        }\n    }\n    return {\n        isValid,\n        errors\n    };\n}\n/**\r\n * Główna funkcja ochrony API - weryfikuje, autoryzuje i waliduje żądanie\r\n * @param {Function} handler - Funkcja obsługi żądania API\r\n * @param {Object} options - Opcje ochrony\r\n * @returns {Function} - Middleware zabezpieczające funkcję API\r\n */ function protectApiRoute(handler, options = {}) {\n    const { requireAuth = true, requiredRole = null, validationSchema = null } = options;\n    return async (request, context)=>{\n        try {\n            // 1. Sprawdź uwierzytelnienie, jeśli wymagane\n            if (requireAuth) {\n                const user = await currentUser();\n                if (!user) {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: true,\n                        message: \"Unauthorized\",\n                        code: \"unauthorized\"\n                    }, {\n                        status: 401\n                    });\n                }\n                // Dołącz użytkownika do kontekstu dla funkcji obsługi\n                context.user = user;\n                // Sprawdź rolę, jeśli wymagana\n                if (requiredRole) {\n                    // Implementacja sprawdzania roli (uproszczona)\n                    const hasRole = await checkUserRole(user, requiredRole);\n                    if (!hasRole) {\n                        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                            error: true,\n                            message: \"Insufficient permissions\",\n                            code: \"forbidden\"\n                        }, {\n                            status: 403\n                        });\n                    }\n                }\n            }\n            // 2. Sprawdź, czy mamy schemat walidacji dla metody POST/PUT/PATCH\n            if (validationSchema && [\n                \"POST\",\n                \"PUT\",\n                \"PATCH\"\n            ].includes(request.method)) {\n                const body = await request.json().catch(()=>({}));\n                const { isValid, errors } = validateRequestBody(validationSchema, body);\n                if (!isValid) {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: true,\n                        message: \"Validation failed\",\n                        code: \"validation_error\",\n                        details: errors\n                    }, {\n                        status: 400\n                    });\n                }\n                // Przekaż zwalidowane dane do handlera\n                request.validatedBody = body;\n            }\n            // 3. Przekaż do właściwego handlera\n            return handler(request, context);\n        } catch (error) {\n            return handleApiError(error);\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBUztvQkFDWixPQUFPckIscURBQVlBLENBQUNTLElBQUksQ0FDdEI7d0JBQUVQLE9BQU87d0JBQU1JLFNBQVM7d0JBQXFCQyxNQUFNO3dCQUFvQkMsU0FBU1k7b0JBQU8sR0FDdkY7d0JBQUVmLFFBQVE7b0JBQUk7Z0JBRWxCO2dCQUVBLHVDQUF1QztnQkFDdkNzQyxRQUFRUyxhQUFhLEdBQUdqQztZQUMxQjtZQUVBLG9DQUFvQztZQUNwQyxPQUFPbUIsUUFBUUssU0FBU0M7UUFDMUIsRUFBRSxPQUFPMUMsT0FBTztZQUNkLE9BQU9ELGVBQWVDO1FBQ3hCO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8uL3NyYy9saWIvYXBpL2Vycm9yLWhhbmRsZXIuanM/Y2EwYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL2FwaS9lcnJvci1oYW5kbGVyLmpzXHJcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuXHJcbi8qKlxyXG4gKiBTdGFuZGFyZG93YSBvYnPFgnVnYSBixYLEmWTDs3cgQVBJXHJcbiAqIEBwYXJhbSB7RXJyb3J9IGVycm9yIC0gT2JpZWt0IGLFgsSZZHVcclxuICogQHBhcmFtIHtudW1iZXJ9IGRlZmF1bHRTdGF0dXMgLSBEb215xZtsbnkga29kIHN0YXR1c3UgSFRUUCAob3Bjam9uYWxueSwgZG9tecWbbG5pZSA1MDApXHJcbiAqIEByZXR1cm5zIHtOZXh0UmVzcG9uc2V9IC0gVWplZG5vbGljb25hIG9kcG93aWVkxbogYsWCxJlkdVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUFwaUVycm9yKGVycm9yLCBkZWZhdWx0U3RhdHVzID0gNTAwKSB7XHJcbiAgY29uc29sZS5lcnJvcignQVBJIGVycm9yOicsIGVycm9yKTtcclxuICBcclxuICAvLyBPa3JlxZtsIHN6Y3plZ8OzxYJ5IGLFgsSZZHUgbmEgcG9kc3Rhd2llIHR5cHVcclxuICBsZXQgc3RhdHVzID0gZGVmYXVsdFN0YXR1cztcclxuICBsZXQgbWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UgfHwgJ1d5c3TEhXBpxYIgbmllb2N6ZWtpd2FueSBixYLEhWQnO1xyXG4gIGxldCBjb2RlID0gZXJyb3IuY29kZSB8fCAndW5rbm93bl9lcnJvcic7XHJcbiAgbGV0IGRldGFpbHMgPSBlcnJvci5kZXRhaWxzIHx8IG51bGw7XHJcbiAgXHJcbiAgLy8gT2JzxYJ1Z2Egc3RhbmRhcmRvd3ljaCBrb2TDs3cgYsWCxJlkw7N3IFN1cGFiYXNlXHJcbiAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgIC8vIE5pZSB6bmFsZXppb25vIHJla29yZHUgLSBrb2QgNDA0XHJcbiAgICBzdGF0dXMgPSA0MDQ7XHJcbiAgICBtZXNzYWdlID0gJ8W7xIVkYW55IHphc8OzYiBuaWUgem9zdGHFgiB6bmFsZXppb255JztcclxuICAgIGNvZGUgPSAnbm90X2ZvdW5kJztcclxuICB9IGVsc2UgaWYgKGVycm9yLmNvZGUgPT09ICc0MjUwMScpIHtcclxuICAgIC8vIEJyYWsgdXByYXduaWXFhCAtIGtvZCA0MDNcclxuICAgIHN0YXR1cyA9IDQwMztcclxuICAgIG1lc3NhZ2UgPSAnQnJhayB1cHJhd25pZcWEIGRvIHd5a29uYW5pYSB0ZWogb3BlcmFjamknO1xyXG4gICAgY29kZSA9ICdwZXJtaXNzaW9uX2RlbmllZCc7XHJcbiAgfSBlbHNlIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XHJcbiAgICAvLyBLb25mbGlrdCB1bmlrYWxub8WbY2kgLSBrb2QgNDA5XHJcbiAgICBzdGF0dXMgPSA0MDk7XHJcbiAgICBtZXNzYWdlID0gJ1phc8OzYiBvIHBvZGFueWNoIGRhbnljaCBqdcW8IGlzdG5pZWplJztcclxuICAgIGNvZGUgPSAncmVzb3VyY2VfY29uZmxpY3QnO1xyXG4gIH0gZWxzZSBpZiAoZXJyb3IuY29kZSA9PT0gJzIzNTAyJykge1xyXG4gICAgLy8gQnJhayB3eW1hZ2FuZWdvIHBvbGEgLSBrb2QgNDAwXHJcbiAgICBzdGF0dXMgPSA0MDA7XHJcbiAgICBtZXNzYWdlID0gJ0JyYWsgd3ltYWdhbmVnbyBwb2xhJztcclxuICAgIGNvZGUgPSAnbWlzc2luZ19yZXF1aXJlZF9maWVsZCc7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIFp3csOzxIcgdXN0YW5kYXJ5em93YW7EhSBvZHBvd2llZMW6IGLFgsSZZHVcclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICB7IFxyXG4gICAgICBlcnJvcjogdHJ1ZSwgXHJcbiAgICAgIG1lc3NhZ2UsIFxyXG4gICAgICBjb2RlLCBcclxuICAgICAgZGV0YWlscywgXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIFxyXG4gICAgfSwgXHJcbiAgICB7IHN0YXR1cyB9XHJcbiAgKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdlbmVyYXRvciBvZHBvd2llZHppIHN1a2Nlc3UgQVBJXHJcbiAqIEBwYXJhbSB7YW55fSBkYXRhIC0gRGFuZSBkbyB6d3LDs2NlbmlhXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGF0dXMgLSBLb2Qgc3RhdHVzdSBIVFRQIChvcGNqb25hbG55LCBkb215xZtsbmllIDIwMClcclxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBPcGNqb25hbG5hIHdpYWRvbW/Fm8SHIHN1a2Nlc3VcclxuICogQHJldHVybnMge05leHRSZXNwb25zZX0gLSBVamVkbm9saWNvbmEgb2Rwb3dpZWTFuiBzdWtjZXN1XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gYXBpUmVzcG9uc2UoZGF0YSwgc3RhdHVzID0gMjAwLCBtZXNzYWdlID0gbnVsbCkge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgc3VjY2VzczogdHJ1ZSxcclxuICAgIGRhdGFcclxuICB9O1xyXG4gIFxyXG4gIGlmIChtZXNzYWdlKSB7XHJcbiAgICByZXNwb25zZS5tZXNzYWdlID0gbWVzc2FnZTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlLCB7IHN0YXR1cyB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNwcmF3ZHphLCBjenkgxbzEhWRhbmllIHphd2llcmEgcG9wcmF3bmUgZGFuZVxyXG4gKiBAcGFyYW0ge09iamVjdH0gc2NoZW1hIC0gU2NoZW1hdCB3YWxpZGFjamkgKHByb3N0eSBvYmlla3QgeiBwb2xhbWkgaSB3YXJ1bmthbWkpXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBib2R5IC0gQ2lhxYJvIMW8xIVkYW5pYSBkbyB3YWxpZGFjamlcclxuICogQHJldHVybnMge09iamVjdH0gLSBPYmlla3QgeyBpc1ZhbGlkLCBlcnJvcnMgfVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUmVxdWVzdEJvZHkoc2NoZW1hLCBib2R5KSB7XHJcbiAgY29uc3QgZXJyb3JzID0ge307XHJcbiAgbGV0IGlzVmFsaWQgPSB0cnVlO1xyXG4gIFxyXG4gIC8vIFNwcmF3ZMW6LCBjenkgd3N6eXN0a2llIHd5bWFnYW5lIHBvbGEgc8SFIG9iZWNuZVxyXG4gIGZvciAoY29uc3QgW2ZpZWxkLCByZXF1aXJlbWVudHNdIG9mIE9iamVjdC5lbnRyaWVzKHNjaGVtYSkpIHtcclxuICAgIGlmIChyZXF1aXJlbWVudHMucmVxdWlyZWQgJiYgKGJvZHlbZmllbGRdID09PSB1bmRlZmluZWQgfHwgYm9keVtmaWVsZF0gPT09IG51bGwgfHwgYm9keVtmaWVsZF0gPT09ICcnKSkge1xyXG4gICAgICBlcnJvcnNbZmllbGRdID0gYFBvbGUgJyR7ZmllbGR9JyBqZXN0IHd5bWFnYW5lYDtcclxuICAgICAgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgICBjb250aW51ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGJvZHlbZmllbGRdID09PSB1bmRlZmluZWQpIGNvbnRpbnVlO1xyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiB0eXBcclxuICAgIGlmIChyZXF1aXJlbWVudHMudHlwZSAmJiB0eXBlb2YgYm9keVtmaWVsZF0gIT09IHJlcXVpcmVtZW50cy50eXBlKSB7XHJcbiAgICAgIGVycm9yc1tmaWVsZF0gPSBgUG9sZSAnJHtmaWVsZH0nIG11c2kgYnnEhyB0eXB1ICR7cmVxdWlyZW1lbnRzLnR5cGV9YDtcclxuICAgICAgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiBtaW5pbWFsbsSFIHdhcnRvxZvEhyBkbGEgbGljemJcclxuICAgIGlmIChyZXF1aXJlbWVudHMubWluICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIGJvZHlbZmllbGRdID09PSAnbnVtYmVyJyAmJiBib2R5W2ZpZWxkXSA8IHJlcXVpcmVtZW50cy5taW4pIHtcclxuICAgICAgZXJyb3JzW2ZpZWxkXSA9IGBQb2xlICcke2ZpZWxkfScgbXVzaSBiecSHIHdpxJlrc3plIGx1YiByw7N3bmUgJHtyZXF1aXJlbWVudHMubWlufWA7XHJcbiAgICAgIGlzVmFsaWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gU3ByYXdkxbogbWFrc3ltYWxuxIUgd2FydG/Fm8SHIGRsYSBsaWN6YlxyXG4gICAgaWYgKHJlcXVpcmVtZW50cy5tYXggIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgYm9keVtmaWVsZF0gPT09ICdudW1iZXInICYmIGJvZHlbZmllbGRdID4gcmVxdWlyZW1lbnRzLm1heCkge1xyXG4gICAgICBlcnJvcnNbZmllbGRdID0gYFBvbGUgJyR7ZmllbGR9JyBtdXNpIGJ5xIcgbW5pZWpzemUgbHViIHLDs3duZSAke3JlcXVpcmVtZW50cy5tYXh9YDtcclxuICAgICAgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiBtaW5pbWFsbsSFIGTFgnVnb8WbxIcgZGxhIHN0cmluZ8Ozd1xyXG4gICAgaWYgKHJlcXVpcmVtZW50cy5taW5MZW5ndGggIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgYm9keVtmaWVsZF0gPT09ICdzdHJpbmcnICYmIGJvZHlbZmllbGRdLmxlbmd0aCA8IHJlcXVpcmVtZW50cy5taW5MZW5ndGgpIHtcclxuICAgICAgZXJyb3JzW2ZpZWxkXSA9IGBQb2xlICcke2ZpZWxkfScgbXVzaSBtaWXEhyBjbyBuYWptbmllaiAke3JlcXVpcmVtZW50cy5taW5MZW5ndGh9IHpuYWvDs3dgO1xyXG4gICAgICBpc1ZhbGlkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFNwcmF3ZMW6IG1ha3N5bWFsbsSFIGTFgnVnb8WbxIcgZGxhIHN0cmluZ8Ozd1xyXG4gICAgaWYgKHJlcXVpcmVtZW50cy5tYXhMZW5ndGggIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgYm9keVtmaWVsZF0gPT09ICdzdHJpbmcnICYmIGJvZHlbZmllbGRdLmxlbmd0aCA+IHJlcXVpcmVtZW50cy5tYXhMZW5ndGgpIHtcclxuICAgICAgZXJyb3JzW2ZpZWxkXSA9IGBQb2xlICcke2ZpZWxkfScgbW/FvGUgbWllxIcgbWFrc3ltYWxuaWUgJHtyZXF1aXJlbWVudHMubWF4TGVuZ3RofSB6bmFrw7N3YDtcclxuICAgICAgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiB3em9yemVjIHJlZ2V4XHJcbiAgICBpZiAocmVxdWlyZW1lbnRzLnBhdHRlcm4gJiYgdHlwZW9mIGJvZHlbZmllbGRdID09PSAnc3RyaW5nJyAmJiAhcmVxdWlyZW1lbnRzLnBhdHRlcm4udGVzdChib2R5W2ZpZWxkXSkpIHtcclxuICAgICAgZXJyb3JzW2ZpZWxkXSA9IHJlcXVpcmVtZW50cy5wYXR0ZXJuTWVzc2FnZSB8fCBgUG9sZSAnJHtmaWVsZH0nIG1hIG5pZXByYXdpZMWCb3d5IGZvcm1hdGA7XHJcbiAgICAgIGlzVmFsaWQgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHsgaXNWYWxpZCwgZXJyb3JzIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHxYLDs3duYSBmdW5rY2phIG9jaHJvbnkgQVBJIC0gd2VyeWZpa3VqZSwgYXV0b3J5enVqZSBpIHdhbGlkdWplIMW8xIVkYW5pZVxyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIC0gRnVua2NqYSBvYnPFgnVnaSDFvMSFZGFuaWEgQVBJXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3BjamUgb2Nocm9ueVxyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IC0gTWlkZGxld2FyZSB6YWJlenBpZWN6YWrEhWNlIGZ1bmtjasSZIEFQSVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHByb3RlY3RBcGlSb3V0ZShoYW5kbGVyLCBvcHRpb25zID0ge30pIHtcclxuICBjb25zdCB7IHJlcXVpcmVBdXRoID0gdHJ1ZSwgcmVxdWlyZWRSb2xlID0gbnVsbCwgdmFsaWRhdGlvblNjaGVtYSA9IG51bGwgfSA9IG9wdGlvbnM7XHJcbiAgXHJcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyAxLiBTcHJhd2TFuiB1d2llcnp5dGVsbmllbmllLCBqZcWbbGkgd3ltYWdhbmVcclxuICAgICAgaWYgKHJlcXVpcmVBdXRoKSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICAgIHsgZXJyb3I6IHRydWUsIG1lc3NhZ2U6ICdVbmF1dGhvcml6ZWQnLCBjb2RlOiAndW5hdXRob3JpemVkJyB9LFxyXG4gICAgICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIERvxYLEhWN6IHXFvHl0a293bmlrYSBkbyBrb250ZWtzdHUgZGxhIGZ1bmtjamkgb2JzxYJ1Z2lcclxuICAgICAgICBjb250ZXh0LnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFNwcmF3ZMW6IHJvbMSZLCBqZcWbbGkgd3ltYWdhbmFcclxuICAgICAgICBpZiAocmVxdWlyZWRSb2xlKSB7XHJcbiAgICAgICAgICAvLyBJbXBsZW1lbnRhY2phIHNwcmF3ZHphbmlhIHJvbGkgKHVwcm9zemN6b25hKVxyXG4gICAgICAgICAgY29uc3QgaGFzUm9sZSA9IGF3YWl0IGNoZWNrVXNlclJvbGUodXNlciwgcmVxdWlyZWRSb2xlKTtcclxuICAgICAgICAgIGlmICghaGFzUm9sZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICAgICAgeyBlcnJvcjogdHJ1ZSwgbWVzc2FnZTogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycsIGNvZGU6ICdmb3JiaWRkZW4nIH0sXHJcbiAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwMyB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyAyLiBTcHJhd2TFuiwgY3p5IG1hbXkgc2NoZW1hdCB3YWxpZGFjamkgZGxhIG1ldG9keSBQT1NUL1BVVC9QQVRDSFxyXG4gICAgICBpZiAodmFsaWRhdGlvblNjaGVtYSAmJiBbJ1BPU1QnLCAnUFVUJywgJ1BBVENIJ10uaW5jbHVkZXMocmVxdWVzdC5tZXRob2QpKSB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpLmNhdGNoKCgpID0+ICh7fSkpO1xyXG4gICAgICAgIGNvbnN0IHsgaXNWYWxpZCwgZXJyb3JzIH0gPSB2YWxpZGF0ZVJlcXVlc3RCb2R5KHZhbGlkYXRpb25TY2hlbWEsIGJvZHkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgICB7IGVycm9yOiB0cnVlLCBtZXNzYWdlOiAnVmFsaWRhdGlvbiBmYWlsZWQnLCBjb2RlOiAndmFsaWRhdGlvbl9lcnJvcicsIGRldGFpbHM6IGVycm9ycyB9LFxyXG4gICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByemVrYcW8IHp3YWxpZG93YW5lIGRhbmUgZG8gaGFuZGxlcmFcclxuICAgICAgICByZXF1ZXN0LnZhbGlkYXRlZEJvZHkgPSBib2R5O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyAzLiBQcnpla2HFvCBkbyB3xYJhxZtjaXdlZ28gaGFuZGxlcmFcclxuICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgY29udGV4dCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gaGFuZGxlQXBpRXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiaGFuZGxlQXBpRXJyb3IiLCJlcnJvciIsImRlZmF1bHRTdGF0dXMiLCJjb25zb2xlIiwic3RhdHVzIiwibWVzc2FnZSIsImNvZGUiLCJkZXRhaWxzIiwianNvbiIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImFwaVJlc3BvbnNlIiwiZGF0YSIsInJlc3BvbnNlIiwic3VjY2VzcyIsInZhbGlkYXRlUmVxdWVzdEJvZHkiLCJzY2hlbWEiLCJib2R5IiwiZXJyb3JzIiwiaXNWYWxpZCIsImZpZWxkIiwicmVxdWlyZW1lbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsInJlcXVpcmVkIiwidW5kZWZpbmVkIiwidHlwZSIsIm1pbiIsIm1heCIsIm1pbkxlbmd0aCIsImxlbmd0aCIsIm1heExlbmd0aCIsInBhdHRlcm4iLCJ0ZXN0IiwicGF0dGVybk1lc3NhZ2UiLCJwcm90ZWN0QXBpUm91dGUiLCJoYW5kbGVyIiwib3B0aW9ucyIsInJlcXVpcmVBdXRoIiwicmVxdWlyZWRSb2xlIiwidmFsaWRhdGlvblNjaGVtYSIsInJlcXVlc3QiLCJjb250ZXh0IiwidXNlciIsImN1cnJlbnRVc2VyIiwiaGFzUm9sZSIsImNoZWNrVXNlclJvbGUiLCJpbmNsdWRlcyIsIm1ldGhvZCIsImNhdGNoIiwidmFsaWRhdGVkQm9keSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/api/error-handler.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/database/supabase-admin-client.js":
/*!***************************************************!*\
  !*** ./src/lib/database/supabase-admin-client.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createUserProfileAdmin: () => (/* binding */ createUserProfileAdmin),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getGroupMembersAdmin: () => (/* binding */ getGroupMembersAdmin),\n/* harmony export */   getSubscriptionPlatformsAdmin: () => (/* binding */ getSubscriptionPlatformsAdmin),\n/* harmony export */   getUserByAuthIdAdmin: () => (/* binding */ getUserByAuthIdAdmin),\n/* harmony export */   handleSupabaseAdminError: () => (/* binding */ handleSupabaseAdminError),\n/* harmony export */   logAdminActivity: () => (/* binding */ logAdminActivity),\n/* harmony export */   updateUserProfileAdmin: () => (/* binding */ updateUserProfileAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// src/lib/supabase-admin-client.js\n\n// Inicjalizacja klienta Supabase z uprawnieniami administratora\nconst supabaseUrl = \"https://nimrnohkesysfppcmujb.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n// Sprawdzenie czy zmienne środowiskowe są ustawione\nif (!supabaseUrl || !supabaseServiceKey) {\n    console.error(\"Missing environment variables: NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\");\n}\n// Uwaga: Ten klient ma pełne uprawnienia do bazy danych, używaj ostrożnie!\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n// Funkcja pomocnicza do obsługi błędów Supabase\nconst handleSupabaseAdminError = (error)=>{\n    console.error(\"Supabase Admin error:\", error);\n    return {\n        error: true,\n        message: error.message || \"Nieoczekiwany błąd administratora\",\n        code: error.code || \"unknown_error\",\n        details: error.details || null\n    };\n};\n// Funkcje administratora do zarządzania użytkownikami\n// Funkcja do tworzenia profilu użytkownika przez administratora\nconst createUserProfileAdmin = async (userProfile)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").insert([\n            userProfile\n        ]).select().single();\n        if (error) {\n            if (error.code === \"23505\") {\n                console.warn(\"Admin: Pr\\xf3ba utworzenia duplikatu profilu użytkownika:\", error);\n                // Jeśli profil już istnieje, pobierz go\n                const { data: existingUser, error: fetchError } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", userProfile.external_auth_id).single();\n                if (fetchError) {\n                    throw new Error(\"Nie można pobrać istniejącego profilu: \" + fetchError.message);\n                }\n                return existingUser;\n            } else {\n                throw new Error(error.message || \"Nie udało się utworzyć profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania profilu użytkownika przez administratora\nconst getUserByAuthIdAdmin = async (authId)=>{\n    if (!authId) return null;\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", authId).single();\n        if (error) {\n            if (error.code === \"PGRST116\") {\n                // Nie znaleziono - to normalny przypadek\n                return null;\n            } else {\n                console.error(\"Admin: Błąd pobierania profilu użytkownika:\", error);\n                throw new Error(error.message || \"Nie udało się pobrać profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do aktualizacji profilu użytkownika przez administratora\nconst updateUserProfileAdmin = async (userId, updates)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").update(updates).eq(\"id\", userId).select().single();\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania platform subskrypcyjnych przez administratora\nconst getSubscriptionPlatformsAdmin = async ()=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"subscription_platforms\").select(\"*\").order(\"name\");\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Funkcja do pobierania członków grupy przez administratora\nconst getGroupMembersAdmin = async (groupId)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"group_members\").select(`\r\n        *,\r\n        user:user_profiles(id, display_name, avatar_url, email)\r\n      `).eq(\"group_id\", groupId);\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Zapisz wszystkie aktywności administratora do logu bezpieczeństwa\nconst logAdminActivity = async (action, resourceType, resourceId, details = {})=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"security_logs\").insert([\n            {\n                action_type: action,\n                resource_type: resourceType,\n                resource_id: resourceId,\n                status: \"success\",\n                details: details\n            }\n        ]);\n        if (error) console.error(\"Błąd logowania aktywności administratora:\", error);\n    } catch (error) {\n        console.error(\"Wyjątek podczas logowania aktywności administratora:\", error);\n    }\n};\n// Eksport klienta administratora jako domyślny\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabaseAdmin);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSxtQ0FBbUM7QUFDa0I7QUFFckQsZ0VBQWdFO0FBQ2hFLE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxxQkFBcUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRWhFLG9EQUFvRDtBQUNwRCxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksb0JBQW9CO0lBQ3ZDRSxRQUFRQyxLQUFLLENBQ1g7QUFFSjtBQUVBLDJFQUEyRTtBQUMzRSxNQUFNQyxnQkFBZ0JULG1FQUFZQSxDQUFDQyxhQUFhSSxvQkFBb0I7SUFDbEVLLE1BQU07UUFDSkMsZ0JBQWdCO1FBQ2hCQyxrQkFBa0I7SUFDcEI7QUFDRjtBQUVBLGdEQUFnRDtBQUN6QyxNQUFNQywyQkFBMkIsQ0FBQ0w7SUFDdkNELFFBQVFDLEtBQUssQ0FBQyx5QkFBeUJBO0lBRXZDLE9BQU87UUFDTEEsT0FBTztRQUNQTSxTQUFTTixNQUFNTSxPQUFPLElBQUk7UUFDMUJDLE1BQU1QLE1BQU1PLElBQUksSUFBSTtRQUNwQkMsU0FBU1IsTUFBTVEsT0FBTyxJQUFJO0lBQzVCO0FBQ0YsRUFBRTtBQUVGLHNEQUFzRDtBQUV0RCxnRUFBZ0U7QUFDekQsTUFBTUMseUJBQXlCLE9BQU9DO0lBQzNDLElBQUk7UUFDRixNQUFNLEVBQUVDLElBQUksRUFBRVgsS0FBSyxFQUFFLEdBQUcsTUFBTUMsY0FDM0JXLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDO1lBQUNIO1NBQVksRUFDcEJJLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlmLE9BQU87WUFDVCxJQUFJQSxNQUFNTyxJQUFJLEtBQUssU0FBUztnQkFDMUJSLFFBQVFpQixJQUFJLENBQUMsNkRBQTBEaEI7Z0JBRXZFLHdDQUF3QztnQkFDeEMsTUFBTSxFQUFFVyxNQUFNTSxZQUFZLEVBQUVqQixPQUFPa0IsVUFBVSxFQUFFLEdB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QyxLQUFLLENBQUMsNkNBQTZDQTtJQUV4RSxFQUFFLE9BQU9BLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHdEQUF3REE7SUFDeEU7QUFDRixFQUFFO0FBRUYsK0NBQStDO0FBQy9DLGlFQUFlQyxhQUFhQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2xpYi9kYXRhYmFzZS9zdXBhYmFzZS1hZG1pbi1jbGllbnQuanM/MzQ3NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qc1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuLy8gSW5pY2phbGl6YWNqYSBrbGllbnRhIFN1cGFiYXNlIHogdXByYXduaWVuaWFtaSBhZG1pbmlzdHJhdG9yYVxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcclxuY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcclxuXHJcbi8vIFNwcmF3ZHplbmllIGN6eSB6bWllbm5lIMWbcm9kb3dpc2tvd2Ugc8SFIHVzdGF3aW9uZVxyXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcclxuICBjb25zb2xlLmVycm9yKFxyXG4gICAgJ01pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzOiBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSdcclxuICApO1xyXG59XHJcblxyXG4vLyBVd2FnYTogVGVuIGtsaWVudCBtYSBwZcWCbmUgdXByYXduaWVuaWEgZG8gYmF6eSBkYW55Y2gsIHXFvHl3YWogb3N0cm/FvG5pZSFcclxuY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XHJcbiAgYXV0aDoge1xyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgfSxcclxufSk7XHJcblxyXG4vLyBGdW5rY2phIHBvbW9jbmljemEgZG8gb2JzxYJ1Z2kgYsWCxJlkw7N3IFN1cGFiYXNlXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICBjb25zb2xlLmVycm9yKCdTdXBhYmFzZSBBZG1pbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGVycm9yOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnTmllb2N6ZWtpd2FueSBixYLEhWQgYWRtaW5pc3RyYXRvcmEnLFxyXG4gICAgY29kZTogZXJyb3IuY29kZSB8fCAndW5rbm93bl9lcnJvcicsXHJcbiAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzIHx8IG51bGwsXHJcbiAgfTtcclxufTtcclxuXHJcbi8vIEZ1bmtjamUgYWRtaW5pc3RyYXRvcmEgZG8gemFyesSFZHphbmlhIHXFvHl0a293bmlrYW1pXHJcblxyXG4vLyBGdW5rY2phIGRvIHR3b3J6ZW5pYSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgY3JlYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VyUHJvZmlsZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLmluc2VydChbdXNlclByb2ZpbGVdKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ0FkbWluOiBQcsOzYmEgdXR3b3J6ZW5pYSBkdXBsaWthdHUgcHJvZmlsdSB1xbx5dGtvd25pa2E6JywgZXJyb3IpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEplxZtsaSBwcm9maWwganXFvCBpc3RuaWVqZSwgcG9iaWVyeiBnb1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdVc2VyLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCB1c2VyUHJvZmlsZS5leHRlcm5hbF9hdXRoX2lkKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgaWYgKGZldGNoRXJyb3IpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTmllIG1vxbxuYSBwb2JyYcSHIGlzdG5pZWrEhWNlZ28gcHJvZmlsdTogJyArIGZldGNoRXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBleGlzdGluZ1VzZXI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSB1dHdvcnp5xIcgcHJvZmlsdSB1xbx5dGtvd25pa2EnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgaGFuZGxlU3VwYWJhc2VBZG1pbkVycm9yKGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEZ1bmtjamEgZG8gcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5QXV0aElkQWRtaW4gPSBhc3luYyAoYXV0aElkKSA9PiB7XHJcbiAgaWYgKCFhdXRoSWQpIHJldHVybiBudWxsO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIGF1dGhJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgICAgICAvLyBOaWUgem5hbGV6aW9ubyAtIHRvIG5vcm1hbG55IHByenlwYWRla1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FkbWluOiBCxYLEhWQgcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYTonLCBlcnJvcik7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSBwb2JyYcSHIHByb2ZpbHUgdcW8eXRrb3duaWthJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIGFrdHVhbGl6YWNqaSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VySWQsIHVwZGF0ZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgIC51cGRhdGUodXBkYXRlcylcclxuICAgICAgLmVxKCdpZCcsIHVzZXJJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIHBvYmllcmFuaWEgcGxhdGZvcm0gc3Vic2tyeXBjeWpueWNoIHByemV6IGFkbWluaXN0cmF0b3JhXHJcbmV4cG9ydCBjb25zdCBnZXRTdWJzY3JpcHRpb25QbGF0Zm9ybXNBZG1pbiA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3BsYXRmb3JtcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ25hbWUnKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVua2NqYSBkbyBwb2JpZXJhbmlhIGN6xYJvbmvDs3cgZ3J1cHkgcHJ6ZXogYWRtaW5pc3RyYXRvcmFcclxuZXhwb3J0IGNvbnN0IGdldEdyb3VwTWVtYmVyc0FkbWluID0gYXN5bmMgKGdyb3VwSWQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnZ3JvdXBfbWVtYmVycycpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICosXHJcbiAgICAgICAgdXNlcjp1c2VyX3Byb2ZpbGVzKGlkLCBkaXNwbGF5X25hbWUsIGF2YXRhcl91cmwsIGVtYWlsKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ2dyb3VwX2lkJywgZ3JvdXBJZCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFphcGlzeiB3c3p5c3RraWUgYWt0eXdub8WbY2kgYWRtaW5pc3RyYXRvcmEgZG8gbG9ndSBiZXpwaWVjemXFhHN0d2FcclxuZXhwb3J0IGNvbnN0IGxvZ0FkbWluQWN0aXZpdHkgPSBhc3luYyAoYWN0aW9uLCByZXNvdXJjZVR5cGUsIHJlc291cmNlSWQsIGRldGFpbHMgPSB7fSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9sb2dzJylcclxuICAgICAgLmluc2VydChbe1xyXG4gICAgICAgIGFjdGlvbl90eXBlOiBhY3Rpb24sXHJcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxyXG4gICAgICAgIHJlc291cmNlX2lkOiByZXNvdXJjZUlkLFxyXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgIGRldGFpbHM6IGRldGFpbHMsXHJcbiAgICAgIH1dKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSBjb25zb2xlLmVycm9yKCdCxYLEhWQgbG9nb3dhbmlhIGFrdHl3bm/Fm2NpIGFkbWluaXN0cmF0b3JhOicsIGVycm9yKTtcclxuICAgIFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdXeWrEhXRlayBwb2RjemFzIGxvZ293YW5pYSBha3R5d25vxZtjaSBhZG1pbmlzdHJhdG9yYTonLCBlcnJvcik7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRWtzcG9ydCBrbGllbnRhIGFkbWluaXN0cmF0b3JhIGpha28gZG9tecWbbG55XHJcbmV4cG9ydCBkZWZhdWx0IHN1cGFiYXNlQWRtaW47Il0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJjb25zb2xlIiwiZXJyb3IiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwiZGV0YWlscyIsImNyZWF0ZVVzZXJQcm9maWxlQWRtaW4iLCJ1c2VyUHJvZmlsZSIsImRhdGEiLCJmcm9tIiwiaW5zZXJ0Iiwic2VsZWN0Iiwic2luZ2xlIiwid2FybiIsImV4aXN0aW5nVXNlciIsImZldGNoRXJyb3IiLCJlcSIsImV4dGVybmFsX2F1dGhfaWQiLCJFcnJvciIsImdldFVzZXJCeUF1dGhJZEFkbWluIiwiYXV0aElkIiwidXBkYXRlVXNlclByb2ZpbGVBZG1pbiIsInVzZXJJZCIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJnZXRTdWJzY3JpcHRpb25QbGF0Zm9ybXNBZG1pbiIsIm9yZGVyIiwiZ2V0R3JvdXBNZW1iZXJzQWRtaW4iLCJncm91cElkIiwibG9nQWRtaW5BY3Rpdml0eSIsImFjdGlvbiIsInJlc291cmNlVHlwZSIsInJlc291cmNlSWQiLCJhY3Rpb25fdHlwZSIsInJlc291cmNlX3R5cGUiLCJyZXNvdXJjZV9pZCIsInN0YXR1cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database/supabase-admin-client.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/database/supabase-client.js":
/*!*********************************************!*\
  !*** ./src/lib/database/supabase-client.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handleDatabaseError: () => (/* binding */ handleDatabaseError),\n/* harmony export */   offersRepository: () => (/* binding */ offersRepository),\n/* harmony export */   platformsRepository: () => (/* binding */ platformsRepository),\n/* harmony export */   purchasesRepository: () => (/* binding */ purchasesRepository),\n/* harmony export */   safeQueryExecution: () => (/* binding */ safeQueryExecution),\n/* harmony export */   userRepository: () => (/* binding */ userRepository)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase-admin-client */ \"(rsc)/./src/lib/database/supabase-admin-client.js\");\n// src/lib/database/supabase-client.js\n\n\n// Inicjalizacja klienta Supabase\nconst supabaseUrl = \"https://nimrnohkesysfppcmujb.supabase.co\";\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pbXJub2hrZXN5c2ZwcGNtdWpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2MzI1ODgsImV4cCI6MjA2MDIwODU4OH0.xanoTueWzP87TJEZj3zNa8qyC3eRMooobIL71bjxdEs\";\n// Sprawdzenie, czy zmienne środowiskowe są ustawione\nif (!supabaseUrl || !supabaseAnonKey) {\n    console.error(\"Brak wymaganych zmiennych środowiskowych: NEXT_PUBLIC_SUPABASE_URL lub NEXT_PUBLIC_SUPABASE_ANON_KEY\");\n}\n// Stała instancja klienta Supabase do ponownego użycia w całej aplikacji\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n/**\r\n * Standardowa obsługa błędów Supabase \r\n * @param {Error} error - Błąd zwrócony przez Supabase\r\n * @param {string} operation - Nazwa operacji, która spowodowała błąd\r\n * @param {boolean} throwError - Czy wyrzucić błąd (true) czy zwrócić obiekt błędu (false)\r\n * @returns {Object} - Standardowy obiekt błędu (jeśli throwError = false)\r\n * @throws {Error} - Rzuca błąd (jeśli throwError = true)\r\n */ const handleDatabaseError = (error, operation = \"database operation\", throwError = false)=>{\n    // Tworzenie standardowego obiektu błędu\n    const standardError = {\n        error: true,\n        message: error.message || `Wystąpił błąd podczas ${operation}`,\n        code: error.code || \"unknown_error\",\n        details: error.details || null,\n        operation\n    };\n    // Zapisz szczegółowy log błędu\n    console.error(`Database error during ${operation}:`, {\n        message: error.message,\n        code: error.code,\n        details: error.details,\n        stack: error.stack\n    });\n    if (throwError) {\n        // Stwórz nowy obiekt błędu z dodatkowymi metadanymi\n        const enhancedError = new Error(standardError.message);\n        enhancedError.code = standardError.code;\n        enhancedError.details = standardError.details;\n        enhancedError.operation = operation;\n        throw enhancedError;\n    }\n    return standardError;\n};\n/**\r\n * Bezpieczne wykonanie operacji Supabase z obsługą błędów i fallbackiem do klienta administratora\r\n * @param {Function} operation - Funkcja operacji Supabase do wykonania\r\n * @param {string} operationName - Nazwa operacji (dla logów)\r\n * @param {boolean} useAdminOnFailure - Czy próbować z klientem admin w przypadku błędu uprawnień\r\n * @param {boolean} throwOnError - Czy wyrzucać błędy zamiast zwracać null/[] \r\n * @returns {Promise<any>} - Wynik operacji lub null/[] w przypadku błędu\r\n */ const safeQueryExecution = async (operation, operationName = \"database operation\", useAdminOnFailure = true, throwOnError = false)=>{\n    try {\n        // Próba wykonania operacji ze standardowym klientem\n        const result = await operation(supabase);\n        // Jeśli wynik zawiera błąd\n        if (result.error) {\n            // Jeśli to błąd uprawnień i mamy fallback do admina\n            if (result.error.code === \"42501\" && useAdminOnFailure) {\n                console.log(`Permission denied during ${operationName}, trying admin client`);\n                // Próba wykonania tej samej operacji z klientem administratora\n                const adminResult = await operation(_supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"]);\n                if (adminResult.error) {\n                    return handleDatabaseError(adminResult.error, operationName, throwOnError);\n                }\n                return adminResult.data;\n            }\n            return handleDatabaseError(result.error, operationName, throwOnError);\n        }\n        return result.data;\n    } catch (error) {\n        return handleDatabaseError(error, operationName, throwOnError);\n    }\n};\n// Repozytoria dostępu do danych - wysoki poziom abstrakcji\n/**\r\n * Repozytorium użytkowników\r\n */ const userRepository = {\n    /**\r\n   * Pobiera profil użytkownika na podstawie zewnętrznego ID uwierzytelniania\r\n   * @param {string} authId - ID uwierzytelniania (np. z Clerk)\r\n   * @returns {Promise<Object|null>} - Profil użytkownika lub null\r\n   */ async getByAuthId (authId) {\n        if (!authId) return null;\n        return safeQueryExecution((client)=>client.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", authId).single(), \"getByAuthId\");\n    },\n    /**\r\n   * Tworzy nowy profil użytkownika\r\n   * @param {Object} userProfile - Dane profilu użytkownika\r\n   * @returns {Promise<Object|null>} - Utworzony profil użytkownika lub null\r\n   */ async create (userProfile) {\n        return safeQueryExecution((client)=>client.from(\"user_profiles\").insert([\n                userProfile\n            ]).select().single(), \"createUserProfile\", true // zawsze używaj klienta admina przy tworzeniu użytkownika\n        );\n    },\n    /**\r\n   * Aktualizuje istniejący profil użytkownika\r\n   * @param {string} userId - ID profilu użytkownika\r\n   * @param {Object} updates - Dane do aktualizacji\r\n   * @returns {Promise<Object|null>} - Zaktualizowany profil użytkownika lub null\r\n   */ async update (userId, updates) {\n        return safeQueryExecution((client)=>client.from(\"user_profiles\").update(updates).eq(\"id\", userId).select().single(), \"updateUserProfile\");\n    },\n    /**\r\n   * Pobiera profil użytkownika po ID\r\n   * @param {string} userId - ID profilu użytkownika\r\n   * @returns {Promise<Object|null>} - Profil użytkownika lub null\r\n   */ async getById (userId) {\n        return safeQueryExecution((client)=>client.from(\"user_profiles\").select(\"*\").eq(\"id\", userId).single(), \"getUserById\");\n    }\n};\n/**\r\n * Repozytorium ofert subskrypcji\r\n */ const offersRepository = {\n    /**\r\n   * Pobiera oferty subskrypcji z filtrowaniem\r\n   * @param {Object} filters - Filtry do zastosowania\r\n   * @returns {Promise<Array>} - Lista ofert\r\n   */ async getAll (filters = {}) {\n        // Przygotowanie bazowego zapytania\n        const queryBuilder = (client)=>{\n            let query = client.from(\"group_subs\").select(`\r\n          *,\r\n          subscription_platforms(*),\r\n          groups(id, name),\r\n          owner:groups!inner(owner_id, user_profiles!inner(id, display_name, avatar_url, rating_avg, rating_count, verification_level))\r\n        `).eq(\"status\", \"active\");\n            // Zastosowanie filtrów\n            if (filters.platformId) {\n                query = query.eq(\"platform_id\", filters.platformId);\n            }\n            if (filters.minPrice !== undefined) {\n                query = query.gte(\"price_per_slot\", filters.minPrice);\n            }\n            if (filters.maxPrice !== undefined) {\n                query = query.lte(\"price_per_slot\", filters.maxPrice);\n            }\n            if (filters.availableSlots === true) {\n                query = query.gt(\"slots_available\", 0);\n            }\n            // Sortowanie\n            const orderBy = filters.orderBy || \"created_at\";\n            const ascending = filters.ascending === true;\n            query = query.order(orderBy, {\n                ascending\n            });\n            // Paginacja\n            if (filters.limit) {\n                query = query.limit(filters.limit);\n            }\n            if (filters.offset) {\n                query = query.range(filters.offset, filters.offset + (filters.limit || 10) - 1);\n            }\n            return query;\n        };\n        return safeQueryExecution(queryBuilder, \"getAllOffers\") || [];\n    },\n    /**\r\n   * Pobiera ofertę subskrypcji po ID\r\n   * @param {string} offerId - ID oferty\r\n   * @returns {Promise<Object|null>} - Oferta subskrypcji lub null\r\n   */ async getById (offerId) {\n        return safeQueryExecution((client)=>client.from(\"group_subs\").select(`\r\n          *,\r\n          subscription_platforms(*),\r\n          groups(id, name, description),\r\n          owner:groups!inner(owner_id, user_profiles!inner(id, display_name, avatar_url, rating_avg, rating_count, verification_level, bio))\r\n        `).eq(\"id\", offerId).single(), \"getOfferById\");\n    },\n    /**\r\n   * Tworzy nową ofertę subskrypcji\r\n   * @param {Object} offerData - Dane oferty\r\n   * @returns {Promise<Object|null>} - Utworzona oferta lub null\r\n   */ async create (offerData) {\n        return safeQueryExecution((client)=>client.from(\"group_subs\").insert([\n                offerData\n            ]).select().single(), \"createOffer\");\n    },\n    /**\r\n   * Aktualizuje ofertę subskrypcji\r\n   * @param {string} offerId - ID oferty\r\n   * @param {Object} updates - Dane do aktualizacji\r\n   * @returns {Promise<Object|null>} - Zaktualizowana oferta lub null \r\n   */ async update (offerId, updates) {\n        return safeQueryExecution((client)=>client.from(\"group_subs\").update(updates).eq(\"id\", offerId).select().single(), \"updateOffer\");\n    },\n    /**\r\n   * Usuwa ofertę subskrypcji\r\n   * @param {string} offerId - ID oferty\r\n   * @returns {Promise<boolean>} - Czy operacja się powiodła\r\n   */ async delete (offerId) {\n        const result = await safeQueryExecution((client)=>client.from(\"group_subs\").delete().eq(\"id\", offerId), \"deleteOffer\");\n        return result !== null;\n    }\n};\n/**\r\n * Repozytorium platform subskrypcji\r\n */ const platformsRepository = {\n    /**\r\n   * Pobiera wszystkie aktywne platformy subskrypcji\r\n   * @returns {Promise<Array>} - Lista platform\r\n   */ async getAll () {\n        return safeQueryExecution((client)=>client.from(\"subscription_platforms\").select(\"*\").eq(\"active\", true).order(\"name\"), \"getAllPlatforms\") || [];\n    },\n    /**\r\n   * Pobiera platformę po ID\r\n   * @param {string} platformId - ID platformy\r\n   * @returns {Promise<Object|null>} - Platforma lub null\r\n   */ async getById (platformId) {\n        return safeQueryExecution((client)=>client.from(\"subscription_platforms\").select(\"*\").eq(\"id\", platformId).single(), \"getPlatformById\");\n    }\n};\n/**\r\n * Repozytorium zakupów\r\n */ const purchasesRepository = {\n    /**\r\n   * Tworzy nowy zakup\r\n   * @param {Object} purchaseData - Dane zakupu\r\n   * @returns {Promise<Object|null>} - Utworzony zakup lub null\r\n   */ async create (purchaseData) {\n        return safeQueryExecution((client)=>client.from(\"purchase_records\").insert([\n                purchaseData\n            ]).select().single(), \"createPurchase\", true // używaj klienta admin\n        );\n    },\n    /**\r\n   * Pobiera zakup po ID\r\n   * @param {string} purchaseId - ID zakupu\r\n   * @returns {Promise<Object|null>} - Zakup lub null\r\n   */ async getById (purchaseId) {\n        return safeQueryExecution((client)=>client.from(\"purchase_records\").select(`\r\n          *,\r\n          group_sub:group_subs(\r\n            *,\r\n            subscription_platforms(\r\n              id,\r\n              name,\r\n              icon\r\n            )\r\n          )\r\n        `).eq(\"id\", purchaseId).single(), \"getPurchaseById\");\n    },\n    /**\r\n   * Aktualizuje zakup\r\n   * @param {string} purchaseId - ID zakupu\r\n   * @param {Object} updates - Dane do aktualizacji\r\n   * @returns {Promise<Object|null>} - Zaktualizowany zakup lub null\r\n   */ async update (purchaseId, updates) {\n        return safeQueryExecution((client)=>client.from(\"purchase_records\").update(updates).eq(\"id\", purchaseId).select().single(), \"updatePurchase\");\n    },\n    /**\r\n   * Pobiera zakupy użytkownika\r\n   * @param {string} userId - ID użytkownika\r\n   * @returns {Promise<Array>} - Lista zakupów\r\n   */ async getByUserId (userId) {\n        return safeQueryExecution((client)=>client.from(\"purchase_records\").select(`\r\n          *,\r\n          group_sub:group_subs(\r\n            *,\r\n            subscription_platforms(\r\n              id,\r\n              name,\r\n              icon\r\n            )\r\n          )\r\n        `).eq(\"user_id\", userId).order(\"created_at\", {\n                ascending: false\n            }), \"getUserPurchases\") || [];\n    }\n};\n// Eksport podstawowego klienta Supabase\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabase);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWNsaWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSxzQ0FBc0M7QUFDZTtBQUNEO0FBRXBELGlDQUFpQztBQUNqQyxNQUFNRSxjQUFjQywwQ0FBb0M7QUFDeEQsTUFBTUcsa0JBQWtCSCxrTkFBeUM7QUFFakUscURBQXFEO0FBQ3JELElBQUksQ0FBQ0QsZUFBZSxDQUFDSSxpQkFBaUI7SUFDcENFLFFBQVFDLEtBQUssQ0FDWDtBQUVKO0FBRUEseUVBQXlFO0FBQ3pFLE1BQU1DLFdBQVdWLG1FQUFZQSxDQUFDRSxhQUFhSTtBQUUzQzs7Ozs7OztDQU9DLEdBQ00sTUFBTUssc0JBQXNCLENBQUNGLE9BQU9HLFlBQVksb0JBQW9CLEVBQUVDLGFBQWEsS0FBSztJQUM3Rix3Q0FBd0M7SUFDeEMsTUFBTUMsZ0JBQWdCO1FBQ3BCTCxPQUFPO1FBQ1BNLFNBQVNOLE1BQU1NLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixFQUFFSCxVQUFVLENBQUM7UUFDOURJLE1BQU1QLE1BQU1PLElBQUksSUFBSTtRQUNwQkMsU0FBU1IsTUFBTVEsT0FBTyxJQUFJO1FBQzFCTDtJQUNGO0lBRUEsK0JBQStCO0lBQy9CSixRQUFRQyxLQUFLLENBQUMsQ0FBQyxzQkFBc0IsRUFBRUcsVUFBVSxDQUFDLENBQUMsRUFBRTtRQUNuREcsU0FBU04sTUFBTU0sT0FBTztRQUN0QkMsTUFBTVAsTUFBTU8sSUFBSTtRQUNoQkMsU0FBU1IsTUFBTVEsT0FBTztRQUN0QkMsT0FBT1QsTUFBTVMsS0FBSztJQUNwQjtJQUVBLElBQUlMLFlBQVk7UUFDZCxvREFBb0Q7UUFDcEQsTUFBTU0sZ0JBQWdCLElBQUlDLE1BQU1OLGNBQWNDLE9BQU87UUFDckRJLGNBQWNILElBQUksR0FBR0YsY0FBY0UsSUFBSTtRQUN2Q0csY0FBY0YsT0FBTyxHQUFHSCxjQUFjRyxPQUFPO1FBQzdDRSxjQUFjUCxTQUFTLEdBQUdBO1FBQzFCLE1BQU1PO0lBQ1I7SUFFQSxPQUFPTDtBQUNULEVBQUU7QUFFRjs7Ozs7OztDQU9DLEdBQ00sTUFBTU8scUJBQXFCLE9BQ2hDVCxXQUNBVSxnQkFBZ0Isb0JBQW9CLEVBQ3BDQyxvQkFBb0IsSUFBSSxFQUN4QkMsZUFBZSxLQUFLO0lBRXBCLElBQUk7UUFDRixvREFBb0Q7UUFDcEQsTUFBTUMsU0FBUyxNQUFNYixVQUFVRjtRQUUvQiwyQkFBMkI7UUFDM0IsSUFBSWUsT0FBT2hCLEtBQUssRUFBRTtZQUNoQixvREFBb0Q7WUFDcEQsSUFBSWdCLE9BQU9oQixLQUFLLENBQUNPLElBQUksS0FBSyxXQUFXTyxtQkFBbUI7Z0JBQ3REZixRQUFRa0IsR0FBRyxDQUFDLENBQUMseUJBQXlCLEVBQUVKLGNBQWMscUJBQXFCLENBQUM7Z0JBRTVFLCtEQUErRDtnQkFDL0QsTUFBTUssY0FBYyxNQUFNZixVQUFVWCw4REFBYUE7Z0JBRWpELElBQUkwQixZQUFZbEIsS0FBSyxFQUFFO29CQUNyQixPQUFPRSxvQkFBb0JnQixZQUFZbEIsS0FBSyxFQUFFYSxlQUFlRTtnQkFDL0Q7Z0JBRUEsT0FBT0csWUFBWUMsSUFBSTtZQUN6QjtZQUVBLE9BQU9qQixvQkFBb0JjLE9BQU9oQixLQUFLLEVBQUVhLGVBQWVFO1FBQzFEO1FBRUEsT0FBT0MsT0FBT0csSUFBSTtJQUNwQixFQUFFLE9BQU9uQixPQUFPO1FBQ2QsT0FBT0Usb0JBQW9CRixPQUFPYSxlQUFlRTtJQUNuRDtBQUNGLEVBQUU7QUFFRiwyREFBMkQ7QUFFM0Q7O0NBRUMsR0FDTSxNQUFNSyxpQkFBaUI7SUFDNUI7Ozs7R0FJQyxHQUNELE1BQU1DLGFBQVlDLE1BQU07UUFDdEIsSUFBSSxDQUFDQSxRQUFRLE9BQU87UUFFcEIsT0FBT1YsbUJBQ0wsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUMsS0FDUEMsRUFBRSxDQUFDLG9CQUFvQkosUUFDdkJLLE1BQU0sSUFDVDtJQUVKO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1DLFFBQU9DLFdBQVc7UUFDdEIsT0FBT2pCLG1CQUNMLENBQUNXLFNBQVdBLE9BQ1RDLElBQUksQ0FBQyxpQkFDTE0sTUFBTSxDQUFDO2dCQUFDRDthQUFZLEVBQ3BCSixNQUFNLEdBQ05FLE1BQU0sSUFDVCxxQkFDQSxLQUFLLDBEQUEwRDs7SUFFbkU7SUFFQTs7Ozs7R0FLQyxHQUNELE1BQU1JLFFBQU9DLE1BQU0sRUFBRUMsT0FBTztRQUMxQixPQUFPckIsbUJBQ0wsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLGlCQUNMTyxNQUFNLENBQUNFLFNBQ1BQLEVBQUUsQ0FBQyxNQUFNTSxRQUNUUCxNQUFNLEdBQ05FLE1BQU0sSUFDVDtJQUVKO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1PLFNBQVFGLE1BQU07UUFDbEIsT0FBT3BCLG1CQUNMLENBQUNXLFNBQVdBLE9BQ1RDLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxNQUFNTSxRQUNUTCxNQUFNLElBQ1Q7SUFFSjtBQUNGLEVBQUU7QUFFRjs7Q0FFQyxHQUNNLE1BQU1RLG1CQUFtQjtJQUM5Qjs7OztHQUlDLEdBQ0QsTUFBTUMsUUFBT0MsVUFBVSxDQUFDLENBQUM7UUFDdkIsbUNBQW1DO1FBQ25DLE1BQU1DLGVBQWUsQ0FBQ2Y7WUFDcEIsSUFBSWdCLFFBQVFoQixPQUNUQyxJQUFJLENBQUMsY0FDTEMsTUFBTSxDQUFDLENBQUM7Ozs7O1FBS1QsQ0FBQyxFQUNBQyxFQUFFLENBQUMsVUFBVTtZQUVoQix1QkFBdUI7WUFDdkIsSUFBSVcsUUFBUUcsVUFBVSxFQUFFO2dCQUN0QkQsUUFBUUEsTUFBTWIsRUFBRSxDQUFDLGVBQWVXLFFBQVFHLFVBQVU7WUFDcEQ7WUFFQSxJQUFJSCxRQUFRSSxRQUFRLEtBQUtDLFdBQVc7Z0JBQ2xDSCxRQUFRQSxNQUFNSSxHQUFHLENBQUMsa0JBQWtCTixRQUFRSSxRQUFRO1lBQ3REO1lBRUEsSUFBSUosUUFBUU8sUUFBUSxLQUFLRixXQUFXO2dCQUNsQ0gsUUFBUUEsTUFBTU0sR0FBRyxDQUFDLGtCQUFrQlIsUUFBUU8sUUFBUTtZQUN0RDtZQUVBLElBQUlQLFFBQVFTLGNBQWMsS0FBSyxNQUFNO2dCQUNuQ1AsUUFBUUEsTUFBTVEsRUFBRSxDQUFDLG1CQUFtQjtZQUN0QztZQUVBLGFBQWE7WUFDYixNQUFNQyxVQUFVWCxRQUFRVyxPQUFPLElBQUk7WUFDbkMsTUFBTUMsWUFBWVosUUFBUVksU0FBUyxLQUFLO1lBQ3hDVixRQUFRQSxNQUFNVyxLQUFLLENBQUNGLFNBQVM7Z0JBQUVDO1lBQVU7WUFFekMsWUFBWTtZQUNaLElBQUlaLFFBQVFjLEtBQUssRUFBRTtnQkFDakJaLFFBQVFBLE1BQU1ZLEtBQUssQ0FBQ2QsUUFBUWMsS0FBSztZQUNuQztZQUVBLElBQUlkLFFBQVFlLE1BQU0sRUFBRTtnQkFDbEJiLFFBQVFBLE1BQU1jLEtBQUssQ0FBQ2hCLFFBQVFlLE1BQU0sRUFBRWYsUUFBUWUsTUFBTSxHQUFJZixDQUFBQSxRQUFRYyxLQUFLLElBQUksRUFBQyxJQUFLO1lBQy9FO1lBRUEsT0FBT1o7UUFDVDtRQUVBLE9BQU8zQixtQkFBbUIwQixjQUFjLG1CQUFtQixFQUFFO0lBQy9EO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1KLFNBQVFvQixPQUFPO1FBQ25CLE9BQU8xQyxtQkFDTCxDQUFDVyxTQUFXQSxPQUNUQyxJQUFJLENBQUMsY0FDTEMsTUFBTSxDQUFDLENBQUM7Ozs7O1FBS1QsQ0FBQyxFQUNBQyxFQUFFLENBQUMsTUFBTTRCLFNBQ1QzQixNQUFNLElBQ1Q7SUFFSjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNQyxRQUFPMkIsU0FBUztRQUNwQixPQUFPM0MsbUJBQ0wsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLGNBQ0xNLE1BQU0sQ0FBQztnQkFBQ3lCO2FBQVUsRUFDbEI5QixNQUFNLEdBQ05FLE1BQU0sSUFDVDtJQUVKO0lBRUE7Ozs7O0dBS0MsR0FDRCxNQUFNSSxRQUFPdUIsT0FBTyxFQUFFckIsT0FBTztRQUMzQixPQUFPckIsbUJBQ0wsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLGNBQ0xPLE1BQU0sQ0FBQ0UsU0FDUFAsRUFBRSxDQUFDLE1BQU00QixTQUNUN0IsTUFBTSxHQUNORSxNQUFNLElBQ1Q7SUFFSjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNNkIsUUFBT0YsT0FBTztRQUNsQixNQUFNdEMsU0FBUyxNQUFNSixtQkFDbkIsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLGNBQ0xnQyxNQUFNLEdBQ045QixFQUFFLENBQUMsTUFBTTRCLFVBQ1o7UUFHRixPQUFPdEMsV0FBVztJQUNwQjtBQUNGLEVBQUU7QUFFRjs7Q0FFQyxHQUNNLE1BQU15QyxzQkFBc0I7SUFDakM7OztHQUdDLEdBQ0QsTUFBTXJCO1FBQ0osT0FBT3hCLG1CQUNMLENBQUNXLFNBQVdBLE9BQ1RDLElBQUksQ0FBQywwQkFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxVQUFVLE1BQ2J3QixLQUFLLENBQUMsU0FDVCxzQkFDRyxFQUFFO0lBQ1Q7SUFFQTs7OztHQUlDLEdBQ0QsTUFBTWhCLFNBQVFNLFVBQVU7UUFDdEIsT0FBTzVCLG1CQUNMLENBQUNXLFNBQVdBLE9BQ1RDLElBQUksQ0FBQywwQkFDTEMsTUFBTSxDQUFDLEtBQ1BDLEVBQUUsQ0FBQyxNQUFNYyxZQUNUYixNQUFNLElBQ1Q7SUFFSjtBQUNGLEVBQUU7QUFFRjs7Q0FFQyxHQUNNLE1BQU0rQixzQkFBc0I7SUFDakM7Ozs7R0FJQyxHQUNELE1BQU05QixRQUFPK0IsWUFBWTtRQUN2QixPQUFPL0MsbUJBQ0wsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLG9CQUNMTSxNQUFNLENBQUM7Z0JBQUM2QjthQUFhLEVBQ3JCbEMsTUFBTSxHQUNORSxNQUFNLElBQ1Qsa0JBQ0EsS0FBSyx1QkFBdUI7O0lBRWhDO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1PLFNBQVEwQixVQUFVO1FBQ3RCLE9BQU9oRCxtQkFDTCxDQUFDVyxTQUFXQSxPQUNUQyxJQUFJLENBQUMsb0JBQ0xDLE1BQU0sQ0FBQyxDQUFDOzs7Ozs7Ozs7O1FBVVQsQ0FBQyxFQUNBQyxFQUFFLENBQUMsTUFBTWtDLFlBQ1RqQyxNQUFNLElBQ1Q7SUFFSjtJQUVBOzs7OztHQUtDLEdBQ0QsTUFBTUksUUFBTzZCLFVBQVUsRUFBRTNCLE9BQU87UUFDOUIsT0FBT3JCLG1CQUNMLENBQUNXLFNBQVdBLE9BQ1RDLElBQUksQ0FBQyxvQkFDTE8sTUFBTSxDQUFDRSxTQUNQUCxFQUFFLENBQUMsTUFBTWtDLFlBQ1RuQyxNQUFNLEdBQ05FLE1BQU0sSUFDVDtJQUVKO0lBRUE7Ozs7R0FJQyxHQUNELE1BQU1rQyxhQUFZN0IsTUFBTTtRQUN0QixPQUFPcEIsbUJBQ0wsQ0FBQ1csU0FBV0EsT0FDVEMsSUFBSSxDQUFDLG9CQUNMQyxNQUFNLENBQUMsQ0FBQzs7Ozs7Ozs7OztRQVVULENBQUMsRUFDQUMsRUFBRSxDQUFDLFdBQVdNLFFBQ2RrQixLQUFLLENBQUMsY0FBYztnQkFBRUQsV0FBVztZQUFNLElBQzFDLHVCQUNHLEVBQUU7SUFDVDtBQUNGLEVBQUU7QUFFRix3Q0FBd0M7QUFDeEMsaUVBQWVoRCxRQUFRQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2xpYi9kYXRhYmFzZS9zdXBhYmFzZS1jbGllbnQuanM/YzU3NiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWNsaWVudC5qc1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5pbXBvcnQgc3VwYWJhc2VBZG1pbiBmcm9tICcuL3N1cGFiYXNlLWFkbWluLWNsaWVudCc7XHJcblxyXG4vLyBJbmljamFsaXphY2phIGtsaWVudGEgU3VwYWJhc2VcclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xyXG5cclxuLy8gU3ByYXdkemVuaWUsIGN6eSB6bWllbm5lIMWbcm9kb3dpc2tvd2Ugc8SFIHVzdGF3aW9uZVxyXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUFub25LZXkpIHtcclxuICBjb25zb2xlLmVycm9yKFxyXG4gICAgJ0JyYWsgd3ltYWdhbnljaCB6bWllbm55Y2ggxZtyb2Rvd2lza293eWNoOiBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgbHViIE5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZJ1xyXG4gICk7XHJcbn1cclxuXHJcbi8vIFN0YcWCYSBpbnN0YW5jamEga2xpZW50YSBTdXBhYmFzZSBkbyBwb25vd25lZ28gdcW8eWNpYSB3IGNhxYJlaiBhcGxpa2FjamlcclxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XHJcblxyXG4vKipcclxuICogU3RhbmRhcmRvd2Egb2JzxYJ1Z2EgYsWCxJlkw7N3IFN1cGFiYXNlIFxyXG4gKiBAcGFyYW0ge0Vycm9yfSBlcnJvciAtIELFgsSFZCB6d3LDs2NvbnkgcHJ6ZXogU3VwYWJhc2VcclxuICogQHBhcmFtIHtzdHJpbmd9IG9wZXJhdGlvbiAtIE5hendhIG9wZXJhY2ppLCBrdMOzcmEgc3Bvd29kb3dhxYJhIGLFgsSFZFxyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHRocm93RXJyb3IgLSBDenkgd3lyenVjacSHIGLFgsSFZCAodHJ1ZSkgY3p5IHp3csOzY2nEhyBvYmlla3QgYsWCxJlkdSAoZmFsc2UpXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IC0gU3RhbmRhcmRvd3kgb2JpZWt0IGLFgsSZZHUgKGplxZtsaSB0aHJvd0Vycm9yID0gZmFsc2UpXHJcbiAqIEB0aHJvd3Mge0Vycm9yfSAtIFJ6dWNhIGLFgsSFZCAoamXFm2xpIHRocm93RXJyb3IgPSB0cnVlKVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGhhbmRsZURhdGFiYXNlRXJyb3IgPSAoZXJyb3IsIG9wZXJhdGlvbiA9ICdkYXRhYmFzZSBvcGVyYXRpb24nLCB0aHJvd0Vycm9yID0gZmFsc2UpID0+IHtcclxuICAvLyBUd29yemVuaWUgc3RhbmRhcmRvd2VnbyBvYmlla3R1IGLFgsSZZHVcclxuICBjb25zdCBzdGFuZGFyZEVycm9yID0ge1xyXG4gICAgZXJyb3I6IHRydWUsXHJcbiAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IGBXeXN0xIVwacWCIGLFgsSFZCBwb2RjemFzICR7b3BlcmF0aW9ufWAsXHJcbiAgICBjb2RlOiBlcnJvci5jb2RlIHx8ICd1bmtub3duX2Vycm9yJyxcclxuICAgIGRldGFpbHM6IGVycm9yLmRldGFpbHMgfHwgbnVsbCxcclxuICAgIG9wZXJhdGlvblxyXG4gIH07XHJcblxyXG4gIC8vIFphcGlzeiBzemN6ZWfDs8WCb3d5IGxvZyBixYLEmWR1XHJcbiAgY29uc29sZS5lcnJvcihgRGF0YWJhc2UgZXJyb3IgZHVyaW5nICR7b3BlcmF0aW9ufTpgLCB7XHJcbiAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgY29kZTogZXJyb3IuY29kZSxcclxuICAgIGRldGFpbHM6IGVycm9yLmRldGFpbHMsXHJcbiAgICBzdGFjazogZXJyb3Iuc3RhY2tcclxuICB9KTtcclxuXHJcbiAgaWYgKHRocm93RXJyb3IpIHtcclxuICAgIC8vIFN0d8Ozcnogbm93eSBvYmlla3QgYsWCxJlkdSB6IGRvZGF0a293eW1pIG1ldGFkYW55bWlcclxuICAgIGNvbnN0IGVuaGFuY2VkRXJyb3IgPSBuZXcgRXJyb3Ioc3RhbmRhcmRFcnJvci5tZXNzYWdlKTtcclxuICAgIGVuaGFuY2VkRXJyb3IuY29kZSA9IHN0YW5kYXJkRXJyb3IuY29kZTtcclxuICAgIGVuaGFuY2VkRXJyb3IuZGV0YWlscyA9IHN0YW5kYXJkRXJyb3IuZGV0YWlscztcclxuICAgIGVuaGFuY2VkRXJyb3Iub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xyXG4gICAgdGhyb3cgZW5oYW5jZWRFcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiBzdGFuZGFyZEVycm9yO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEJlenBpZWN6bmUgd3lrb25hbmllIG9wZXJhY2ppIFN1cGFiYXNlIHogb2JzxYJ1Z8SFIGLFgsSZZMOzdyBpIGZhbGxiYWNraWVtIGRvIGtsaWVudGEgYWRtaW5pc3RyYXRvcmFcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gb3BlcmF0aW9uIC0gRnVua2NqYSBvcGVyYWNqaSBTdXBhYmFzZSBkbyB3eWtvbmFuaWFcclxuICogQHBhcmFtIHtzdHJpbmd9IG9wZXJhdGlvbk5hbWUgLSBOYXp3YSBvcGVyYWNqaSAoZGxhIGxvZ8OzdylcclxuICogQHBhcmFtIHtib29sZWFufSB1c2VBZG1pbk9uRmFpbHVyZSAtIEN6eSBwcsOzYm93YcSHIHoga2xpZW50ZW0gYWRtaW4gdyBwcnp5cGFka3UgYsWCxJlkdSB1cHJhd25pZcWEXHJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdGhyb3dPbkVycm9yIC0gQ3p5IHd5cnp1Y2HEhyBixYLEmWR5IHphbWlhc3QgendyYWNhxIcgbnVsbC9bXSBcclxuICogQHJldHVybnMge1Byb21pc2U8YW55Pn0gLSBXeW5payBvcGVyYWNqaSBsdWIgbnVsbC9bXSB3IHByenlwYWRrdSBixYLEmWR1XHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc2FmZVF1ZXJ5RXhlY3V0aW9uID0gYXN5bmMgKFxyXG4gIG9wZXJhdGlvbixcclxuICBvcGVyYXRpb25OYW1lID0gJ2RhdGFiYXNlIG9wZXJhdGlvbicsXHJcbiAgdXNlQWRtaW5PbkZhaWx1cmUgPSB0cnVlLFxyXG4gIHRocm93T25FcnJvciA9IGZhbHNlXHJcbikgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBQcsOzYmEgd3lrb25hbmlhIG9wZXJhY2ppIHplIHN0YW5kYXJkb3d5bSBrbGllbnRlbVxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgb3BlcmF0aW9uKHN1cGFiYXNlKTtcclxuICAgIFxyXG4gICAgLy8gSmXFm2xpIHd5bmlrIHphd2llcmEgYsWCxIVkXHJcbiAgICBpZiAocmVzdWx0LmVycm9yKSB7XHJcbiAgICAgIC8vIEplxZtsaSB0byBixYLEhWQgdXByYXduaWXFhCBpIG1hbXkgZmFsbGJhY2sgZG8gYWRtaW5hXHJcbiAgICAgIGlmIChyZXN1bHQuZXJyb3IuY29kZSA9PT0gJzQyNTAxJyAmJiB1c2VBZG1pbk9uRmFpbHVyZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBQZXJtaXNzaW9uIGRlbmllZCBkdXJpbmcgJHtvcGVyYXRpb25OYW1lfSwgdHJ5aW5nIGFkbWluIGNsaWVudGApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFByw7NiYSB3eWtvbmFuaWEgdGVqIHNhbWVqIG9wZXJhY2ppIHoga2xpZW50ZW0gYWRtaW5pc3RyYXRvcmFcclxuICAgICAgICBjb25zdCBhZG1pblJlc3VsdCA9IGF3YWl0IG9wZXJhdGlvbihzdXBhYmFzZUFkbWluKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAoYWRtaW5SZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICAgIHJldHVybiBoYW5kbGVEYXRhYmFzZUVycm9yKGFkbWluUmVzdWx0LmVycm9yLCBvcGVyYXRpb25OYW1lLCB0aHJvd09uRXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gYWRtaW5SZXN1bHQuZGF0YTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIGhhbmRsZURhdGFiYXNlRXJyb3IocmVzdWx0LmVycm9yLCBvcGVyYXRpb25OYW1lLCB0aHJvd09uRXJyb3IpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gcmVzdWx0LmRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBoYW5kbGVEYXRhYmFzZUVycm9yKGVycm9yLCBvcGVyYXRpb25OYW1lLCB0aHJvd09uRXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFJlcG96eXRvcmlhIGRvc3TEmXB1IGRvIGRhbnljaCAtIHd5c29raSBwb3ppb20gYWJzdHJha2NqaVxyXG5cclxuLyoqXHJcbiAqIFJlcG96eXRvcml1bSB1xbx5dGtvd25pa8Ozd1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHVzZXJSZXBvc2l0b3J5ID0ge1xyXG4gIC8qKlxyXG4gICAqIFBvYmllcmEgcHJvZmlsIHXFvHl0a293bmlrYSBuYSBwb2RzdGF3aWUgemV3bsSZdHJ6bmVnbyBJRCB1d2llcnp5dGVsbmlhbmlhXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGF1dGhJZCAtIElEIHV3aWVyenl0ZWxuaWFuaWEgKG5wLiB6IENsZXJrKVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gLSBQcm9maWwgdcW8eXRrb3duaWthIGx1YiBudWxsXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0QnlBdXRoSWQoYXV0aElkKSB7XHJcbiAgICBpZiAoIWF1dGhJZCkgcmV0dXJuIG51bGw7XHJcbiAgICBcclxuICAgIHJldHVybiBzYWZlUXVlcnlFeGVjdXRpb24oXHJcbiAgICAgIChjbGllbnQpID0+IGNsaWVudFxyXG4gICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCBhdXRoSWQpXHJcbiAgICAgICAgLnNpbmdsZSgpLFxyXG4gICAgICAnZ2V0QnlBdXRoSWQnXHJcbiAgICApO1xyXG4gIH0sXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogVHdvcnp5IG5vd3kgcHJvZmlsIHXFvHl0a293bmlrYVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyUHJvZmlsZSAtIERhbmUgcHJvZmlsdSB1xbx5dGtvd25pa2FcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IC0gVXR3b3J6b255IHByb2ZpbCB1xbx5dGtvd25pa2EgbHViIG51bGxcclxuICAgKi9cclxuICBhc3luYyBjcmVhdGUodXNlclByb2ZpbGUpIHtcclxuICAgIHJldHVybiBzYWZlUXVlcnlFeGVjdXRpb24oXHJcbiAgICAgIChjbGllbnQpID0+IGNsaWVudFxyXG4gICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgICAuaW5zZXJ0KFt1c2VyUHJvZmlsZV0pXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpLFxyXG4gICAgICAnY3JlYXRlVXNlclByb2ZpbGUnLFxyXG4gICAgICB0cnVlIC8vIHphd3N6ZSB1xbx5d2FqIGtsaWVudGEgYWRtaW5hIHByenkgdHdvcnplbml1IHXFvHl0a293bmlrYVxyXG4gICAgKTtcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEFrdHVhbGl6dWplIGlzdG5pZWrEhWN5IHByb2ZpbCB1xbx5dGtvd25pa2FcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gSUQgcHJvZmlsdSB1xbx5dGtvd25pa2FcclxuICAgKiBAcGFyYW0ge09iamVjdH0gdXBkYXRlcyAtIERhbmUgZG8gYWt0dWFsaXphY2ppXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSAtIFpha3R1YWxpem93YW55IHByb2ZpbCB1xbx5dGtvd25pa2EgbHViIG51bGxcclxuICAgKi9cclxuICBhc3luYyB1cGRhdGUodXNlcklkLCB1cGRhdGVzKSB7XHJcbiAgICByZXR1cm4gc2FmZVF1ZXJ5RXhlY3V0aW9uKFxyXG4gICAgICAoY2xpZW50KSA9PiBjbGllbnRcclxuICAgICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgICAgLnVwZGF0ZSh1cGRhdGVzKVxyXG4gICAgICAgIC5lcSgnaWQnLCB1c2VySWQpXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpLFxyXG4gICAgICAndXBkYXRlVXNlclByb2ZpbGUnXHJcbiAgICApO1xyXG4gIH0sXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogUG9iaWVyYSBwcm9maWwgdcW8eXRrb3duaWthIHBvIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIElEIHByb2ZpbHUgdcW8eXRrb3duaWthXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSAtIFByb2ZpbCB1xbx5dGtvd25pa2EgbHViIG51bGxcclxuICAgKi9cclxuICBhc3luYyBnZXRCeUlkKHVzZXJJZCkge1xyXG4gICAgcmV0dXJuIHNhZmVRdWVyeUV4ZWN1dGlvbihcclxuICAgICAgKGNsaWVudCkgPT4gY2xpZW50XHJcbiAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgIC5lcSgnaWQnLCB1c2VySWQpXHJcbiAgICAgICAgLnNpbmdsZSgpLFxyXG4gICAgICAnZ2V0VXNlckJ5SWQnXHJcbiAgICApO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXBvenl0b3JpdW0gb2ZlcnQgc3Vic2tyeXBjamlcclxuICovXHJcbmV4cG9ydCBjb25zdCBvZmZlcnNSZXBvc2l0b3J5ID0ge1xyXG4gIC8qKlxyXG4gICAqIFBvYmllcmEgb2ZlcnR5IHN1YnNrcnlwY2ppIHogZmlsdHJvd2FuaWVtXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGZpbHRlcnMgLSBGaWx0cnkgZG8gemFzdG9zb3dhbmlhXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8QXJyYXk+fSAtIExpc3RhIG9mZXJ0XHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0QWxsKGZpbHRlcnMgPSB7fSkge1xyXG4gICAgLy8gUHJ6eWdvdG93YW5pZSBiYXpvd2VnbyB6YXB5dGFuaWFcclxuICAgIGNvbnN0IHF1ZXJ5QnVpbGRlciA9IChjbGllbnQpID0+IHtcclxuICAgICAgbGV0IHF1ZXJ5ID0gY2xpZW50XHJcbiAgICAgICAgLmZyb20oJ2dyb3VwX3N1YnMnKVxyXG4gICAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICAgKixcclxuICAgICAgICAgIHN1YnNjcmlwdGlvbl9wbGF0Zm9ybXMoKiksXHJcbiAgICAgICAgICBncm91cHMoaWQsIG5hbWUpLFxyXG4gICAgICAgICAgb3duZXI6Z3JvdXBzIWlubmVyKG93bmVyX2lkLCB1c2VyX3Byb2ZpbGVzIWlubmVyKGlkLCBkaXNwbGF5X25hbWUsIGF2YXRhcl91cmwsIHJhdGluZ19hdmcsIHJhdGluZ19jb3VudCwgdmVyaWZpY2F0aW9uX2xldmVsKSlcclxuICAgICAgICBgKVxyXG4gICAgICAgIC5lcSgnc3RhdHVzJywgJ2FjdGl2ZScpO1xyXG4gICAgICBcclxuICAgICAgLy8gWmFzdG9zb3dhbmllIGZpbHRyw7N3XHJcbiAgICAgIGlmIChmaWx0ZXJzLnBsYXRmb3JtSWQpIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwbGF0Zm9ybV9pZCcsIGZpbHRlcnMucGxhdGZvcm1JZCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChmaWx0ZXJzLm1pblByaWNlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBxdWVyeSA9IHF1ZXJ5Lmd0ZSgncHJpY2VfcGVyX3Nsb3QnLCBmaWx0ZXJzLm1pblByaWNlKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKGZpbHRlcnMubWF4UHJpY2UgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdwcmljZV9wZXJfc2xvdCcsIGZpbHRlcnMubWF4UHJpY2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZmlsdGVycy5hdmFpbGFibGVTbG90cyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3QoJ3Nsb3RzX2F2YWlsYWJsZScsIDApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBTb3J0b3dhbmllXHJcbiAgICAgIGNvbnN0IG9yZGVyQnkgPSBmaWx0ZXJzLm9yZGVyQnkgfHwgJ2NyZWF0ZWRfYXQnO1xyXG4gICAgICBjb25zdCBhc2NlbmRpbmcgPSBmaWx0ZXJzLmFzY2VuZGluZyA9PT0gdHJ1ZTtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5vcmRlcihvcmRlckJ5LCB7IGFzY2VuZGluZyB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFBhZ2luYWNqYVxyXG4gICAgICBpZiAoZmlsdGVycy5saW1pdCkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkubGltaXQoZmlsdGVycy5saW1pdCk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChmaWx0ZXJzLm9mZnNldCkge1xyXG4gICAgICAgIHF1ZXJ5ID0gcXVlcnkucmFuZ2UoZmlsdGVycy5vZmZzZXQsIGZpbHRlcnMub2Zmc2V0ICsgKGZpbHRlcnMubGltaXQgfHwgMTApIC0gMSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBxdWVyeTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIHJldHVybiBzYWZlUXVlcnlFeGVjdXRpb24ocXVlcnlCdWlsZGVyLCAnZ2V0QWxsT2ZmZXJzJykgfHwgW107XHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBQb2JpZXJhIG9mZXJ0xJkgc3Vic2tyeXBjamkgcG8gSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb2ZmZXJJZCAtIElEIG9mZXJ0eVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gLSBPZmVydGEgc3Vic2tyeXBjamkgbHViIG51bGxcclxuICAgKi9cclxuICBhc3luYyBnZXRCeUlkKG9mZmVySWQpIHtcclxuICAgIHJldHVybiBzYWZlUXVlcnlFeGVjdXRpb24oXHJcbiAgICAgIChjbGllbnQpID0+IGNsaWVudFxyXG4gICAgICAgIC5mcm9tKCdncm91cF9zdWJzJylcclxuICAgICAgICAuc2VsZWN0KGBcclxuICAgICAgICAgICosXHJcbiAgICAgICAgICBzdWJzY3JpcHRpb25fcGxhdGZvcm1zKCopLFxyXG4gICAgICAgICAgZ3JvdXBzKGlkLCBuYW1lLCBkZXNjcmlwdGlvbiksXHJcbiAgICAgICAgICBvd25lcjpncm91cHMhaW5uZXIob3duZXJfaWQsIHVzZXJfcHJvZmlsZXMhaW5uZXIoaWQsIGRpc3BsYXlfbmFtZSwgYXZhdGFyX3VybCwgcmF0aW5nX2F2ZywgcmF0aW5nX2NvdW50LCB2ZXJpZmljYXRpb25fbGV2ZWwsIGJpbykpXHJcbiAgICAgICAgYClcclxuICAgICAgICAuZXEoJ2lkJywgb2ZmZXJJZClcclxuICAgICAgICAuc2luZ2xlKCksXHJcbiAgICAgICdnZXRPZmZlckJ5SWQnXHJcbiAgICApO1xyXG4gIH0sXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogVHdvcnp5IG5vd8SFIG9mZXJ0xJkgc3Vic2tyeXBjamlcclxuICAgKiBAcGFyYW0ge09iamVjdH0gb2ZmZXJEYXRhIC0gRGFuZSBvZmVydHlcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IC0gVXR3b3J6b25hIG9mZXJ0YSBsdWIgbnVsbFxyXG4gICAqL1xyXG4gIGFzeW5jIGNyZWF0ZShvZmZlckRhdGEpIHtcclxuICAgIHJldHVybiBzYWZlUXVlcnlFeGVjdXRpb24oXHJcbiAgICAgIChjbGllbnQpID0+IGNsaWVudFxyXG4gICAgICAgIC5mcm9tKCdncm91cF9zdWJzJylcclxuICAgICAgICAuaW5zZXJ0KFtvZmZlckRhdGFdKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKSxcclxuICAgICAgJ2NyZWF0ZU9mZmVyJ1xyXG4gICAgKTtcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEFrdHVhbGl6dWplIG9mZXJ0xJkgc3Vic2tyeXBjamlcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb2ZmZXJJZCAtIElEIG9mZXJ0eVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1cGRhdGVzIC0gRGFuZSBkbyBha3R1YWxpemFjamlcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IC0gWmFrdHVhbGl6b3dhbmEgb2ZlcnRhIGx1YiBudWxsIFxyXG4gICAqL1xyXG4gIGFzeW5jIHVwZGF0ZShvZmZlcklkLCB1cGRhdGVzKSB7XHJcbiAgICByZXR1cm4gc2FmZVF1ZXJ5RXhlY3V0aW9uKFxyXG4gICAgICAoY2xpZW50KSA9PiBjbGllbnRcclxuICAgICAgICAuZnJvbSgnZ3JvdXBfc3VicycpXHJcbiAgICAgICAgLnVwZGF0ZSh1cGRhdGVzKVxyXG4gICAgICAgIC5lcSgnaWQnLCBvZmZlcklkKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKSxcclxuICAgICAgJ3VwZGF0ZU9mZmVyJ1xyXG4gICAgKTtcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIFVzdXdhIG9mZXJ0xJkgc3Vic2tyeXBjamlcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gb2ZmZXJJZCAtIElEIG9mZXJ0eVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIEN6eSBvcGVyYWNqYSBzacSZIHBvd2lvZMWCYVxyXG4gICAqL1xyXG4gIGFzeW5jIGRlbGV0ZShvZmZlcklkKSB7XHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzYWZlUXVlcnlFeGVjdXRpb24oXHJcbiAgICAgIChjbGllbnQpID0+IGNsaWVudFxyXG4gICAgICAgIC5mcm9tKCdncm91cF9zdWJzJylcclxuICAgICAgICAuZGVsZXRlKClcclxuICAgICAgICAuZXEoJ2lkJywgb2ZmZXJJZCksXHJcbiAgICAgICdkZWxldGVPZmZlcidcclxuICAgICk7XHJcbiAgICBcclxuICAgIHJldHVybiByZXN1bHQgIT09IG51bGw7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJlcG96eXRvcml1bSBwbGF0Zm9ybSBzdWJza3J5cGNqaVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHBsYXRmb3Jtc1JlcG9zaXRvcnkgPSB7XHJcbiAgLyoqXHJcbiAgICogUG9iaWVyYSB3c3p5c3RraWUgYWt0eXduZSBwbGF0Zm9ybXkgc3Vic2tyeXBjamlcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IC0gTGlzdGEgcGxhdGZvcm1cclxuICAgKi9cclxuICBhc3luYyBnZXRBbGwoKSB7XHJcbiAgICByZXR1cm4gc2FmZVF1ZXJ5RXhlY3V0aW9uKFxyXG4gICAgICAoY2xpZW50KSA9PiBjbGllbnRcclxuICAgICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3BsYXRmb3JtcycpXHJcbiAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgLmVxKCdhY3RpdmUnLCB0cnVlKVxyXG4gICAgICAgIC5vcmRlcignbmFtZScpLFxyXG4gICAgICAnZ2V0QWxsUGxhdGZvcm1zJ1xyXG4gICAgKSB8fCBbXTtcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIFBvYmllcmEgcGxhdGZvcm3EmSBwbyBJRFxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwbGF0Zm9ybUlkIC0gSUQgcGxhdGZvcm15XHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSAtIFBsYXRmb3JtYSBsdWIgbnVsbFxyXG4gICAqL1xyXG4gIGFzeW5jIGdldEJ5SWQocGxhdGZvcm1JZCkge1xyXG4gICAgcmV0dXJuIHNhZmVRdWVyeUV4ZWN1dGlvbihcclxuICAgICAgKGNsaWVudCkgPT4gY2xpZW50XHJcbiAgICAgICAgLmZyb20oJ3N1YnNjcmlwdGlvbl9wbGF0Zm9ybXMnKVxyXG4gICAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAgIC5lcSgnaWQnLCBwbGF0Zm9ybUlkKVxyXG4gICAgICAgIC5zaW5nbGUoKSxcclxuICAgICAgJ2dldFBsYXRmb3JtQnlJZCdcclxuICAgICk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJlcG96eXRvcml1bSB6YWt1cMOzd1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IHB1cmNoYXNlc1JlcG9zaXRvcnkgPSB7XHJcbiAgLyoqXHJcbiAgICogVHdvcnp5IG5vd3kgemFrdXBcclxuICAgKiBAcGFyYW0ge09iamVjdH0gcHVyY2hhc2VEYXRhIC0gRGFuZSB6YWt1cHVcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IC0gVXR3b3J6b255IHpha3VwIGx1YiBudWxsXHJcbiAgICovXHJcbiAgYXN5bmMgY3JlYXRlKHB1cmNoYXNlRGF0YSkge1xyXG4gICAgcmV0dXJuIHNhZmVRdWVyeUV4ZWN1dGlvbihcclxuICAgICAgKGNsaWVudCkgPT4gY2xpZW50XHJcbiAgICAgICAgLmZyb20oJ3B1cmNoYXNlX3JlY29yZHMnKVxyXG4gICAgICAgIC5pbnNlcnQoW3B1cmNoYXNlRGF0YV0pXHJcbiAgICAgICAgLnNlbGVjdCgpXHJcbiAgICAgICAgLnNpbmdsZSgpLFxyXG4gICAgICAnY3JlYXRlUHVyY2hhc2UnLFxyXG4gICAgICB0cnVlIC8vIHXFvHl3YWoga2xpZW50YSBhZG1pblxyXG4gICAgKTtcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIFBvYmllcmEgemFrdXAgcG8gSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHVyY2hhc2VJZCAtIElEIHpha3VwdVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gLSBaYWt1cCBsdWIgbnVsbFxyXG4gICAqL1xyXG4gIGFzeW5jIGdldEJ5SWQocHVyY2hhc2VJZCkge1xyXG4gICAgcmV0dXJuIHNhZmVRdWVyeUV4ZWN1dGlvbihcclxuICAgICAgKGNsaWVudCkgPT4gY2xpZW50XHJcbiAgICAgICAgLmZyb20oJ3B1cmNoYXNlX3JlY29yZHMnKVxyXG4gICAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICAgKixcclxuICAgICAgICAgIGdyb3VwX3N1Yjpncm91cF9zdWJzKFxyXG4gICAgICAgICAgICAqLFxyXG4gICAgICAgICAgICBzdWJzY3JpcHRpb25fcGxhdGZvcm1zKFxyXG4gICAgICAgICAgICAgIGlkLFxyXG4gICAgICAgICAgICAgIG5hbWUsXHJcbiAgICAgICAgICAgICAgaWNvblxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgYClcclxuICAgICAgICAuZXEoJ2lkJywgcHVyY2hhc2VJZClcclxuICAgICAgICAuc2luZ2xlKCksXHJcbiAgICAgICdnZXRQdXJjaGFzZUJ5SWQnXHJcbiAgICApO1xyXG4gIH0sXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogQWt0dWFsaXp1amUgemFrdXBcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gcHVyY2hhc2VJZCAtIElEIHpha3VwdVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1cGRhdGVzIC0gRGFuZSBkbyBha3R1YWxpemFjamlcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IC0gWmFrdHVhbGl6b3dhbnkgemFrdXAgbHViIG51bGxcclxuICAgKi9cclxuICBhc3luYyB1cGRhdGUocHVyY2hhc2VJZCwgdXBkYXRlcykge1xyXG4gICAgcmV0dXJuIHNhZmVRdWVyeUV4ZWN1dGlvbihcclxuICAgICAgKGNsaWVudCkgPT4gY2xpZW50XHJcbiAgICAgICAgLmZyb20oJ3B1cmNoYXNlX3JlY29yZHMnKVxyXG4gICAgICAgIC51cGRhdGUodXBkYXRlcylcclxuICAgICAgICAuZXEoJ2lkJywgcHVyY2hhc2VJZClcclxuICAgICAgICAuc2VsZWN0KClcclxuICAgICAgICAuc2luZ2xlKCksXHJcbiAgICAgICd1cGRhdGVQdXJjaGFzZSdcclxuICAgICk7XHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBQb2JpZXJhIHpha3VweSB1xbx5dGtvd25pa2FcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXNlcklkIC0gSUQgdcW8eXRrb3duaWthXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8QXJyYXk+fSAtIExpc3RhIHpha3Vww7N3XHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0QnlVc2VySWQodXNlcklkKSB7XHJcbiAgICByZXR1cm4gc2FmZVF1ZXJ5RXhlY3V0aW9uKFxyXG4gICAgICAoY2xpZW50KSA9PiBjbGllbnRcclxuICAgICAgICAuZnJvbSgncHVyY2hhc2VfcmVjb3JkcycpXHJcbiAgICAgICAgLnNlbGVjdChgXHJcbiAgICAgICAgICAqLFxyXG4gICAgICAgICAgZ3JvdXBfc3ViOmdyb3VwX3N1YnMoXHJcbiAgICAgICAgICAgICosXHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbl9wbGF0Zm9ybXMoXHJcbiAgICAgICAgICAgICAgaWQsXHJcbiAgICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgICBpY29uXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICAgIClcclxuICAgICAgICBgKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcclxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSksXHJcbiAgICAgICdnZXRVc2VyUHVyY2hhc2VzJ1xyXG4gICAgKSB8fCBbXTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBFa3Nwb3J0IHBvZHN0YXdvd2VnbyBrbGllbnRhIFN1cGFiYXNlXHJcbmV4cG9ydCBkZWZhdWx0IHN1cGFiYXNlOyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZUFkbWluIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJjb25zb2xlIiwiZXJyb3IiLCJzdXBhYmFzZSIsImhhbmRsZURhdGFiYXNlRXJyb3IiLCJvcGVyYXRpb24iLCJ0aHJvd0Vycm9yIiwic3RhbmRhcmRFcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwiZGV0YWlscyIsInN0YWNrIiwiZW5oYW5jZWRFcnJvciIsIkVycm9yIiwic2FmZVF1ZXJ5RXhlY3V0aW9uIiwib3BlcmF0aW9uTmFtZSIsInVzZUFkbWluT25GYWlsdXJlIiwidGhyb3dPbkVycm9yIiwicmVzdWx0IiwibG9nIiwiYWRtaW5SZXN1bHQiLCJkYXRhIiwidXNlclJlcG9zaXRvcnkiLCJnZXRCeUF1dGhJZCIsImF1dGhJZCIsImNsaWVudCIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImNyZWF0ZSIsInVzZXJQcm9maWxlIiwiaW5zZXJ0IiwidXBkYXRlIiwidXNlcklkIiwidXBkYXRlcyIsImdldEJ5SWQiLCJvZmZlcnNSZXBvc2l0b3J5IiwiZ2V0QWxsIiwiZmlsdGVycyIsInF1ZXJ5QnVpbGRlciIsInF1ZXJ5IiwicGxhdGZvcm1JZCIsIm1pblByaWNlIiwidW5kZWZpbmVkIiwiZ3RlIiwibWF4UHJpY2UiLCJsdGUiLCJhdmFpbGFibGVTbG90cyIsImd0Iiwib3JkZXJCeSIsImFzY2VuZGluZyIsIm9yZGVyIiwibGltaXQiLCJvZmZzZXQiLCJyYW5nZSIsIm9mZmVySWQiLCJvZmZlckRhdGEiLCJkZWxldGUiLCJwbGF0Zm9ybXNSZXBvc2l0b3J5IiwicHVyY2hhc2VzUmVwb3NpdG9yeSIsInB1cmNoYXNlRGF0YSIsInB1cmNoYXNlSWQiLCJnZXRCeVVzZXJJZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database/supabase-client.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@clerk","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/cookie","vendor-chunks/map-obj","vendor-chunks/no-case","vendor-chunks/lower-case","vendor-chunks/snakecase-keys","vendor-chunks/snake-case","vendor-chunks/dot-case","vendor-chunks/@supabase","vendor-chunks/whatwg-url","vendor-chunks/tr46","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();