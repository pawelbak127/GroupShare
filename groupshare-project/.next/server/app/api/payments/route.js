"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/payments/route";
exports.ids = ["app/api/payments/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpayments%2Froute&page=%2Fapi%2Fpayments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpayments%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpayments%2Froute&page=%2Fapi%2Fpayments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpayments%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_payments_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/payments/route.js */ \"(rsc)/./src/app/api/payments/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/payments/route\",\n        pathname: \"/api/payments\",\n        filename: \"route\",\n        bundlePath: \"app/api/payments/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\bacze\\\\Project\\\\GroupShare\\\\groupshare-project\\\\src\\\\app\\\\api\\\\payments\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_payments_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/payments/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwYXltZW50cyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGcGF5bWVudHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZwYXltZW50cyUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUM0QztBQUN6SDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8/ZjFhMyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxiYWN6ZVxcXFxQcm9qZWN0XFxcXEdyb3VwU2hhcmVcXFxcZ3JvdXBzaGFyZS1wcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXHBheW1lbnRzXFxcXHJvdXRlLmpzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9wYXltZW50cy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3BheW1lbnRzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9wYXltZW50cy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGJhY3plXFxcXFByb2plY3RcXFxcR3JvdXBTaGFyZVxcXFxncm91cHNoYXJlLXByb2plY3RcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxccGF5bWVudHNcXFxccm91dGUuanNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3BheW1lbnRzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpayments%2Froute&page=%2Fapi%2Fpayments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpayments%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/payments/route.js":
/*!***************************************!*\
  !*** ./src/app/api/payments/route.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/currentUser.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/database/supabase-admin-client */ \"(rsc)/./src/lib/database/supabase-admin-client.js\");\n\n\n\n\n/**\r\n * POST /api/payments\r\n * Przetwarza płatność za subskrypcję i automatycznie przyznaje dostęp\r\n */ async function POST(request) {\n    try {\n        const { purchaseId, paymentMethod } = await request.json();\n        // Sprawdź autentykację\n        const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__.currentUser)();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        console.log(\"Processing payment for user:\", user.id);\n        // Pobierz profil użytkownika bezpośrednio z Supabase używając supabaseAdmin\n        let userProfile;\n        try {\n            const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"user_profiles\").select(\"id\").eq(\"external_auth_id\", user.id).single();\n            if (error) {\n                console.error(\"Error fetching user profile:\", error);\n                throw new Error(\"Failed to fetch user profile\");\n            }\n            if (!data) {\n                console.log(\"User profile not found, creating new profile\");\n                // Tworzenie nowego profilu\n                const newProfile = {\n                    external_auth_id: user.id,\n                    display_name: user.firstName ? `${user.firstName} ${user.lastName || \"\"}`.trim() : user.username || \"Nowy użytkownik\",\n                    email: user.emailAddresses[0]?.emailAddress || \"\",\n                    phone_number: user.phoneNumbers[0]?.phoneNumber || null,\n                    profile_type: \"buyer\",\n                    verification_level: \"basic\",\n                    created_at: new Date().toISOString(),\n                    updated_at: new Date().toISOString()\n                };\n                const { data: createdProfile, error: createError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"user_profiles\").insert([\n                    newProfile\n                ]).select(\"id\").single();\n                if (createError) {\n                    console.error(\"Error creating user profile:\", createError);\n                    throw new Error(\"Failed to create user profile\");\n                }\n                userProfile = createdProfile;\n            } else {\n                userProfile = data;\n            }\n            console.log(\"User profile found/created:\", userProfile.id);\n        } catch (error) {\n            console.error(\"Error fetching or creating user profile:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to retrieve user profile\",\n                details: error.message\n            }, {\n                status: 500\n            });\n        }\n        // Pobierz zakup i powiązaną ofertę używając supabaseAdmin\n        const { data: purchase, error: purchaseError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"purchase_records\").select(`\r\n        id, status, group_sub_id, user_id,\r\n        group_sub:group_subs(price_per_slot, currency, groups(owner_id))\r\n      `).eq(\"id\", purchaseId).single();\n        if (purchaseError) {\n            console.error(\"Error fetching purchase:\", purchaseError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: purchaseError.message || \"Purchase not found\",\n                code: purchaseError.code\n            }, {\n                status: 404\n            });\n        }\n        if (!purchase) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Purchase record not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Sprawdź, czy zakup należy do użytkownika\n        if (purchase.user_id !== userProfile.id) {\n            console.warn(`Security warning: User ${userProfile.id} attempted to process payment for purchase ${purchaseId} belonging to user ${purchase.user_id}`);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"You do not have permission to process this payment\"\n            }, {\n                status: 403\n            });\n        }\n        // Pobierz właściciela grupy\n        const sellerId = purchase.group_sub.groups.owner_id;\n        if (!sellerId) {\n            console.error(\"Error: Could not determine seller ID for transaction\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Could not determine seller for transaction\"\n            }, {\n                status: 500\n            });\n        }\n        // Wywołaj funkcje przetwarzania płatności bezpośrednio z supabaseAdmin\n        // Krok 1: Utwórz transakcję\n        const transactionId = await createTransaction(userProfile.id, sellerId, purchase.group_sub_id, purchaseId, purchase.group_sub.price_per_slot, paymentMethod);\n        if (!transactionId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create transaction\"\n            }, {\n                status: 500\n            });\n        }\n        // Krok 2: Zaktualizuj zakup i ukończ transakcję\n        const paymentCompleted = await completeTransaction(transactionId, purchaseId);\n        if (!paymentCompleted) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to complete transaction\"\n            }, {\n                status: 500\n            });\n        }\n        // Wygeneruj token dostępu\n        const token = generateToken();\n        try {\n            // Zapisanie tokenu dostępu za pomocą klienta administratora\n            const { error: insertError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"access_tokens\").insert({\n                purchase_record_id: purchaseId,\n                token_hash: hashToken(token),\n                expires_at: new Date(Date.now() + 30 * 60 * 1000).toISOString(),\n                used: false\n            });\n            if (insertError) {\n                console.error(\"Error saving access token:\", insertError);\n            // Kontynuujemy, ale logujemy błąd\n            }\n        } catch (insertError) {\n            console.error(\"Exception when saving access token:\", insertError);\n        // Kontynuujemy mimo błędu, płatność już została zrealizowana\n        }\n        // Zaloguj operację w security_logs\n        await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"security_logs\").insert({\n            user_id: userProfile.id,\n            action_type: \"payment_processed\",\n            resource_type: \"purchase_record\",\n            resource_id: purchaseId,\n            status: \"success\",\n            details: {\n                transaction_id: transactionId,\n                payment_method: paymentMethod,\n                timestamp: new Date().toISOString()\n            }\n        });\n        // Tworzymy URL dostępu\n        const accessUrl = `${\"http://localhost:3000\"}/access?id=${purchaseId}&token=${token}`;\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Payment processed successfully\",\n            purchaseId: purchaseId,\n            accessUrl: accessUrl\n        });\n    } catch (error) {\n        console.error(\"Error processing payment:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message || \"Failed to process payment\"\n        }, {\n            status: 500\n        });\n    }\n}\n// Funkcja do tworzenia transakcji\nasync function createTransaction(buyerId, sellerId, groupSubId, purchaseRecordId, amount, paymentMethod) {\n    try {\n        // Stała prowizja platformy - 5%\n        const platformFeePercent = 0.05;\n        const platformFee = amount * platformFeePercent;\n        const sellerAmount = amount - platformFee;\n        const paymentId = \"pmt_\" + Math.random().toString(36).substr(2, 9);\n        const { data, error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"transactions\").insert({\n            buyer_id: buyerId,\n            seller_id: sellerId,\n            group_sub_id: groupSubId,\n            purchase_record_id: purchaseRecordId,\n            amount: amount,\n            platform_fee: platformFee,\n            seller_amount: sellerAmount,\n            currency: \"PLN\",\n            payment_method: paymentMethod,\n            payment_provider: \"stripe\",\n            payment_id: paymentId,\n            status: \"pending\",\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        }).select(\"id\").single();\n        if (error) {\n            console.error(\"Error creating transaction:\", error);\n            return null;\n        }\n        return data.id;\n    } catch (error) {\n        console.error(\"Exception creating transaction:\", error);\n        return null;\n    }\n}\n// Funkcja do ukończenia transakcji\nasync function completeTransaction(transactionId, purchaseRecordId) {\n    try {\n        // Zaktualizuj transakcję jako ukończoną\n        const { error: transactionError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"transactions\").update({\n            status: \"completed\",\n            completed_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        }).eq(\"id\", transactionId);\n        if (transactionError) {\n            console.error(\"Error completing transaction:\", transactionError);\n            return false;\n        }\n        // Zaktualizuj rekord zakupu jako ukończony i z dostępem\n        const { error: purchaseError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"purchase_records\").update({\n            status: \"completed\",\n            access_provided: true,\n            access_provided_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        }).eq(\"id\", purchaseRecordId);\n        if (purchaseError) {\n            console.error(\"Error updating purchase record:\", purchaseError);\n            return false;\n        }\n        return true;\n    } catch (error) {\n        console.error(\"Exception completing transaction:\", error);\n        return false;\n    }\n}\n// Funkcja generująca bezpieczny token\nfunction generateToken() {\n    return crypto__WEBPACK_IMPORTED_MODULE_1___default().randomBytes(32).toString(\"hex\");\n}\n// Bezpieczna funkcja hashująca token\nfunction hashToken(token) {\n    return crypto__WEBPACK_IMPORTED_MODULE_1___default().createHash(\"sha256\").update(token + (process.env.TOKEN_SALT || \"\")).digest(\"hex\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLO0lBQ3RCLE9BQU8zRCx3REFDTSxDQUFDLFVBQ1htRyxNQUFNLENBQUN4QyxRQUFTZ0IsQ0FBQUEsUUFBUUMsR0FBRyxDQUFDNkIsVUFBVSxJQUFJLEVBQUMsR0FDM0NDLE1BQU0sQ0FBQztBQUNaIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2FwcC9hcGkvcGF5bWVudHMvcm91dGUuanM/ZTY4ZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGN1cnJlbnRVc2VyIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xyXG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcbmltcG9ydCBzdXBhYmFzZUFkbWluIGZyb20gJ0AvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWFkbWluLWNsaWVudCc7XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL3BheW1lbnRzXHJcbiAqIFByemV0d2FyemEgcMWCYXRub8WbxIcgemEgc3Vic2tyeXBjasSZIGkgYXV0b21hdHljem5pZSBwcnp5em5hamUgZG9zdMSZcFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdCkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IHB1cmNoYXNlSWQsIHBheW1lbnRNZXRob2QgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiBhdXRlbnR5a2FjasSZXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgY3VycmVudFVzZXIoKTtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgcGF5bWVudCBmb3IgdXNlcjonLCB1c2VyLmlkKTtcclxuICAgIFxyXG4gICAgLy8gUG9iaWVyeiBwcm9maWwgdcW8eXRrb3duaWthIGJlenBvxZtyZWRuaW8geiBTdXBhYmFzZSB1xbx5d2FqxIVjIHN1cGFiYXNlQWRtaW5cclxuICAgIGxldCB1c2VyUHJvZmlsZTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIHVzZXIuaWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciBwcm9maWxlOicsIGVycm9yKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCB1c2VyIHByb2ZpbGUnKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1VzZXIgcHJvZmlsZSBub3QgZm91bmQsIGNyZWF0aW5nIG5ldyBwcm9maWxlJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gVHdvcnplbmllIG5vd2VnbyBwcm9maWx1XHJcbiAgICAgICAgY29uc3QgbmV3UHJvZmlsZSA9IHtcclxuICAgICAgICAgIGV4dGVybmFsX2F1dGhfaWQ6IHVzZXIuaWQsXHJcbiAgICAgICAgICBkaXNwbGF5X25hbWU6IHVzZXIuZmlyc3ROYW1lIFxyXG4gICAgICAgICAgICA/IGAke3VzZXIuZmlyc3ROYW1lfSAke3VzZXIubGFzdE5hbWUgfHwgJyd9YC50cmltKCkgXHJcbiAgICAgICAgICAgIDogKHVzZXIudXNlcm5hbWUgfHwgJ05vd3kgdcW8eXRrb3duaWsnKSxcclxuICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsQWRkcmVzc2VzWzBdPy5lbWFpbEFkZHJlc3MgfHwgJycsXHJcbiAgICAgICAgICBwaG9uZV9udW1iZXI6IHVzZXIucGhvbmVOdW1iZXJzWzBdPy5waG9uZU51bWJlciB8fCBudWxsLFxyXG4gICAgICAgICAgcHJvZmlsZV90eXBlOiAnYnV5ZXInLFxyXG4gICAgICAgICAgdmVyaWZpY2F0aW9uX2xldmVsOiAnYmFzaWMnLFxyXG4gICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGNyZWF0ZWRQcm9maWxlLCBlcnJvcjogY3JlYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgICAgIC5pbnNlcnQoW25ld1Byb2ZpbGVdKVxyXG4gICAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChjcmVhdGVFcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgdXNlciBwcm9maWxlOicsIGNyZWF0ZUVycm9yKTtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSB1c2VyIHByb2ZpbGUnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdXNlclByb2ZpbGUgPSBjcmVhdGVkUHJvZmlsZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB1c2VyUHJvZmlsZSA9IGRhdGE7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIHByb2ZpbGUgZm91bmQvY3JlYXRlZDonLCB1c2VyUHJvZmlsZS5pZCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvciBjcmVhdGluZyB1c2VyIHByb2ZpbGU6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byByZXRyaWV2ZSB1c2VyIHByb2ZpbGUnLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFBvYmllcnogemFrdXAgaSBwb3dpxIV6YW7EhSBvZmVydMSZIHXFvHl3YWrEhWMgc3VwYWJhc2VBZG1pblxyXG4gICAgY29uc3QgeyBkYXRhOiBwdXJjaGFzZSwgZXJyb3I6IHB1cmNoYXNlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3B1cmNoYXNlX3JlY29yZHMnKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICBpZCwgc3RhdHVzLCBncm91cF9zdWJfaWQsIHVzZXJfaWQsXHJcbiAgICAgICAgZ3JvdXBfc3ViOmdyb3VwX3N1YnMocHJpY2VfcGVyX3Nsb3QsIGN1cnJlbmN5LCBncm91cHMob3duZXJfaWQpKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ2lkJywgcHVyY2hhc2VJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAocHVyY2hhc2VFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBwdXJjaGFzZTonLCBwdXJjaGFzZUVycm9yKTtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6IHB1cmNoYXNlRXJyb3IubWVzc2FnZSB8fCAnUHVyY2hhc2Ugbm90IGZvdW5kJywgY29kZTogcHVyY2hhc2VFcnJvci5jb2RlIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICghcHVyY2hhc2UpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6ICdQdXJjaGFzZSByZWNvcmQgbm90IGZvdW5kJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiwgY3p5IHpha3VwIG5hbGXFvHkgZG8gdcW8eXRrb3duaWthXHJcbiAgICBpZiAocHVyY2hhc2UudXNlcl9pZCAhPT0gdXNlclByb2ZpbGUuaWQpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBTZWN1cml0eSB3YXJuaW5nOiBVc2VyICR7dXNlclByb2ZpbGUuaWR9IGF0dGVtcHRlZCB0byBwcm9jZXNzIHBheW1lbnQgZm9yIHB1cmNoYXNlICR7cHVyY2hhc2VJZH0gYmVsb25naW5nIHRvIHVzZXIgJHtwdXJjaGFzZS51c2VyX2lkfWApO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1lvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIHByb2Nlc3MgdGhpcyBwYXltZW50JyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBQb2JpZXJ6IHfFgmHFm2NpY2llbGEgZ3J1cHlcclxuICAgIGNvbnN0IHNlbGxlcklkID0gcHVyY2hhc2UuZ3JvdXBfc3ViLmdyb3Vwcy5vd25lcl9pZDtcclxuICAgIGlmICghc2VsbGVySWQpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3I6IENvdWxkIG5vdCBkZXRlcm1pbmUgc2VsbGVyIElEIGZvciB0cmFuc2FjdGlvbicpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0NvdWxkIG5vdCBkZXRlcm1pbmUgc2VsbGVyIGZvciB0cmFuc2FjdGlvbicgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gV3l3b8WCYWogZnVua2NqZSBwcnpldHdhcnphbmlhIHDFgmF0bm/Fm2NpIGJlenBvxZtyZWRuaW8geiBzdXBhYmFzZUFkbWluXHJcbiAgICAvLyBLcm9rIDE6IFV0d8OzcnogdHJhbnNha2NqxJlcclxuICAgIGNvbnN0IHRyYW5zYWN0aW9uSWQgPSBhd2FpdCBjcmVhdGVUcmFuc2FjdGlvbihcclxuICAgICAgdXNlclByb2ZpbGUuaWQsXHJcbiAgICAgIHNlbGxlcklkLFxyXG4gICAgICBwdXJjaGFzZS5ncm91cF9zdWJfaWQsXHJcbiAgICAgIHB1cmNoYXNlSWQsXHJcbiAgICAgIHB1cmNoYXNlLmdyb3VwX3N1Yi5wcmljZV9wZXJfc2xvdCxcclxuICAgICAgcGF5bWVudE1ldGhvZFxyXG4gICAgKTtcclxuICAgIFxyXG4gICAgaWYgKCF0cmFuc2FjdGlvbklkKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSB0cmFuc2FjdGlvbicgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gS3JvayAyOiBaYWt0dWFsaXp1aiB6YWt1cCBpIHVrb8WEY3ogdHJhbnNha2NqxJlcclxuICAgIGNvbnN0IHBheW1lbnRDb21wbGV0ZWQgPSBhd2FpdCBjb21wbGV0ZVRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSWQsIHB1cmNoYXNlSWQpO1xyXG4gICAgXHJcbiAgICBpZiAoIXBheW1lbnRDb21wbGV0ZWQpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY29tcGxldGUgdHJhbnNhY3Rpb24nIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFd5Z2VuZXJ1aiB0b2tlbiBkb3N0xJlwdVxyXG4gICAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKCk7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFphcGlzYW5pZSB0b2tlbnUgZG9zdMSZcHUgemEgcG9tb2PEhSBrbGllbnRhIGFkbWluaXN0cmF0b3JhXHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2FjY2Vzc190b2tlbnMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgcHVyY2hhc2VfcmVjb3JkX2lkOiBwdXJjaGFzZUlkLFxyXG4gICAgICAgICAgdG9rZW5faGFzaDogaGFzaFRva2VuKHRva2VuKSwgXHJcbiAgICAgICAgICBleHBpcmVzX2F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCksIC8vIDMwIG1pbnV0XHJcbiAgICAgICAgICB1c2VkOiBmYWxzZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICBpZiAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgYWNjZXNzIHRva2VuOicsIGluc2VydEVycm9yKTtcclxuICAgICAgICAvLyBLb250eW51dWplbXksIGFsZSBsb2d1amVteSBixYLEhWRcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoaW5zZXJ0RXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIHdoZW4gc2F2aW5nIGFjY2VzcyB0b2tlbjonLCBpbnNlcnRFcnJvcik7XHJcbiAgICAgIC8vIEtvbnR5bnV1amVteSBtaW1vIGLFgsSZZHUsIHDFgmF0bm/Fm8SHIGp1xbwgem9zdGHFgmEgenJlYWxpem93YW5hXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFphbG9ndWogb3BlcmFjasSZIHcgc2VjdXJpdHlfbG9nc1xyXG4gICAgYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc2VjdXJpdHlfbG9ncycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIHVzZXJfaWQ6IHVzZXJQcm9maWxlLmlkLFxyXG4gICAgICAgIGFjdGlvbl90eXBlOiAncGF5bWVudF9wcm9jZXNzZWQnLFxyXG4gICAgICAgIHJlc291cmNlX3R5cGU6ICdwdXJjaGFzZV9yZWNvcmQnLFxyXG4gICAgICAgIHJlc291cmNlX2lkOiBwdXJjaGFzZUlkLFxyXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgIGRldGFpbHM6IHtcclxuICAgICAgICAgIHRyYW5zYWN0aW9uX2lkOiB0cmFuc2FjdGlvbklkLFxyXG4gICAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICBcclxuICAgIC8vIFR3b3J6eW15IFVSTCBkb3N0xJlwdVxyXG4gICAgY29uc3QgYWNjZXNzVXJsID0gYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTH0vYWNjZXNzP2lkPSR7cHVyY2hhc2VJZH0mdG9rZW49JHt0b2tlbn1gO1xyXG4gICAgXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBtZXNzYWdlOiAnUGF5bWVudCBwcm9jZXNzZWQgc3VjY2Vzc2Z1bGx5JyxcclxuICAgICAgcHVyY2hhc2VJZDogcHVyY2hhc2VJZCxcclxuICAgICAgYWNjZXNzVXJsOiBhY2Nlc3NVcmxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIHBheW1lbnQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gcHJvY2VzcyBwYXltZW50JyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBGdW5rY2phIGRvIHR3b3J6ZW5pYSB0cmFuc2FrY2ppXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRyYW5zYWN0aW9uKGJ1eWVySWQsIHNlbGxlcklkLCBncm91cFN1YklkLCBwdXJjaGFzZVJlY29yZElkLCBhbW91bnQsIHBheW1lbnRNZXRob2QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gU3RhxYJhIHByb3dpemphIHBsYXRmb3JteSAtIDUlXHJcbiAgICBjb25zdCBwbGF0Zm9ybUZlZVBlcmNlbnQgPSAwLjA1O1xyXG4gICAgY29uc3QgcGxhdGZvcm1GZWUgPSBhbW91bnQgKiBwbGF0Zm9ybUZlZVBlcmNlbnQ7XHJcbiAgICBjb25zdCBzZWxsZXJBbW91bnQgPSBhbW91bnQgLSBwbGF0Zm9ybUZlZTtcclxuICAgIFxyXG4gICAgY29uc3QgcGF5bWVudElkID0gJ3BtdF8nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xyXG4gICAgXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd0cmFuc2FjdGlvbnMnKVxyXG4gICAgICAuaW5zZXJ0KHtcclxuICAgICAgICBidXllcl9pZDogYnV5ZXJJZCxcclxuICAgICAgICBzZWxsZXJfaWQ6IHNlbGxlcklkLFxyXG4gICAgICAgIGdyb3VwX3N1Yl9pZDogZ3JvdXBTdWJJZCxcclxuICAgICAgICBwdXJjaGFzZV9yZWNvcmRfaWQ6IHB1cmNoYXNlUmVjb3JkSWQsXHJcbiAgICAgICAgYW1vdW50OiBhbW91bnQsXHJcbiAgICAgICAgcGxhdGZvcm1fZmVlOiBwbGF0Zm9ybUZlZSxcclxuICAgICAgICBzZWxsZXJfYW1vdW50OiBzZWxsZXJBbW91bnQsXHJcbiAgICAgICAgY3VycmVuY3k6ICdQTE4nLCAvLyBEb215xZtsbmEgd2FsdXRhXHJcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IHBheW1lbnRNZXRob2QsXHJcbiAgICAgICAgcGF5bWVudF9wcm92aWRlcjogJ3N0cmlwZScsIC8vIE1vxbxlbXkgZG9zdG9zb3dhxIcgdyB6YWxlxbxub8WbY2kgb2Qgd3lib3J1XHJcbiAgICAgICAgcGF5bWVudF9pZDogcGF5bWVudElkLFxyXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyB0cmFuc2FjdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YS5pZDtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIGNyZWF0aW5nIHRyYW5zYWN0aW9uOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRnVua2NqYSBkbyB1a2/FhGN6ZW5pYSB0cmFuc2FrY2ppXHJcbmFzeW5jIGZ1bmN0aW9uIGNvbXBsZXRlVHJhbnNhY3Rpb24odHJhbnNhY3Rpb25JZCwgcHVyY2hhc2VSZWNvcmRJZCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBaYWt0dWFsaXp1aiB0cmFuc2FrY2rEmSBqYWtvIHVrb8WEY3pvbsSFXHJcbiAgICBjb25zdCB7IGVycm9yOiB0cmFuc2FjdGlvbkVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd0cmFuc2FjdGlvbnMnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxyXG4gICAgICAgIGNvbXBsZXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KVxyXG4gICAgICAuZXEoJ2lkJywgdHJhbnNhY3Rpb25JZCk7XHJcbiAgICBcclxuICAgIGlmICh0cmFuc2FjdGlvbkVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbXBsZXRpbmcgdHJhbnNhY3Rpb246JywgdHJhbnNhY3Rpb25FcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gWmFrdHVhbGl6dWogcmVrb3JkIHpha3VwdSBqYWtvIHVrb8WEY3pvbnkgaSB6IGRvc3TEmXBlbVxyXG4gICAgY29uc3QgeyBlcnJvcjogcHVyY2hhc2VFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgncHVyY2hhc2VfcmVjb3JkcycpXHJcbiAgICAgIC51cGRhdGUoe1xyXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXHJcbiAgICAgICAgYWNjZXNzX3Byb3ZpZGVkOiB0cnVlLFxyXG4gICAgICAgIGFjY2Vzc19wcm92aWRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KVxyXG4gICAgICAuZXEoJ2lkJywgcHVyY2hhc2VSZWNvcmRJZCk7XHJcbiAgICBcclxuICAgIGlmIChwdXJjaGFzZUVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHB1cmNoYXNlIHJlY29yZDonLCBwdXJjaGFzZUVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIGNvbXBsZXRpbmcgdHJhbnNhY3Rpb246JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRnVua2NqYSBnZW5lcnVqxIVjYSBiZXpwaWVjem55IHRva2VuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlVG9rZW4oKSB7XHJcbiAgcmV0dXJuIGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpO1xyXG59XHJcblxyXG4vLyBCZXpwaWVjem5hIGZ1bmtjamEgaGFzaHVqxIVjYSB0b2tlblxyXG5mdW5jdGlvbiBoYXNoVG9rZW4odG9rZW4pIHtcclxuICByZXR1cm4gY3J5cHRvXHJcbiAgICAuY3JlYXRlSGFzaCgnc2hhMjU2JylcclxuICAgIC51cGRhdGUodG9rZW4gKyAocHJvY2Vzcy5lbnYuVE9LRU5fU0FMVCB8fCAnJykpXHJcbiAgICAuZGlnZXN0KCdoZXgnKTtcclxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjdXJyZW50VXNlciIsImNyeXB0byIsInN1cGFiYXNlQWRtaW4iLCJQT1NUIiwicmVxdWVzdCIsInB1cmNoYXNlSWQiLCJwYXltZW50TWV0aG9kIiwianNvbiIsInVzZXIiLCJlcnJvciIsInN0YXR1cyIsImNvbnNvbGUiLCJsb2ciLCJpZCIsInVzZXJQcm9maWxlIiwiZGF0YSIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsIkVycm9yIiwibmV3UHJvZmlsZSIsImV4dGVybmFsX2F1dGhfaWQiLCJkaXNwbGF5X25hbWUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInRyaW0iLCJ1c2VybmFtZSIsImVtYWlsIiwiZW1haWxBZGRyZXNzZXMiLCJlbWFpbEFkZHJlc3MiLCJwaG9uZV9udW1iZXIiLCJwaG9uZU51bWJlcnMiLCJwaG9uZU51bWJlciIsInByb2ZpbGVfdHlwZSIsInZlcmlmaWNhdGlvbl9sZXZlbCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ1cGRhdGVkX2F0IiwiY3JlYXRlZFByb2ZpbGUiLCJjcmVhdGVFcnJvciIsImluc2VydCIsImRldGFpbHMiLCJtZXNzYWdlIiwicHVyY2hhc2UiLCJwdXJjaGFzZUVycm9yIiwiY29kZSIsInVzZXJfaWQiLCJ3YXJuIiwic2VsbGVySWQiLCJncm91cF9zdWIiLCJncm91cHMiLCJvd25lcl9pZCIsInRyYW5zYWN0aW9uSWQiLCJjcmVhdGVUcmFuc2FjdGlvbiIsImdyb3VwX3N1Yl9pZCIsInByaWNlX3Blcl9zbG90IiwicGF5bWVudENvbXBsZXRlZCIsImNvbXBsZXRlVHJhbnNhY3Rpb24iLCJ0b2tlbiIsImdlbmVyYXRlVG9rZW4iLCJpbnNlcnRFcnJvciIsInB1cmNoYXNlX3JlY29yZF9pZCIsInRva2VuX2hhc2giLCJoYXNoVG9rZW4iLCJleHBpcmVzX2F0Iiwibm93IiwidXNlZCIsImFjdGlvbl90eXBlIiwicmVzb3VyY2VfdHlwZSIsInJlc291cmNlX2lkIiwidHJhbnNhY3Rpb25faWQiLCJwYXltZW50X21ldGhvZCIsInRpbWVzdGFtcCIsImFjY2Vzc1VybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19BUFBfVVJMIiwic3VjY2VzcyIsImJ1eWVySWQiLCJncm91cFN1YklkIiwicHVyY2hhc2VSZWNvcmRJZCIsImFtb3VudCIsInBsYXRmb3JtRmVlUGVyY2VudCIsInBsYXRmb3JtRmVlIiwic2VsbGVyQW1vdW50IiwicGF5bWVudElkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwiYnV5ZXJfaWQiLCJzZWxsZXJfaWQiLCJwbGF0Zm9ybV9mZWUiLCJzZWxsZXJfYW1vdW50IiwiY3VycmVuY3kiLCJwYXltZW50X3Byb3ZpZGVyIiwicGF5bWVudF9pZCIsInRyYW5zYWN0aW9uRXJyb3IiLCJ1cGRhdGUiLCJjb21wbGV0ZWRfYXQiLCJhY2Nlc3NfcHJvdmlkZWQiLCJhY2Nlc3NfcHJvdmlkZWRfYXQiLCJyYW5kb21CeXRlcyIsImNyZWF0ZUhhc2giLCJUT0tFTl9TQUxUIiwiZGlnZXN0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/payments/route.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/database/supabase-admin-client.js":
/*!***************************************************!*\
  !*** ./src/lib/database/supabase-admin-client.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createUserProfileAdmin: () => (/* binding */ createUserProfileAdmin),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getGroupMembersAdmin: () => (/* binding */ getGroupMembersAdmin),\n/* harmony export */   getSubscriptionPlatformsAdmin: () => (/* binding */ getSubscriptionPlatformsAdmin),\n/* harmony export */   getUserByAuthIdAdmin: () => (/* binding */ getUserByAuthIdAdmin),\n/* harmony export */   handleSupabaseAdminError: () => (/* binding */ handleSupabaseAdminError),\n/* harmony export */   logAdminActivity: () => (/* binding */ logAdminActivity),\n/* harmony export */   updateUserProfileAdmin: () => (/* binding */ updateUserProfileAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// src/lib/supabase-admin-client.js\n\n// Inicjalizacja klienta Supabase z uprawnieniami administratora\nconst supabaseUrl = \"https://nimrnohkesysfppcmujb.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n// Sprawdzenie czy zmienne środowiskowe są ustawione\nif (!supabaseUrl || !supabaseServiceKey) {\n    console.error(\"Missing environment variables: NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\");\n}\n// Uwaga: Ten klient ma pełne uprawnienia do bazy danych, używaj ostrożnie!\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n// Funkcja pomocnicza do obsługi błędów Supabase\nconst handleSupabaseAdminError = (error)=>{\n    console.error(\"Supabase Admin error:\", error);\n    return {\n        error: true,\n        message: error.message || \"Nieoczekiwany błąd administratora\",\n        code: error.code || \"unknown_error\",\n        details: error.details || null\n    };\n};\n// Funkcje administratora do zarządzania użytkownikami\n// Funkcja do tworzenia profilu użytkownika przez administratora\nconst createUserProfileAdmin = async (userProfile)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").insert([\n            userProfile\n        ]).select().single();\n        if (error) {\n            if (error.code === \"23505\") {\n                console.warn(\"Admin: Pr\\xf3ba utworzenia duplikatu profilu użytkownika:\", error);\n                // Jeśli profil już istnieje, pobierz go\n                const { data: existingUser, error: fetchError } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", userProfile.external_auth_id).single();\n                if (fetchError) {\n                    throw new Error(\"Nie można pobrać istniejącego profilu: \" + fetchError.message);\n                }\n                return existingUser;\n            } else {\n                throw new Error(error.message || \"Nie udało się utworzyć profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania profilu użytkownika przez administratora\nconst getUserByAuthIdAdmin = async (authId)=>{\n    if (!authId) return null;\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", authId).single();\n        if (error) {\n            if (error.code === \"PGRST116\") {\n                // Nie znaleziono - to normalny przypadek\n                return null;\n            } else {\n                console.error(\"Admin: Błąd pobierania profilu użytkownika:\", error);\n                throw new Error(error.message || \"Nie udało się pobrać profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do aktualizacji profilu użytkownika przez administratora\nconst updateUserProfileAdmin = async (userId, updates)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").update(updates).eq(\"id\", userId).select().single();\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania platform subskrypcyjnych przez administratora\nconst getSubscriptionPlatformsAdmin = async ()=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"subscription_platforms\").select(\"*\").order(\"name\");\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Funkcja do pobierania członków grupy przez administratora\nconst getGroupMembersAdmin = async (groupId)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"group_members\").select(`\r\n        *,\r\n        user:user_profiles(id, display_name, avatar_url, email)\r\n      `).eq(\"group_id\", groupId);\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Zapisz wszystkie aktywności administratora do logu bezpieczeństwa\nconst logAdminActivity = async (action, resourceType, resourceId, details = {})=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"security_logs\").insert([\n            {\n                action_type: action,\n                resource_type: resourceType,\n                resource_id: resourceId,\n                status: \"success\",\n                details: details\n            }\n        ]);\n        if (error) console.error(\"Błąd logowania aktywności administratora:\", error);\n    } catch (error) {\n        console.error(\"Wyjątek podczas logowania aktywności administratora:\", error);\n    }\n};\n// Eksport klienta administratora jako domyślny\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabaseAdmin);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSxtQ0FBbUM7QUFDa0I7QUFFckQsZ0VBQWdFO0FBQ2hFLE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxxQkFBcUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRWhFLG9EQUFvRDtBQUNwRCxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksb0JBQW9CO0lBQ3ZDRSxRQUFRQyxLQUFLLENBQ1g7QUFFSjtBQUVBLDJFQUEyRTtBQUMzRSxNQUFNQyxnQkFBZ0JULG1FQUFZQSxDQUFDQyxhQUFhSSxvQkFBb0I7SUFDbEVLLE1BQU07UUFDSkMsZ0JBQWdCO1FBQ2hCQyxrQkFBa0I7SUFDcEI7QUFDRjtBQUVBLGdEQUFnRDtBQUN6QyxNQUFNQywyQkFBMkIsQ0FBQ0w7SUFDdkNELFFBQVFDLEtBQUssQ0FBQyx5QkFBeUJBO0lBRXZDLE9BQU87UUFDTEEsT0FBTztRQUNQTSxTQUFTTixNQUFNTSxPQUFPLElBQUk7UUFDMUJDLE1BQU1QLE1BQU1PLElBQUksSUFBSTtRQUNwQkMsU0FBU1IsTUFBTVEsT0FBTyxJQUFJO0lBQzVCO0FBQ0YsRUFBRTtBQUVGLHNEQUFzRDtBQUV0RCxnRUFBZ0U7QUFDekQsTUFBTUMseUJBQXlCLE9BQU9DO0lBQzNDLElBQUk7UUFDRixNQUFNLEVBQUVDLElBQUksRUFBRVgsS0FBSyxFQUFFLEdBQUcsTUFBTUMsY0FDM0JXLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDO1lBQUNIO1NBQVksRUFDcEJJLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlmLE9BQU87WUFDVCxJQUFJQSxNQUFNTyxJQUFJLEtBQUssU0FBUztnQkFDMUJSLFFBQVFpQixJQUFJLENBQUMsNkRBQTBEaEI7Z0JBRXZFLHdDQUF3QztnQkFDeEMsTUFBTSxFQUFFVyxNQUFNTSxZQUFZLEVBQUVqQixPQUFPa0IsVUFBVSxFQUFFLEdB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QyxLQUFLLENBQUMsNkNBQTZDQTtJQUV4RSxFQUFFLE9BQU9BLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHdEQUF3REE7SUFDeEU7QUFDRixFQUFFO0FBRUYsK0NBQStDO0FBQy9DLGlFQUFlQyxhQUFhQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2xpYi9kYXRhYmFzZS9zdXBhYmFzZS1hZG1pbi1jbGllbnQuanM/MzQ3NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qc1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuLy8gSW5pY2phbGl6YWNqYSBrbGllbnRhIFN1cGFiYXNlIHogdXByYXduaWVuaWFtaSBhZG1pbmlzdHJhdG9yYVxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcclxuY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcclxuXHJcbi8vIFNwcmF3ZHplbmllIGN6eSB6bWllbm5lIMWbcm9kb3dpc2tvd2Ugc8SFIHVzdGF3aW9uZVxyXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcclxuICBjb25zb2xlLmVycm9yKFxyXG4gICAgJ01pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzOiBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSdcclxuICApO1xyXG59XHJcblxyXG4vLyBVd2FnYTogVGVuIGtsaWVudCBtYSBwZcWCbmUgdXByYXduaWVuaWEgZG8gYmF6eSBkYW55Y2gsIHXFvHl3YWogb3N0cm/FvG5pZSFcclxuY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XHJcbiAgYXV0aDoge1xyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgfSxcclxufSk7XHJcblxyXG4vLyBGdW5rY2phIHBvbW9jbmljemEgZG8gb2JzxYJ1Z2kgYsWCxJlkw7N3IFN1cGFiYXNlXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICBjb25zb2xlLmVycm9yKCdTdXBhYmFzZSBBZG1pbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGVycm9yOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnTmllb2N6ZWtpd2FueSBixYLEhWQgYWRtaW5pc3RyYXRvcmEnLFxyXG4gICAgY29kZTogZXJyb3IuY29kZSB8fCAndW5rbm93bl9lcnJvcicsXHJcbiAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzIHx8IG51bGwsXHJcbiAgfTtcclxufTtcclxuXHJcbi8vIEZ1bmtjamUgYWRtaW5pc3RyYXRvcmEgZG8gemFyesSFZHphbmlhIHXFvHl0a293bmlrYW1pXHJcblxyXG4vLyBGdW5rY2phIGRvIHR3b3J6ZW5pYSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgY3JlYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VyUHJvZmlsZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLmluc2VydChbdXNlclByb2ZpbGVdKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ0FkbWluOiBQcsOzYmEgdXR3b3J6ZW5pYSBkdXBsaWthdHUgcHJvZmlsdSB1xbx5dGtvd25pa2E6JywgZXJyb3IpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEplxZtsaSBwcm9maWwganXFvCBpc3RuaWVqZSwgcG9iaWVyeiBnb1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdVc2VyLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCB1c2VyUHJvZmlsZS5leHRlcm5hbF9hdXRoX2lkKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgaWYgKGZldGNoRXJyb3IpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTmllIG1vxbxuYSBwb2JyYcSHIGlzdG5pZWrEhWNlZ28gcHJvZmlsdTogJyArIGZldGNoRXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBleGlzdGluZ1VzZXI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSB1dHdvcnp5xIcgcHJvZmlsdSB1xbx5dGtvd25pa2EnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgaGFuZGxlU3VwYWJhc2VBZG1pbkVycm9yKGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEZ1bmtjamEgZG8gcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5QXV0aElkQWRtaW4gPSBhc3luYyAoYXV0aElkKSA9PiB7XHJcbiAgaWYgKCFhdXRoSWQpIHJldHVybiBudWxsO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIGF1dGhJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgICAgICAvLyBOaWUgem5hbGV6aW9ubyAtIHRvIG5vcm1hbG55IHByenlwYWRla1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FkbWluOiBCxYLEhWQgcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYTonLCBlcnJvcik7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSBwb2JyYcSHIHByb2ZpbHUgdcW8eXRrb3duaWthJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIGFrdHVhbGl6YWNqaSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VySWQsIHVwZGF0ZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgIC51cGRhdGUodXBkYXRlcylcclxuICAgICAgLmVxKCdpZCcsIHVzZXJJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIHBvYmllcmFuaWEgcGxhdGZvcm0gc3Vic2tyeXBjeWpueWNoIHByemV6IGFkbWluaXN0cmF0b3JhXHJcbmV4cG9ydCBjb25zdCBnZXRTdWJzY3JpcHRpb25QbGF0Zm9ybXNBZG1pbiA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3BsYXRmb3JtcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ25hbWUnKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVua2NqYSBkbyBwb2JpZXJhbmlhIGN6xYJvbmvDs3cgZ3J1cHkgcHJ6ZXogYWRtaW5pc3RyYXRvcmFcclxuZXhwb3J0IGNvbnN0IGdldEdyb3VwTWVtYmVyc0FkbWluID0gYXN5bmMgKGdyb3VwSWQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnZ3JvdXBfbWVtYmVycycpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICosXHJcbiAgICAgICAgdXNlcjp1c2VyX3Byb2ZpbGVzKGlkLCBkaXNwbGF5X25hbWUsIGF2YXRhcl91cmwsIGVtYWlsKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ2dyb3VwX2lkJywgZ3JvdXBJZCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFphcGlzeiB3c3p5c3RraWUgYWt0eXdub8WbY2kgYWRtaW5pc3RyYXRvcmEgZG8gbG9ndSBiZXpwaWVjemXFhHN0d2FcclxuZXhwb3J0IGNvbnN0IGxvZ0FkbWluQWN0aXZpdHkgPSBhc3luYyAoYWN0aW9uLCByZXNvdXJjZVR5cGUsIHJlc291cmNlSWQsIGRldGFpbHMgPSB7fSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9sb2dzJylcclxuICAgICAgLmluc2VydChbe1xyXG4gICAgICAgIGFjdGlvbl90eXBlOiBhY3Rpb24sXHJcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxyXG4gICAgICAgIHJlc291cmNlX2lkOiByZXNvdXJjZUlkLFxyXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgIGRldGFpbHM6IGRldGFpbHMsXHJcbiAgICAgIH1dKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSBjb25zb2xlLmVycm9yKCdCxYLEhWQgbG9nb3dhbmlhIGFrdHl3bm/Fm2NpIGFkbWluaXN0cmF0b3JhOicsIGVycm9yKTtcclxuICAgIFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdXeWrEhXRlayBwb2RjemFzIGxvZ293YW5pYSBha3R5d25vxZtjaSBhZG1pbmlzdHJhdG9yYTonLCBlcnJvcik7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRWtzcG9ydCBrbGllbnRhIGFkbWluaXN0cmF0b3JhIGpha28gZG9tecWbbG55XHJcbmV4cG9ydCBkZWZhdWx0IHN1cGFiYXNlQWRtaW47Il0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJjb25zb2xlIiwiZXJyb3IiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwiZGV0YWlscyIsImNyZWF0ZVVzZXJQcm9maWxlQWRtaW4iLCJ1c2VyUHJvZmlsZSIsImRhdGEiLCJmcm9tIiwiaW5zZXJ0Iiwic2VsZWN0Iiwic2luZ2xlIiwid2FybiIsImV4aXN0aW5nVXNlciIsImZldGNoRXJyb3IiLCJlcSIsImV4dGVybmFsX2F1dGhfaWQiLCJFcnJvciIsImdldFVzZXJCeUF1dGhJZEFkbWluIiwiYXV0aElkIiwidXBkYXRlVXNlclByb2ZpbGVBZG1pbiIsInVzZXJJZCIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJnZXRTdWJzY3JpcHRpb25QbGF0Zm9ybXNBZG1pbiIsIm9yZGVyIiwiZ2V0R3JvdXBNZW1iZXJzQWRtaW4iLCJncm91cElkIiwibG9nQWRtaW5BY3Rpdml0eSIsImFjdGlvbiIsInJlc291cmNlVHlwZSIsInJlc291cmNlSWQiLCJhY3Rpb25fdHlwZSIsInJlc291cmNlX3R5cGUiLCJyZXNvdXJjZV9pZCIsInN0YXR1cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database/supabase-admin-client.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@clerk","vendor-chunks/tslib","vendor-chunks/cookie","vendor-chunks/map-obj","vendor-chunks/no-case","vendor-chunks/lower-case","vendor-chunks/snakecase-keys","vendor-chunks/snake-case","vendor-chunks/dot-case","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fpayments%2Froute&page=%2Fapi%2Fpayments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fpayments%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();