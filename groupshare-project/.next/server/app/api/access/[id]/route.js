"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/access/[id]/route";
exports.ids = ["app/api/access/[id]/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Faccess%2F%5Bid%5D%2Froute&page=%2Fapi%2Faccess%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Faccess%2F%5Bid%5D%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Faccess%2F%5Bid%5D%2Froute&page=%2Fapi%2Faccess%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Faccess%2F%5Bid%5D%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_access_id_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/access/[id]/route.js */ \"(rsc)/./src/app/api/access/[id]/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/access/[id]/route\",\n        pathname: \"/api/access/[id]\",\n        filename: \"route\",\n        bundlePath: \"app/api/access/[id]/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\bacze\\\\Project\\\\GroupShare\\\\groupshare-project\\\\src\\\\app\\\\api\\\\access\\\\[id]\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_bacze_Project_GroupShare_groupshare_project_src_app_api_access_id_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/access/[id]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhY2Nlc3MlMkYlNUJpZCU1RCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGYWNjZXNzJTJGJTVCaWQlNUQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZhY2Nlc3MlMkYlNUJpZCU1RCUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlJTVDZ3JvdXBzaGFyZS1wcm9qZWN0JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNnRDtBQUM3SDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8/ZWZiZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxiYWN6ZVxcXFxQcm9qZWN0XFxcXEdyb3VwU2hhcmVcXFxcZ3JvdXBzaGFyZS1wcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGFjY2Vzc1xcXFxbaWRdXFxcXHJvdXRlLmpzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hY2Nlc3MvW2lkXS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FjY2Vzcy9baWRdXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hY2Nlc3MvW2lkXS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGJhY3plXFxcXFByb2plY3RcXFxcR3JvdXBTaGFyZVxcXFxncm91cHNoYXJlLXByb2plY3RcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcYWNjZXNzXFxcXFtpZF1cXFxccm91dGUuanNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2FjY2Vzcy9baWRdL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Faccess%2F%5Bid%5D%2Froute&page=%2Fapi%2Faccess%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Faccess%2F%5Bid%5D%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/access/[id]/route.js":
/*!******************************************!*\
  !*** ./src/app/api/access/[id]/route.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/currentUser.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/database/supabase-admin-client */ \"(rsc)/./src/lib/database/supabase-admin-client.js\");\n// src/app/api/access/[id]/route.js\n\n\n\n\n/**\r\n * GET /api/access/[id]\r\n * Weryfikuje token dostępu i zwraca instrukcje dostępu do subskrypcji\r\n */ async function GET(request, { params }) {\n    try {\n        const { id } = params;\n        const { searchParams } = new URL(request.url);\n        const token = searchParams.get(\"token\");\n        console.log(`Processing access request for purchase ${id}`);\n        // Specjalny przypadek dla bezpośredniego dostępu z panelu aplikacji\n        let directAccess = false;\n        if (token === \"direct\") {\n            // Pomijamy weryfikację tokenu, bo dostęp jest z panelu aplikacji\n            // Nadal sprawdzamy czy użytkownik ma dostęp do zakupu\n            directAccess = true;\n            console.log(`Direct access requested for purchase ${id}`);\n        }\n        // Sprawdź czy token jest prawidłowy\n        if (!token && !directAccess) {\n            await logSecurityEvent(null, \"access_attempt\", \"purchase_record\", id, \"failed\", {\n                reason: \"Missing token\",\n                ip: request.headers.get(\"x-forwarded-for\") || \"unknown\"\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Access token is required\"\n            }, {\n                status: 401\n            });\n        }\n        // Sprawdź autentykację\n        const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__.currentUser)();\n        let userProfileId = null;\n        if (user) {\n            // Pobierz profil użytkownika\n            const { data: profile } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"user_profiles\").select(\"id\").eq(\"external_auth_id\", user.id).single();\n            if (profile) {\n                userProfileId = profile.id;\n                console.log(`Authenticated user: ${userProfileId}`);\n            }\n        }\n        // Pobierz informacje o zakupie\n        const { data: purchase, error: purchaseError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"purchase_records\").select(`\r\n        id, status, user_id, access_provided, group_sub_id,\r\n        user:user_profiles(id, display_name, email),\r\n        group_sub:group_subs(\r\n          id, group_id,\r\n          platform:subscription_platforms(id, name, icon, name)\r\n        )\r\n      `).eq(\"id\", id).single();\n        if (purchaseError || !purchase) {\n            console.error(\"Error fetching purchase:\", purchaseError);\n            await logSecurityEvent(userProfileId, \"access_attempt\", \"purchase_record\", id, \"failed\", {\n                reason: \"Purchase not found\",\n                error: purchaseError?.message\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Purchase record not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Sprawdź status zakupu\n        if (purchase.status !== \"completed\" || !purchase.access_provided) {\n            await logSecurityEvent(userProfileId, \"access_attempt\", \"purchase_record\", id, \"failed\", {\n                reason: \"Access not provided\",\n                purchase_status: purchase.status,\n                access_provided: purchase.access_provided\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Access not available for this purchase\"\n            }, {\n                status: 403\n            });\n        }\n        // Jeśli nie jest to dostęp bezpośredni, sprawdź token\n        if (!directAccess) {\n            // Pobierz i sprawdź token dostępu\n            const tokenHash = hashToken(token);\n            console.log(`Verifying token hash: ${tokenHash.substring(0, 10)}...`);\n            // Najpierw sprawdź, czy istnieją jakiekolwiek tokeny dla tego zakupu\n            const { data: allTokens, error: tokensError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"access_tokens\").select(\"id, token_hash, expires_at, used\").eq(\"purchase_record_id\", id);\n            if (tokensError) {\n                console.error(\"Error checking tokens:\", tokensError);\n            } else {\n                console.log(`Found ${allTokens?.length || 0} tokens for purchase ${id}`);\n                if (allTokens && allTokens.length > 0) {\n                    for (const t of allTokens){\n                        console.log(`Token: ${t.id}, hash prefix: ${t.token_hash?.substring(0, 10)}..., expires: ${t.expires_at}, used: ${t.used}`);\n                    }\n                }\n            }\n            // *** WAŻNA ZMIANA: Sprawdzaj wszystkie tokeny, nawet użyte ***\n            const { data: matchingToken1, error: tokenError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"access_tokens\").select(\"*\").eq(\"purchase_record_id\", id).eq(\"token_hash\", tokenHash).gt(\"expires_at\", new Date().toISOString()).maybeSingle(); // Używamy maybeSingle zamiast single, aby nie rzucać błędu jeśli nie znajdzie\n            // Jeśli nie znaleziono pasującego tokenu lub token nie istnieje\n            if (tokenError || !matchingToken1) {\n                console.error(\"Error finding matching token:\", tokenError);\n                await logSecurityEvent(userProfileId, \"access_attempt\", \"purchase_record\", id, \"failed\", {\n                    reason: \"Token not found or expired\",\n                    error: tokenError?.message\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Invalid or expired access token\"\n                }, {\n                    status: 401\n                });\n            }\n            console.log(`Matching token found: ${matchingToken1.id}, used: ${matchingToken1.used}`);\n            // Jeśli token został już użyty wcześniej, to akceptujemy to - po prostu nie oznaczamy go ponownie\n            if (!matchingToken1.used) {\n                // Oznacz token jako użyty tylko jeśli jeszcze nie był użyty\n                const { error: updateError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"access_tokens\").update({\n                    used: true,\n                    used_at: new Date().toISOString(),\n                    ip_address: request.headers.get(\"x-forwarded-for\") || null,\n                    user_agent: request.headers.get(\"user-agent\") || null\n                }).eq(\"id\", matchingToken1.id);\n                if (updateError) {\n                    console.error(\"Error updating access token:\", updateError);\n                // Kontynuujemy pomimo błędu\n                } else {\n                    console.log(`Token ${matchingToken1.id} marked as used`);\n                }\n            } else {\n                console.log(`Token ${matchingToken1.id} was already used, continuing anyway`);\n            }\n        }\n        // Jeśli użytkownik jest zalogowany, sprawdź czy zakup należy do niego\n        // Uwaga: Pozwalamy niezalogowanym użytkownikom na dostęp przy użyciu tokenu\n        if (userProfileId && purchase.user_id !== userProfileId) {\n            console.warn(`Security warning: User ${userProfileId} attempted to access purchase ${id} belonging to user ${purchase.user_id}`);\n            await logSecurityEvent(userProfileId, \"access_attempt\", \"purchase_record\", id, \"failed\", {\n                reason: \"User mismatch\",\n                owner_id: purchase.user_id\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"You do not have permission to access this purchase\"\n            }, {\n                status: 403\n            });\n        }\n        // Potwierdzenie dostępu w rejestrze zakupów\n        await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"purchase_records\").update({\n            access_confirmed: true,\n            access_confirmed_at: new Date().toISOString()\n        }).eq(\"id\", id);\n        // Pobierz instrukcje dostępu\n        const { data: accessInstructions, error: instructionsError } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"access_instructions\").select(\"*\").eq(\"group_sub_id\", purchase.group_sub_id).maybeSingle();\n        let decryptedInstructions = \"\";\n        // Obsługa przypadku braku instrukcji\n        if (instructionsError) {\n            console.error(\"Error fetching access instructions:\", instructionsError);\n            await logSecurityEvent(userProfileId, \"access_attempt\", \"purchase_record\", id, \"warning\", {\n                reason: \"Error fetching access instructions\",\n                error: instructionsError?.message,\n                group_sub_id: purchase.group_sub_id\n            });\n            // Tworzymy domyślne instrukcje zamiast zwracać błąd\n            decryptedInstructions = \"Instrukcje dostępu nie zostały jeszcze skonfigurowane przez sprzedawcę. Prosimy o kontakt ze sprzedawcą, aby uzyskać dane dostępowe.\";\n        } else if (!accessInstructions) {\n            console.warn(`No access instructions found for group_sub_id: ${purchase.group_sub_id}`);\n            await logSecurityEvent(userProfileId, \"access_attempt\", \"purchase_record\", id, \"warning\", {\n                reason: \"No access instructions found\",\n                group_sub_id: purchase.group_sub_id\n            });\n            // Tworzymy domyślne instrukcje zamiast zwracać błąd\n            decryptedInstructions = \"Instrukcje dostępu nie zostały jeszcze skonfigurowane przez sprzedawcą. Prosimy o kontakt ze sprzedawcą, aby uzyskać dane dostępowe.\";\n        } else {\n            // Symulacja deszyfrowania instrukcji dostępu\n            // W rzeczywistości tutaj byłoby prawdziwe deszyfrowanie\n            if (accessInstructions.encrypted_data && accessInstructions.encrypted_data.startsWith(\"ENCRYPTED:\")) {\n                // Przykładowe \"deszyfrowanie\" - w produkcji należy użyć odpowiednich metod kryptograficznych\n                const base64Data = accessInstructions.encrypted_data.replace(\"ENCRYPTED:\", \"\");\n                decryptedInstructions = Buffer.from(base64Data, \"base64\").toString(\"utf-8\");\n            } else {\n                decryptedInstructions = accessInstructions.encrypted_data || \"Instrukcje dostępu nie są dostępne w czytelnym formacie.\";\n            }\n        }\n        // Pobierz dane kontaktowe właściciela grupy, aby kupujący mógł się skontaktować w razie problemów\n        const { data: groupOwner } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"groups\").select(`\r\n        owner:user_profiles!owner_id(display_name, email)\r\n      `).eq(\"id\", purchase.group_sub.group_id).single();\n        const ownerContact = groupOwner?.owner || {\n            display_name: \"Sprzedawca\",\n            email: \"Niedostępny\"\n        };\n        // Zaloguj udany dostęp\n        await logSecurityEvent(userProfileId || purchase.user_id, \"access_success\", \"purchase_record\", id, \"success\", {\n            platform: purchase.group_sub.platform.name,\n            token_id: directAccess ? \"direct_access\" : matchingToken.id,\n            has_instructions: !!accessInstructions\n        });\n        console.log(`Access successful for purchase ${id}`);\n        // Zwróć dane dostępowe\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            purchase_id: id,\n            platform: purchase.group_sub.platform.name,\n            instructions: decryptedInstructions,\n            purchased_at: purchase.created_at,\n            user: purchase.user.display_name,\n            email: purchase.user.email,\n            owner_contact: ownerContact,\n            has_instructions: !!accessInstructions,\n            direct_access: directAccess\n        });\n    } catch (error) {\n        console.error(\"Error processing access request:\", error);\n        try {\n            await logSecurityEvent(null, \"access_attempt\", \"purchase_record\", params?.id || \"unknown\", \"error\", {\n                error: error.message\n            });\n        } catch (logError) {\n            console.error(\"Failed to log security event:\", logError);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to process access request\"\n        }, {\n            status: 500\n        });\n    }\n}\n// Funkcja do logowania zdarzeń bezpieczeństwa\nasync function logSecurityEvent(userId, actionType, resourceType, resourceId, status, details = {}) {\n    try {\n        const { error } = await _lib_database_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"security_logs\").insert({\n            user_id: userId,\n            action_type: actionType,\n            resource_type: resourceType,\n            resource_id: String(resourceId),\n            status: status,\n            details: details,\n            created_at: new Date().toISOString()\n        });\n        if (error) {\n            console.error(\"Error logging security event:\", error);\n        }\n    } catch (error) {\n        console.error(\"Exception logging security event:\", error);\n    }\n}\n// Bezpieczna funkcja hashująca token\nfunction hashToken(token) {\n    const salt = process.env.TOKEN_SALT || \"\";\n    return crypto__WEBPACK_IMPORTED_MODULE_1___default().createHash(\"sha256\").update(token + salt).digest(\"hex\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hY2Nlc3MvW2lkXS9yb3V0ZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxtQ0FBbUM7QUFDUTtBQUNRO0FBQ3ZCO0FBQ3FDO0FBRWpFOzs7Q0FHQyxHQUNNLGVBQWVJLElBQUlDLE9BQU8sRUFBRSxFQUFFQyxNQUFNLEVBQUU7SUFDM0MsSUFBSTtRQUNGLE1BQU0sRUFBRUMsRUFBRSxFQUFFLEdBQUdEO1FBQ2YsTUFBTSxFQUFFRSxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJSixRQUFRSyxHQUFHO1FBQzVDLE1BQU1DLFFBQVFILGFBQWFJLEdBQUcsQ0FBQztRQUUvQkMsUUFBUUMsR0FBRyxDQUFDLENBQUMsdUNBQXVDLEVBQUVQLEdBQUcsQ0FBQztRQUUxRCxvRUFBb0U7UUFDcEUsSUFBSVEsZUFBZTtRQUNuQixJQUFJSixVQUFVLFVBQVU7WUFDdEIsaUVBQWlFO1lBQ2pFLHNEQUFzRDtZQUN0REksZUFBZTtZQUNmRixRQUFRQyxHQUFHLENBQUMsQ0FBQyxxQ0FBcUMsRUFBRVAsR0FBRyxDQUFDO1FBQzFEO1FBRUEsb0NBQW9DO1FBQ3BDLElBQUksQ0FBQ0ksU0FBUyxDQUFDSSxjQUFjO1lBQzNCLE1BQU1DLGlCQUFpQixNQUFNLGtCQUFrQixtQkFBbUJULElBQUksVUFBVTtnQkFDOUVVLFFBQVE7Z0JBQ1JDLElBQUliLFFBQVFjLE9BQU8sQ0FBQ1AsR0FBRyxDQUFDLHNCQUFzQjtZQUNoRDtZQUVBLE9BQU9aLHFEQUFZQSxDQUFDb0IsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUEyQixHQUNwQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsdUJBQXVCO1FBQ3ZCLE1BQU1DLE9BQU8sTUFBTXRCLGlFQUFXQTtRQUM5QixJQUFJdUIsZ0JBQWdCO1FBRXBCLElBQUlELE1BQU07WUFDUiw2QkFBNkI7WUFDN0IsTUFBTSxFQUFFRSxNQUFNQyxPQUFPLEVBQUUsR0FBRyxNQUFNdkIsMkVBQWFBLENBQzFDd0IsSUFB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TDtZQUNiTSxlQUFlTDtZQUNmTSxhQUFhQyxPQUFPTjtZQUNwQnZFLFFBQVFBO1lBQ1J3RSxTQUFTQTtZQUNUUixZQUFZLElBQUlyQyxPQUFPQyxXQUFXO1FBQ3BDO1FBRUYsSUFBSTdCLE9BQU87WUFDVFIsUUFBUVEsS0FBSyxDQUFDLGlDQUFpQ0E7UUFDakQ7SUFDRixFQUFFLE9BQU9BLE9BQU87UUFDZFIsUUFBUVEsS0FBSyxDQUFDLHFDQUFxQ0E7SUFDckQ7QUFDRjtBQUVBLHFDQUFxQztBQUNyQyxTQUFTZ0IsVUFBVTFCLEtBQUs7SUFDdEIsTUFBTXlGLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJO0lBQ3ZDLE9BQU9yRyx3REFDTSxDQUFDLFVBQ1htRCxNQUFNLENBQUMxQyxRQUFReUYsTUFDZkssTUFBTSxDQUFDO0FBQ1oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ncm91cHNoYXJlLXByb2plY3QvLi9zcmMvYXBwL2FwaS9hY2Nlc3MvW2lkXS9yb3V0ZS5qcz8xNjI0Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9hcHAvYXBpL2FjY2Vzcy9baWRdL3JvdXRlLmpzXHJcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcclxuaW1wb3J0IHsgY3VycmVudFVzZXIgfSBmcm9tICdAY2xlcmsvbmV4dGpzL3NlcnZlcic7XHJcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcclxuaW1wb3J0IHN1cGFiYXNlQWRtaW4gZnJvbSAnQC9saWIvZGF0YWJhc2Uvc3VwYWJhc2UtYWRtaW4tY2xpZW50JztcclxuXHJcbi8qKlxyXG4gKiBHRVQgL2FwaS9hY2Nlc3MvW2lkXVxyXG4gKiBXZXJ5ZmlrdWplIHRva2VuIGRvc3TEmXB1IGkgendyYWNhIGluc3RydWtjamUgZG9zdMSZcHUgZG8gc3Vic2tyeXBjamlcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdCwgeyBwYXJhbXMgfSkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGlkIH0gPSBwYXJhbXM7XHJcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XHJcbiAgICBjb25zdCB0b2tlbiA9IHNlYXJjaFBhcmFtcy5nZXQoJ3Rva2VuJyk7XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKGBQcm9jZXNzaW5nIGFjY2VzcyByZXF1ZXN0IGZvciBwdXJjaGFzZSAke2lkfWApO1xyXG4gICAgXHJcbiAgICAvLyBTcGVjamFsbnkgcHJ6eXBhZGVrIGRsYSBiZXpwb8WbcmVkbmllZ28gZG9zdMSZcHUgeiBwYW5lbHUgYXBsaWthY2ppXHJcbiAgICBsZXQgZGlyZWN0QWNjZXNzID0gZmFsc2U7XHJcbiAgICBpZiAodG9rZW4gPT09ICdkaXJlY3QnKSB7XHJcbiAgICAgIC8vIFBvbWlqYW15IHdlcnlmaWthY2rEmSB0b2tlbnUsIGJvIGRvc3TEmXAgamVzdCB6IHBhbmVsdSBhcGxpa2FjamlcclxuICAgICAgLy8gTmFkYWwgc3ByYXdkemFteSBjenkgdcW8eXRrb3duaWsgbWEgZG9zdMSZcCBkbyB6YWt1cHVcclxuICAgICAgZGlyZWN0QWNjZXNzID0gdHJ1ZTtcclxuICAgICAgY29uc29sZS5sb2coYERpcmVjdCBhY2Nlc3MgcmVxdWVzdGVkIGZvciBwdXJjaGFzZSAke2lkfWApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiBjenkgdG9rZW4gamVzdCBwcmF3aWTFgm93eVxyXG4gICAgaWYgKCF0b2tlbiAmJiAhZGlyZWN0QWNjZXNzKSB7XHJcbiAgICAgIGF3YWl0IGxvZ1NlY3VyaXR5RXZlbnQobnVsbCwgJ2FjY2Vzc19hdHRlbXB0JywgJ3B1cmNoYXNlX3JlY29yZCcsIGlkLCAnZmFpbGVkJywge1xyXG4gICAgICAgIHJlYXNvbjogJ01pc3NpbmcgdG9rZW4nLFxyXG4gICAgICAgIGlwOiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKSB8fCAndW5rbm93bidcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0FjY2VzcyB0b2tlbiBpcyByZXF1aXJlZCcgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gU3ByYXdkxbogYXV0ZW50eWthY2rEmVxyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGN1cnJlbnRVc2VyKCk7XHJcbiAgICBsZXQgdXNlclByb2ZpbGVJZCA9IG51bGw7XHJcbiAgICBcclxuICAgIGlmICh1c2VyKSB7XHJcbiAgICAgIC8vIFBvYmllcnogcHJvZmlsIHXFvHl0a293bmlrYVxyXG4gICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxyXG4gICAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIHVzZXIuaWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHByb2ZpbGUpIHtcclxuICAgICAgICB1c2VyUHJvZmlsZUlkID0gcHJvZmlsZS5pZDtcclxuICAgICAgICBjb25zb2xlLmxvZyhgQXV0aGVudGljYXRlZCB1c2VyOiAke3VzZXJQcm9maWxlSWR9YCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUG9iaWVyeiBpbmZvcm1hY2plIG8gemFrdXBpZVxyXG4gICAgY29uc3QgeyBkYXRhOiBwdXJjaGFzZSwgZXJyb3I6IHB1cmNoYXNlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3B1cmNoYXNlX3JlY29yZHMnKVxyXG4gICAgICAuc2VsZWN0KGBcclxuICAgICAgICBpZCwgc3RhdHVzLCB1c2VyX2lkLCBhY2Nlc3NfcHJvdmlkZWQsIGdyb3VwX3N1Yl9pZCxcclxuICAgICAgICB1c2VyOnVzZXJfcHJvZmlsZXMoaWQsIGRpc3BsYXlfbmFtZSwgZW1haWwpLFxyXG4gICAgICAgIGdyb3VwX3N1Yjpncm91cF9zdWJzKFxyXG4gICAgICAgICAgaWQsIGdyb3VwX2lkLFxyXG4gICAgICAgICAgcGxhdGZvcm06c3Vic2NyaXB0aW9uX3BsYXRmb3JtcyhpZCwgbmFtZSwgaWNvbiwgbmFtZSlcclxuICAgICAgICApXHJcbiAgICAgIGApXHJcbiAgICAgIC5lcSgnaWQnLCBpZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAocHVyY2hhc2VFcnJvciB8fCAhcHVyY2hhc2UpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHVyY2hhc2U6JywgcHVyY2hhc2VFcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCBsb2dTZWN1cml0eUV2ZW50KHVzZXJQcm9maWxlSWQsICdhY2Nlc3NfYXR0ZW1wdCcsICdwdXJjaGFzZV9yZWNvcmQnLCBpZCwgJ2ZhaWxlZCcsIHtcclxuICAgICAgICByZWFzb246ICdQdXJjaGFzZSBub3QgZm91bmQnLFxyXG4gICAgICAgIGVycm9yOiBwdXJjaGFzZUVycm9yPy5tZXNzYWdlXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6ICdQdXJjaGFzZSByZWNvcmQgbm90IGZvdW5kJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBTcHJhd2TFuiBzdGF0dXMgemFrdXB1XHJcbiAgICBpZiAocHVyY2hhc2Uuc3RhdHVzICE9PSAnY29tcGxldGVkJyB8fCAhcHVyY2hhc2UuYWNjZXNzX3Byb3ZpZGVkKSB7XHJcbiAgICAgIGF3YWl0IGxvZ1NlY3VyaXR5RXZlbnQodXNlclByb2ZpbGVJZCwgJ2FjY2Vzc19hdHRlbXB0JywgJ3B1cmNoYXNlX3JlY29yZCcsIGlkLCAnZmFpbGVkJywge1xyXG4gICAgICAgIHJlYXNvbjogJ0FjY2VzcyBub3QgcHJvdmlkZWQnLFxyXG4gICAgICAgIHB1cmNoYXNlX3N0YXR1czogcHVyY2hhc2Uuc3RhdHVzLFxyXG4gICAgICAgIGFjY2Vzc19wcm92aWRlZDogcHVyY2hhc2UuYWNjZXNzX3Byb3ZpZGVkXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgZXJyb3I6ICdBY2Nlc3Mgbm90IGF2YWlsYWJsZSBmb3IgdGhpcyBwdXJjaGFzZScgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAzIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gSmXFm2xpIG5pZSBqZXN0IHRvIGRvc3TEmXAgYmV6cG/Fm3JlZG5pLCBzcHJhd2TFuiB0b2tlblxyXG4gICAgaWYgKCFkaXJlY3RBY2Nlc3MpIHtcclxuICAgICAgLy8gUG9iaWVyeiBpIHNwcmF3ZMW6IHRva2VuIGRvc3TEmXB1XHJcbiAgICAgIGNvbnN0IHRva2VuSGFzaCA9IGhhc2hUb2tlbih0b2tlbik7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBWZXJpZnlpbmcgdG9rZW4gaGFzaDogJHt0b2tlbkhhc2guc3Vic3RyaW5nKDAsIDEwKX0uLi5gKTtcclxuICAgICAgXHJcbiAgICAgIC8vIE5hanBpZXJ3IHNwcmF3ZMW6LCBjenkgaXN0bmllasSFIGpha2lla29sd2llayB0b2tlbnkgZGxhIHRlZ28gemFrdXB1XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogYWxsVG9rZW5zLCBlcnJvcjogdG9rZW5zRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgICAuZnJvbSgnYWNjZXNzX3Rva2VucycpXHJcbiAgICAgICAgLnNlbGVjdCgnaWQsIHRva2VuX2hhc2gsIGV4cGlyZXNfYXQsIHVzZWQnKVxyXG4gICAgICAgIC5lcSgncHVyY2hhc2VfcmVjb3JkX2lkJywgaWQpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHRva2Vuc0Vycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgdG9rZW5zOicsIHRva2Vuc0Vycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHthbGxUb2tlbnM/Lmxlbmd0aCB8fCAwfSB0b2tlbnMgZm9yIHB1cmNoYXNlICR7aWR9YCk7XHJcbiAgICAgICAgaWYgKGFsbFRva2VucyAmJiBhbGxUb2tlbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgZm9yIChjb25zdCB0IG9mIGFsbFRva2Vucykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgVG9rZW46ICR7dC5pZH0sIGhhc2ggcHJlZml4OiAke3QudG9rZW5faGFzaD8uc3Vic3RyaW5nKDAsIDEwKX0uLi4sIGV4cGlyZXM6ICR7dC5leHBpcmVzX2F0fSwgdXNlZDogJHt0LnVzZWR9YCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyAqKiogV0HFu05BIFpNSUFOQTogU3ByYXdkemFqIHdzenlzdGtpZSB0b2tlbnksIG5hd2V0IHXFvHl0ZSAqKipcclxuICAgICAgY29uc3QgeyBkYXRhOiBtYXRjaGluZ1Rva2VuLCBlcnJvcjogdG9rZW5FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdhY2Nlc3NfdG9rZW5zJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZXEoJ3B1cmNoYXNlX3JlY29yZF9pZCcsIGlkKVxyXG4gICAgICAgIC5lcSgndG9rZW5faGFzaCcsIHRva2VuSGFzaClcclxuICAgICAgICAuZ3QoJ2V4cGlyZXNfYXQnLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpXHJcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7ICAvLyBVxbx5d2FteSBtYXliZVNpbmdsZSB6YW1pYXN0IHNpbmdsZSwgYWJ5IG5pZSByenVjYcSHIGLFgsSZZHUgamXFm2xpIG5pZSB6bmFqZHppZVxyXG4gICAgICBcclxuICAgICAgLy8gSmXFm2xpIG5pZSB6bmFsZXppb25vIHBhc3VqxIVjZWdvIHRva2VudSBsdWIgdG9rZW4gbmllIGlzdG5pZWplXHJcbiAgICAgIGlmICh0b2tlbkVycm9yIHx8ICFtYXRjaGluZ1Rva2VuKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmluZGluZyBtYXRjaGluZyB0b2tlbjonLCB0b2tlbkVycm9yKTtcclxuICAgICAgICBcclxuICAgICAgICBhd2FpdCBsb2dTZWN1cml0eUV2ZW50KHVzZXJQcm9maWxlSWQsICdhY2Nlc3NfYXR0ZW1wdCcsICdwdXJjaGFzZV9yZWNvcmQnLCBpZCwgJ2ZhaWxlZCcsIHtcclxuICAgICAgICAgIHJlYXNvbjogJ1Rva2VuIG5vdCBmb3VuZCBvciBleHBpcmVkJyxcclxuICAgICAgICAgIGVycm9yOiB0b2tlbkVycm9yPy5tZXNzYWdlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgb3IgZXhwaXJlZCBhY2Nlc3MgdG9rZW4nIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDAxIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhgTWF0Y2hpbmcgdG9rZW4gZm91bmQ6ICR7bWF0Y2hpbmdUb2tlbi5pZH0sIHVzZWQ6ICR7bWF0Y2hpbmdUb2tlbi51c2VkfWApO1xyXG4gICAgICBcclxuICAgICAgLy8gSmXFm2xpIHRva2VuIHpvc3RhxYIganXFvCB1xbx5dHkgd2N6ZcWbbmllaiwgdG8gYWtjZXB0dWplbXkgdG8gLSBwbyBwcm9zdHUgbmllIG96bmFjemFteSBnbyBwb25vd25pZVxyXG4gICAgICBpZiAoIW1hdGNoaW5nVG9rZW4udXNlZCkge1xyXG4gICAgICAgIC8vIE96bmFjeiB0b2tlbiBqYWtvIHXFvHl0eSB0eWxrbyBqZcWbbGkgamVzemN6ZSBuaWUgYnnFgiB1xbx5dHlcclxuICAgICAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ2FjY2Vzc190b2tlbnMnKVxyXG4gICAgICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgICAgIHVzZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgICAgaXBfYWRkcmVzczogcmVxdWVzdC5oZWFkZXJzLmdldCgneC1mb3J3YXJkZWQtZm9yJykgfHwgbnVsbCxcclxuICAgICAgICAgICAgdXNlcl9hZ2VudDogcmVxdWVzdC5oZWFkZXJzLmdldCgndXNlci1hZ2VudCcpIHx8IG51bGxcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuZXEoJ2lkJywgbWF0Y2hpbmdUb2tlbi5pZCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBhY2Nlc3MgdG9rZW46JywgdXBkYXRlRXJyb3IpO1xyXG4gICAgICAgICAgLy8gS29udHludXVqZW15IHBvbWltbyBixYLEmWR1XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBUb2tlbiAke21hdGNoaW5nVG9rZW4uaWR9IG1hcmtlZCBhcyB1c2VkYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBUb2tlbiAke21hdGNoaW5nVG9rZW4uaWR9IHdhcyBhbHJlYWR5IHVzZWQsIGNvbnRpbnVpbmcgYW55d2F5YCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gSmXFm2xpIHXFvHl0a293bmlrIGplc3QgemFsb2dvd2FueSwgc3ByYXdkxbogY3p5IHpha3VwIG5hbGXFvHkgZG8gbmllZ29cclxuICAgIC8vIFV3YWdhOiBQb3p3YWxhbXkgbmllemFsb2dvd2FueW0gdcW8eXRrb3duaWtvbSBuYSBkb3N0xJlwIHByenkgdcW8eWNpdSB0b2tlbnVcclxuICAgIGlmICh1c2VyUHJvZmlsZUlkICYmIHB1cmNoYXNlLnVzZXJfaWQgIT09IHVzZXJQcm9maWxlSWQpIHtcclxuICAgICAgY29uc29sZS53YXJuKGBTZWN1cml0eSB3YXJuaW5nOiBVc2VyICR7dXNlclByb2ZpbGVJZH0gYXR0ZW1wdGVkIHRvIGFjY2VzcyBwdXJjaGFzZSAke2lkfSBiZWxvbmdpbmcgdG8gdXNlciAke3B1cmNoYXNlLnVzZXJfaWR9YCk7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCBsb2dTZWN1cml0eUV2ZW50KHVzZXJQcm9maWxlSWQsICdhY2Nlc3NfYXR0ZW1wdCcsICdwdXJjaGFzZV9yZWNvcmQnLCBpZCwgJ2ZhaWxlZCcsIHtcclxuICAgICAgICByZWFzb246ICdVc2VyIG1pc21hdGNoJyxcclxuICAgICAgICBvd25lcl9pZDogcHVyY2hhc2UudXNlcl9pZFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIHRoaXMgcHVyY2hhc2UnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFBvdHdpZXJkemVuaWUgZG9zdMSZcHUgdyByZWplc3RyemUgemFrdXDDs3dcclxuICAgIGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3B1cmNoYXNlX3JlY29yZHMnKVxyXG4gICAgICAudXBkYXRlKHtcclxuICAgICAgICBhY2Nlc3NfY29uZmlybWVkOiB0cnVlLFxyXG4gICAgICAgIGFjY2Vzc19jb25maXJtZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KVxyXG4gICAgICAuZXEoJ2lkJywgaWQpO1xyXG4gICAgXHJcbiAgICAvLyBQb2JpZXJ6IGluc3RydWtjamUgZG9zdMSZcHVcclxuICAgIGNvbnN0IHsgZGF0YTogYWNjZXNzSW5zdHJ1Y3Rpb25zLCBlcnJvcjogaW5zdHJ1Y3Rpb25zRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ2FjY2Vzc19pbnN0cnVjdGlvbnMnKVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLmVxKCdncm91cF9zdWJfaWQnLCBwdXJjaGFzZS5ncm91cF9zdWJfaWQpXHJcbiAgICAgIC5tYXliZVNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBsZXQgZGVjcnlwdGVkSW5zdHJ1Y3Rpb25zID0gXCJcIjtcclxuICAgIFxyXG4gICAgLy8gT2JzxYJ1Z2EgcHJ6eXBhZGt1IGJyYWt1IGluc3RydWtjamlcclxuICAgIGlmIChpbnN0cnVjdGlvbnNFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBhY2Nlc3MgaW5zdHJ1Y3Rpb25zOicsIGluc3RydWN0aW9uc0Vycm9yKTtcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IGxvZ1NlY3VyaXR5RXZlbnQodXNlclByb2ZpbGVJZCwgJ2FjY2Vzc19hdHRlbXB0JywgJ3B1cmNoYXNlX3JlY29yZCcsIGlkLCAnd2FybmluZycsIHtcclxuICAgICAgICByZWFzb246ICdFcnJvciBmZXRjaGluZyBhY2Nlc3MgaW5zdHJ1Y3Rpb25zJyxcclxuICAgICAgICBlcnJvcjogaW5zdHJ1Y3Rpb25zRXJyb3I/Lm1lc3NhZ2UsXHJcbiAgICAgICAgZ3JvdXBfc3ViX2lkOiBwdXJjaGFzZS5ncm91cF9zdWJfaWRcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBUd29yenlteSBkb215xZtsbmUgaW5zdHJ1a2NqZSB6YW1pYXN0IHp3cmFjYcSHIGLFgsSFZFxyXG4gICAgICBkZWNyeXB0ZWRJbnN0cnVjdGlvbnMgPSBcIkluc3RydWtjamUgZG9zdMSZcHUgbmllIHpvc3RhxYJ5IGplc3pjemUgc2tvbmZpZ3Vyb3dhbmUgcHJ6ZXogc3ByemVkYXdjxJkuIFByb3NpbXkgbyBrb250YWt0IHplIHNwcnplZGF3Y8SFLCBhYnkgdXp5c2thxIcgZGFuZSBkb3N0xJlwb3dlLlwiO1xyXG4gICAgfSBlbHNlIGlmICghYWNjZXNzSW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihgTm8gYWNjZXNzIGluc3RydWN0aW9ucyBmb3VuZCBmb3IgZ3JvdXBfc3ViX2lkOiAke3B1cmNoYXNlLmdyb3VwX3N1Yl9pZH1gKTtcclxuICAgICAgXHJcbiAgICAgIGF3YWl0IGxvZ1NlY3VyaXR5RXZlbnQodXNlclByb2ZpbGVJZCwgJ2FjY2Vzc19hdHRlbXB0JywgJ3B1cmNoYXNlX3JlY29yZCcsIGlkLCAnd2FybmluZycsIHtcclxuICAgICAgICByZWFzb246ICdObyBhY2Nlc3MgaW5zdHJ1Y3Rpb25zIGZvdW5kJyxcclxuICAgICAgICBncm91cF9zdWJfaWQ6IHB1cmNoYXNlLmdyb3VwX3N1Yl9pZFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFR3b3J6eW15IGRvbXnFm2xuZSBpbnN0cnVrY2plIHphbWlhc3QgendyYWNhxIcgYsWCxIVkXHJcbiAgICAgIGRlY3J5cHRlZEluc3RydWN0aW9ucyA9IFwiSW5zdHJ1a2NqZSBkb3N0xJlwdSBuaWUgem9zdGHFgnkgamVzemN6ZSBza29uZmlndXJvd2FuZSBwcnpleiBzcHJ6ZWRhd2PEhS4gUHJvc2lteSBvIGtvbnRha3QgemUgc3ByemVkYXdjxIUsIGFieSB1enlza2HEhyBkYW5lIGRvc3TEmXBvd2UuXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBTeW11bGFjamEgZGVzenlmcm93YW5pYSBpbnN0cnVrY2ppIGRvc3TEmXB1XHJcbiAgICAgIC8vIFcgcnplY3p5d2lzdG/Fm2NpIHR1dGFqIGJ5xYJvYnkgcHJhd2R6aXdlIGRlc3p5ZnJvd2FuaWVcclxuICAgICAgaWYgKGFjY2Vzc0luc3RydWN0aW9ucy5lbmNyeXB0ZWRfZGF0YSAmJiBhY2Nlc3NJbnN0cnVjdGlvbnMuZW5jcnlwdGVkX2RhdGEuc3RhcnRzV2l0aChcIkVOQ1JZUFRFRDpcIikpIHtcclxuICAgICAgICAvLyBQcnp5a8WCYWRvd2UgXCJkZXN6eWZyb3dhbmllXCIgLSB3IHByb2R1a2NqaSBuYWxlxbx5IHXFvHnEhyBvZHBvd2llZG5pY2ggbWV0b2Qga3J5cHRvZ3JhZmljem55Y2hcclxuICAgICAgICBjb25zdCBiYXNlNjREYXRhID0gYWNjZXNzSW5zdHJ1Y3Rpb25zLmVuY3J5cHRlZF9kYXRhLnJlcGxhY2UoXCJFTkNSWVBURUQ6XCIsIFwiXCIpO1xyXG4gICAgICAgIGRlY3J5cHRlZEluc3RydWN0aW9ucyA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKS50b1N0cmluZygndXRmLTgnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBkZWNyeXB0ZWRJbnN0cnVjdGlvbnMgPSBhY2Nlc3NJbnN0cnVjdGlvbnMuZW5jcnlwdGVkX2RhdGEgfHwgXCJJbnN0cnVrY2plIGRvc3TEmXB1IG5pZSBzxIUgZG9zdMSZcG5lIHcgY3p5dGVsbnltIGZvcm1hY2llLlwiO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFBvYmllcnogZGFuZSBrb250YWt0b3dlIHfFgmHFm2NpY2llbGEgZ3J1cHksIGFieSBrdXB1asSFY3kgbcOzZ8WCIHNpxJkgc2tvbnRha3Rvd2HEhyB3IHJhemllIHByb2JsZW3Ds3dcclxuICAgIGNvbnN0IHsgZGF0YTogZ3JvdXBPd25lciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnZ3JvdXBzJylcclxuICAgICAgLnNlbGVjdChgXHJcbiAgICAgICAgb3duZXI6dXNlcl9wcm9maWxlcyFvd25lcl9pZChkaXNwbGF5X25hbWUsIGVtYWlsKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ2lkJywgcHVyY2hhc2UuZ3JvdXBfc3ViLmdyb3VwX2lkKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGNvbnN0IG93bmVyQ29udGFjdCA9IGdyb3VwT3duZXI/Lm93bmVyIHx8IHsgZGlzcGxheV9uYW1lOiBcIlNwcnplZGF3Y2FcIiwgZW1haWw6IFwiTmllZG9zdMSZcG55XCIgfTtcclxuICAgIFxyXG4gICAgLy8gWmFsb2d1aiB1ZGFueSBkb3N0xJlwXHJcbiAgICBhd2FpdCBsb2dTZWN1cml0eUV2ZW50KHVzZXJQcm9maWxlSWQgfHwgcHVyY2hhc2UudXNlcl9pZCwgJ2FjY2Vzc19zdWNjZXNzJywgJ3B1cmNoYXNlX3JlY29yZCcsIGlkLCAnc3VjY2VzcycsIHtcclxuICAgICAgcGxhdGZvcm06IHB1cmNoYXNlLmdyb3VwX3N1Yi5wbGF0Zm9ybS5uYW1lLFxyXG4gICAgICB0b2tlbl9pZDogZGlyZWN0QWNjZXNzID8gJ2RpcmVjdF9hY2Nlc3MnIDogbWF0Y2hpbmdUb2tlbi5pZCxcclxuICAgICAgaGFzX2luc3RydWN0aW9uczogISFhY2Nlc3NJbnN0cnVjdGlvbnNcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhgQWNjZXNzIHN1Y2Nlc3NmdWwgZm9yIHB1cmNoYXNlICR7aWR9YCk7XHJcbiAgICBcclxuICAgIC8vIFp3csOzxIcgZGFuZSBkb3N0xJlwb3dlXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICBwdXJjaGFzZV9pZDogaWQsXHJcbiAgICAgIHBsYXRmb3JtOiBwdXJjaGFzZS5ncm91cF9zdWIucGxhdGZvcm0ubmFtZSxcclxuICAgICAgaW5zdHJ1Y3Rpb25zOiBkZWNyeXB0ZWRJbnN0cnVjdGlvbnMsXHJcbiAgICAgIHB1cmNoYXNlZF9hdDogcHVyY2hhc2UuY3JlYXRlZF9hdCxcclxuICAgICAgdXNlcjogcHVyY2hhc2UudXNlci5kaXNwbGF5X25hbWUsXHJcbiAgICAgIGVtYWlsOiBwdXJjaGFzZS51c2VyLmVtYWlsLFxyXG4gICAgICBvd25lcl9jb250YWN0OiBvd25lckNvbnRhY3QsXHJcbiAgICAgIGhhc19pbnN0cnVjdGlvbnM6ICEhYWNjZXNzSW5zdHJ1Y3Rpb25zLFxyXG4gICAgICBkaXJlY3RfYWNjZXNzOiBkaXJlY3RBY2Nlc3NcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGFjY2VzcyByZXF1ZXN0OicsIGVycm9yKTtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgbG9nU2VjdXJpdHlFdmVudChudWxsLCAnYWNjZXNzX2F0dGVtcHQnLCAncHVyY2hhc2VfcmVjb3JkJywgcGFyYW1zPy5pZCB8fCAndW5rbm93bicsICdlcnJvcicsIHtcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGxvZ0Vycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2cgc2VjdXJpdHkgZXZlbnQ6JywgbG9nRXJyb3IpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyBhY2Nlc3MgcmVxdWVzdCcgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRnVua2NqYSBkbyBsb2dvd2FuaWEgemRhcnplxYQgYmV6cGllY3plxYRzdHdhXHJcbmFzeW5jIGZ1bmN0aW9uIGxvZ1NlY3VyaXR5RXZlbnQodXNlcklkLCBhY3Rpb25UeXBlLCByZXNvdXJjZVR5cGUsIHJlc291cmNlSWQsIHN0YXR1cywgZGV0YWlscyA9IHt9KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgICAgLmZyb20oJ3NlY3VyaXR5X2xvZ3MnKVxyXG4gICAgICAuaW5zZXJ0KHtcclxuICAgICAgICB1c2VyX2lkOiB1c2VySWQsXHJcbiAgICAgICAgYWN0aW9uX3R5cGU6IGFjdGlvblR5cGUsXHJcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxyXG4gICAgICAgIHJlc291cmNlX2lkOiBTdHJpbmcocmVzb3VyY2VJZCksXHJcbiAgICAgICAgc3RhdHVzOiBzdGF0dXMsXHJcbiAgICAgICAgZGV0YWlsczogZGV0YWlscyxcclxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2dnaW5nIHNlY3VyaXR5IGV2ZW50OicsIGVycm9yKTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIGxvZ2dpbmcgc2VjdXJpdHkgZXZlbnQ6JywgZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gQmV6cGllY3puYSBmdW5rY2phIGhhc2h1asSFY2EgdG9rZW5cclxuZnVuY3Rpb24gaGFzaFRva2VuKHRva2VuKSB7XHJcbiAgY29uc3Qgc2FsdCA9IHByb2Nlc3MuZW52LlRPS0VOX1NBTFQgfHwgJyc7XHJcbiAgcmV0dXJuIGNyeXB0b1xyXG4gICAgLmNyZWF0ZUhhc2goJ3NoYTI1NicpXHJcbiAgICAudXBkYXRlKHRva2VuICsgc2FsdClcclxuICAgIC5kaWdlc3QoJ2hleCcpO1xyXG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImN1cnJlbnRVc2VyIiwiY3J5cHRvIiwic3VwYWJhc2VBZG1pbiIsIkdFVCIsInJlcXVlc3QiLCJwYXJhbXMiLCJpZCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInRva2VuIiwiZ2V0IiwiY29uc29sZSIsImxvZyIsImRpcmVjdEFjY2VzcyIsImxvZ1NlY3VyaXR5RXZlbnQiLCJyZWFzb24iLCJpcCIsImhlYWRlcnMiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJ1c2VyIiwidXNlclByb2ZpbGVJZCIsImRhdGEiLCJwcm9maWxlIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwicHVyY2hhc2UiLCJwdXJjaGFzZUVycm9yIiwibWVzc2FnZSIsImFjY2Vzc19wcm92aWRlZCIsInB1cmNoYXNlX3N0YXR1cyIsInRva2VuSGFzaCIsImhhc2hUb2tlbiIsInN1YnN0cmluZyIsImFsbFRva2VucyIsInRva2Vuc0Vycm9yIiwibGVuZ3RoIiwidCIsInRva2VuX2hhc2giLCJleHBpcmVzX2F0IiwidXNlZCIsIm1hdGNoaW5nVG9rZW4iLCJ0b2tlbkVycm9yIiwiZ3QiLCJEYXRlIiwidG9JU09TdHJpbmciLCJtYXliZVNpbmdsZSIsInVwZGF0ZUVycm9yIiwidXBkYXRlIiwidXNlZF9hdCIsImlwX2FkZHJlc3MiLCJ1c2VyX2FnZW50IiwidXNlcl9pZCIsIndhcm4iLCJvd25lcl9pZCIsImFjY2Vzc19jb25maXJtZWQiLCJhY2Nlc3NfY29uZmlybWVkX2F0IiwiYWNjZXNzSW5zdHJ1Y3Rpb25zIiwiaW5zdHJ1Y3Rpb25zRXJyb3IiLCJncm91cF9zdWJfaWQiLCJkZWNyeXB0ZWRJbnN0cnVjdGlvbnMiLCJlbmNyeXB0ZWRfZGF0YSIsInN0YXJ0c1dpdGgiLCJiYXNlNjREYXRhIiwicmVwbGFjZSIsIkJ1ZmZlciIsInRvU3RyaW5nIiwiZ3JvdXBPd25lciIsImdyb3VwX3N1YiIsImdyb3VwX2lkIiwib3duZXJDb250YWN0Iiwib3duZXIiLCJkaXNwbGF5X25hbWUiLCJlbWFpbCIsInBsYXRmb3JtIiwibmFtZSIsInRva2VuX2lkIiwiaGFzX2luc3RydWN0aW9ucyIsInB1cmNoYXNlX2lkIiwiaW5zdHJ1Y3Rpb25zIiwicHVyY2hhc2VkX2F0IiwiY3JlYXRlZF9hdCIsIm93bmVyX2NvbnRhY3QiLCJkaXJlY3RfYWNjZXNzIiwibG9nRXJyb3IiLCJ1c2VySWQiLCJhY3Rpb25UeXBlIiwicmVzb3VyY2VUeXBlIiwicmVzb3VyY2VJZCIsImRldGFpbHMiLCJpbnNlcnQiLCJhY3Rpb25fdHlwZSIsInJlc291cmNlX3R5cGUiLCJyZXNvdXJjZV9pZCIsIlN0cmluZyIsInNhbHQiLCJwcm9jZXNzIiwiZW52IiwiVE9LRU5fU0FMVCIsImNyZWF0ZUhhc2giLCJkaWdlc3QiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/access/[id]/route.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/database/supabase-admin-client.js":
/*!***************************************************!*\
  !*** ./src/lib/database/supabase-admin-client.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createUserProfileAdmin: () => (/* binding */ createUserProfileAdmin),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getGroupMembersAdmin: () => (/* binding */ getGroupMembersAdmin),\n/* harmony export */   getSubscriptionPlatformsAdmin: () => (/* binding */ getSubscriptionPlatformsAdmin),\n/* harmony export */   getUserByAuthIdAdmin: () => (/* binding */ getUserByAuthIdAdmin),\n/* harmony export */   handleSupabaseAdminError: () => (/* binding */ handleSupabaseAdminError),\n/* harmony export */   logAdminActivity: () => (/* binding */ logAdminActivity),\n/* harmony export */   updateUserProfileAdmin: () => (/* binding */ updateUserProfileAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// src/lib/supabase-admin-client.js\n\n// Inicjalizacja klienta Supabase z uprawnieniami administratora\nconst supabaseUrl = \"https://nimrnohkesysfppcmujb.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n// Sprawdzenie czy zmienne środowiskowe są ustawione\nif (!supabaseUrl || !supabaseServiceKey) {\n    console.error(\"Missing environment variables: NEXT_PUBLIC_SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\");\n}\n// Uwaga: Ten klient ma pełne uprawnienia do bazy danych, używaj ostrożnie!\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n// Funkcja pomocnicza do obsługi błędów Supabase\nconst handleSupabaseAdminError = (error)=>{\n    console.error(\"Supabase Admin error:\", error);\n    return {\n        error: true,\n        message: error.message || \"Nieoczekiwany błąd administratora\",\n        code: error.code || \"unknown_error\",\n        details: error.details || null\n    };\n};\n// Funkcje administratora do zarządzania użytkownikami\n// Funkcja do tworzenia profilu użytkownika przez administratora\nconst createUserProfileAdmin = async (userProfile)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").insert([\n            userProfile\n        ]).select().single();\n        if (error) {\n            if (error.code === \"23505\") {\n                console.warn(\"Admin: Pr\\xf3ba utworzenia duplikatu profilu użytkownika:\", error);\n                // Jeśli profil już istnieje, pobierz go\n                const { data: existingUser, error: fetchError } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", userProfile.external_auth_id).single();\n                if (fetchError) {\n                    throw new Error(\"Nie można pobrać istniejącego profilu: \" + fetchError.message);\n                }\n                return existingUser;\n            } else {\n                throw new Error(error.message || \"Nie udało się utworzyć profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania profilu użytkownika przez administratora\nconst getUserByAuthIdAdmin = async (authId)=>{\n    if (!authId) return null;\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", authId).single();\n        if (error) {\n            if (error.code === \"PGRST116\") {\n                // Nie znaleziono - to normalny przypadek\n                return null;\n            } else {\n                console.error(\"Admin: Błąd pobierania profilu użytkownika:\", error);\n                throw new Error(error.message || \"Nie udało się pobrać profilu użytkownika\");\n            }\n        }\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do aktualizacji profilu użytkownika przez administratora\nconst updateUserProfileAdmin = async (userId, updates)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").update(updates).eq(\"id\", userId).select().single();\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        throw error;\n    }\n};\n// Funkcja do pobierania platform subskrypcyjnych przez administratora\nconst getSubscriptionPlatformsAdmin = async ()=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"subscription_platforms\").select(\"*\").order(\"name\");\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Funkcja do pobierania członków grupy przez administratora\nconst getGroupMembersAdmin = async (groupId)=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"group_members\").select(`\r\n        *,\r\n        user:user_profiles(id, display_name, avatar_url, email)\r\n      `).eq(\"group_id\", groupId);\n        if (error) throw error;\n        return data;\n    } catch (error) {\n        handleSupabaseAdminError(error);\n        return [];\n    }\n};\n// Zapisz wszystkie aktywności administratora do logu bezpieczeństwa\nconst logAdminActivity = async (action, resourceType, resourceId, details = {})=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"security_logs\").insert([\n            {\n                action_type: action,\n                resource_type: resourceType,\n                resource_id: resourceId,\n                status: \"success\",\n                details: details\n            }\n        ]);\n        if (error) console.error(\"Błąd logowania aktywności administratora:\", error);\n    } catch (error) {\n        console.error(\"Wyjątek podczas logowania aktywności administratora:\", error);\n    }\n};\n// Eksport klienta administratora jako domyślny\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabaseAdmin);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RhdGFiYXNlL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSxtQ0FBbUM7QUFDa0I7QUFFckQsZ0VBQWdFO0FBQ2hFLE1BQU1DLGNBQWNDLDBDQUFvQztBQUN4RCxNQUFNRyxxQkFBcUJILFFBQVFDLEdBQUcsQ0FBQ0cseUJBQXlCO0FBRWhFLG9EQUFvRDtBQUNwRCxJQUFJLENBQUNMLGVBQWUsQ0FBQ0ksb0JBQW9CO0lBQ3ZDRSxRQUFRQyxLQUFLLENBQ1g7QUFFSjtBQUVBLDJFQUEyRTtBQUMzRSxNQUFNQyxnQkFBZ0JULG1FQUFZQSxDQUFDQyxhQUFhSSxvQkFBb0I7SUFDbEVLLE1BQU07UUFDSkMsZ0JBQWdCO1FBQ2hCQyxrQkFBa0I7SUFDcEI7QUFDRjtBQUVBLGdEQUFnRDtBQUN6QyxNQUFNQywyQkFBMkIsQ0FBQ0w7SUFDdkNELFFBQVFDLEtBQUssQ0FBQyx5QkFBeUJBO0lBRXZDLE9BQU87UUFDTEEsT0FBTztRQUNQTSxTQUFTTixNQUFNTSxPQUFPLElBQUk7UUFDMUJDLE1BQU1QLE1BQU1PLElBQUksSUFBSTtRQUNwQkMsU0FBU1IsTUFBTVEsT0FBTyxJQUFJO0lBQzVCO0FBQ0YsRUFBRTtBQUVGLHNEQUFzRDtBQUV0RCxnRUFBZ0U7QUFDekQsTUFBTUMseUJBQXlCLE9BQU9DO0lBQzNDLElBQUk7UUFDRixNQUFNLEVBQUVDLElBQUksRUFBRVgsS0FBSyxFQUFFLEdBQUcsTUFBTUMsY0FDM0JXLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDO1lBQUNIO1NBQVksRUFDcEJJLE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlmLE9BQU87WUFDVCxJQUFJQSxNQUFNTyxJQUFJLEtBQUssU0FBUztnQkFDMUJSLFFBQVFpQixJQUFJLENBQUMsNkRBQTBEaEI7Z0JBRXZFLHdDQUF3QztnQkFDeEMsTUFBTSxFQUFFVyxNQUFNTSxZQUFZLEVBQUVqQixPQUFPa0IsVUFBVSxFQUFFLEdBQUcsTUFBTWpCLGNBQ3JEVyxJQUFJLENBQUMsaUJBQ0xFLE1BQU0sQ0FBQyxLQUNQSyxFQUFFLENBQUMsb0JBQW9CVCxZQUFZVSxnQkFBZ0IsRUFDbkRMLE1BQU07Z0JBRVQsSUFBSUcsWUFBWTtvQkFDZCxNQUFNLElBQUlHLE1BQU0sNENBQTRDSCxXQUFXWixPQUFPO2dCQUNoRjtnQkFFQSxPQUFPVztZQUNULE9BQU87Z0JBQ0wsTUFBTSxJQUFJSSxNQUFNckIsTUFBTU0sT0FBTyxJQUFJO1lBQ25DO1FBQ0Y7UUFFQSxPQUFPSztJQUNULEVBQUUsT0FBT1gsT0FBTztRQUNkSyx5QkFBeUJMO1FBQ3pCLE1BQU1BO0lBQ1I7QUFDRixFQUFFO0FBRUYsaUVBQWlFO0FBQzFELE1BQU1zQix1QkFBdUIsT0FBT0M7SUFDekMsSUFBSSxDQUFDQSxRQUFRLE9BQU87SUFFcEIsSUFBSTtRQUNGLE1BQU0sRUFBRVosSUFBSSxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNQyxjQUMzQlcsSUFBSSxDQUFDLGlCQUNMRSxNQUFNLENBQUMsS0FDUEssRUFBRSxDQUFDLG9CQUFvQkksUUFDdkJSLE1BQU07UUFFVCxJQUFJZixPQUFPO1lBQ1QsSUFBSUEsTUFBTU8sSUFBSSxLQUFLLFlBQVk7Z0JBQzdCLHlDQUF5QztnQkFDekMsT0FBTztZQUNULE9BQU87Z0JBQ0xSLFFBQVFDLEtBQUssQ0FBQywrQ0FBK0NBO2dCQUM3RCxNQUFNLElBQUlxQixNQUFNckIsTUFBTU0sT0FBTyxJQUFJO1lBQ25DO1FBQ0Y7UUFFQSxPQUFPSztJQUNULEVBQUUsT0FBT1gsT0FBTztRQUNkSyx5QkFBeUJMO1FBQ3pCLE1BQU1BO0lBQ1I7QUFDRixFQUFFO0FBRUYsbUVBQW1FO0FBQzVELE1BQU13Qix5QkFBeUIsT0FBT0MsUUFBUUM7SUFDbkQsSUFBSTtRQUNGLE1BQU0sRUFBRWYsSUFBSSxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNQyxjQUMzQlcsSUFBSSxDQUFDLGlCQUNMZSxNQUFNLENBQUNELFNBQ1BQLEVBQUUsQ0FBQyxNQUFNTSxRQUNUWCxNQUFNLEdBQ05DLE1BQU07UUFFVCxJQUFJZixPQUFPLE1BQU1BO1FBRWpCLE9BQU9XO0lBQ1QsRUFBRSxPQUFPWCxPQUFPO1FBQ2RLLHlCQUF5Qkw7UUFDekIsTUFBTUE7SUFDUjtBQUNGLEVBQUU7QUFFRixzRUFBc0U7QUFDL0QsTUFBTTRCLGdDQUFnQztJQUMzQyxJQUFJO1FBQ0YsTUFBTSxFQUFFakIsSUFBSSxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNQyxjQUMzQlcsSUFBSSxDQUFDLDBCQUNMRSxNQUFNLENBQUMsS0FDUGUsS0FBSyxDQUFDO1FBRVQsSUFBSTdCLE9BQU8sTUFBTUE7UUFFakIsT0FBT1c7SUFDVCxFQUFFLE9BQU9YLE9BQU87UUFDZEsseUJBQXlCTDtRQUN6QixPQUFPLEVBQUU7SUFDWDtBQUNGLEVBQUU7QUFFRiw0REFBNEQ7QUFDckQsTUFBTThCLHVCQUF1QixPQUFPQztJQUN6QyxJQUFJO1FBQ0YsTUFBTSxFQUFFcEIsSUFBSSxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNQyxjQUMzQlcsSUFBSSxDQUFDLGlCQUNMRSxNQUFNLENBQUMsQ0FBQzs7O01BR1QsQ0FBQyxFQUNBSyxFQUFFLENBQUMsWUFBWVk7UUFFbEIsSUFBSS9CLE9BQU8sTUFBTUE7UUFFakIsT0FBT1c7SUFDVCxFQUFFLE9BQU9YLE9BQU87UUFDZEsseUJBQXlCTDtRQUN6QixPQUFPLEVBQUU7SUFDWDtBQUNGLEVBQUU7QUFFRixvRUFBb0U7QUFDN0QsTUFBTWdDLG1CQUFtQixPQUFPQyxRQUFRQyxjQUFjQyxZQUFZM0IsVUFBVSxDQUFDLENBQUM7SUFDbkYsSUFBSTtRQUNGLE1BQU0sRUFBRUcsSUFBSSxFQUFFWCxLQUFLLEVBQUUsR0FBRyxNQUFNQyxjQUMzQlcsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUM7WUFBQztnQkFDUHVCLGFBQWFIO2dCQUNiSSxlQUFlSDtnQkFDZkksYUFBYUg7Z0JBQ2JJLFFBQVE7Z0JBQ1IvQixTQUFTQTtZQUNYO1NBQUU7UUFFSixJQUFJUixPQUFPRCxRQUFRQyxLQUFLLENBQUMsNkNBQTZDQTtJQUV4RSxFQUFFLE9BQU9BLE9BQU87UUFDZEQsUUFBUUMsS0FBSyxDQUFDLHdEQUF3REE7SUFDeEU7QUFDRixFQUFFO0FBRUYsK0NBQStDO0FBQy9DLGlFQUFlQyxhQUFhQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2xpYi9kYXRhYmFzZS9zdXBhYmFzZS1hZG1pbi1jbGllbnQuanM/MzQ3NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qc1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuLy8gSW5pY2phbGl6YWNqYSBrbGllbnRhIFN1cGFiYXNlIHogdXByYXduaWVuaWFtaSBhZG1pbmlzdHJhdG9yYVxyXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcclxuY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcclxuXHJcbi8vIFNwcmF3ZHplbmllIGN6eSB6bWllbm5lIMWbcm9kb3dpc2tvd2Ugc8SFIHVzdGF3aW9uZVxyXG5pZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZVNlcnZpY2VLZXkpIHtcclxuICBjb25zb2xlLmVycm9yKFxyXG4gICAgJ01pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzOiBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgb3IgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSdcclxuICApO1xyXG59XHJcblxyXG4vLyBVd2FnYTogVGVuIGtsaWVudCBtYSBwZcWCbmUgdXByYXduaWVuaWEgZG8gYmF6eSBkYW55Y2gsIHXFvHl3YWogb3N0cm/FvG5pZSFcclxuY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XHJcbiAgYXV0aDoge1xyXG4gICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgfSxcclxufSk7XHJcblxyXG4vLyBGdW5rY2phIHBvbW9jbmljemEgZG8gb2JzxYJ1Z2kgYsWCxJlkw7N3IFN1cGFiYXNlXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IgPSAoZXJyb3IpID0+IHtcclxuICBjb25zb2xlLmVycm9yKCdTdXBhYmFzZSBBZG1pbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGVycm9yOiB0cnVlLFxyXG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnTmllb2N6ZWtpd2FueSBixYLEhWQgYWRtaW5pc3RyYXRvcmEnLFxyXG4gICAgY29kZTogZXJyb3IuY29kZSB8fCAndW5rbm93bl9lcnJvcicsXHJcbiAgICBkZXRhaWxzOiBlcnJvci5kZXRhaWxzIHx8IG51bGwsXHJcbiAgfTtcclxufTtcclxuXHJcbi8vIEZ1bmtjamUgYWRtaW5pc3RyYXRvcmEgZG8gemFyesSFZHphbmlhIHXFvHl0a293bmlrYW1pXHJcblxyXG4vLyBGdW5rY2phIGRvIHR3b3J6ZW5pYSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgY3JlYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VyUHJvZmlsZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLmluc2VydChbdXNlclByb2ZpbGVdKVxyXG4gICAgICAuc2VsZWN0KClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwNScpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ0FkbWluOiBQcsOzYmEgdXR3b3J6ZW5pYSBkdXBsaWthdHUgcHJvZmlsdSB1xbx5dGtvd25pa2E6JywgZXJyb3IpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEplxZtsaSBwcm9maWwganXFvCBpc3RuaWVqZSwgcG9iaWVyeiBnb1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZXhpc3RpbmdVc2VyLCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCB1c2VyUHJvZmlsZS5leHRlcm5hbF9hdXRoX2lkKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgaWYgKGZldGNoRXJyb3IpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTmllIG1vxbxuYSBwb2JyYcSHIGlzdG5pZWrEhWNlZ28gcHJvZmlsdTogJyArIGZldGNoRXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBleGlzdGluZ1VzZXI7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSB1dHdvcnp5xIcgcHJvZmlsdSB1xbx5dGtvd25pa2EnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgaGFuZGxlU3VwYWJhc2VBZG1pbkVycm9yKGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIEZ1bmtjamEgZG8gcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgZ2V0VXNlckJ5QXV0aElkQWRtaW4gPSBhc3luYyAoYXV0aElkKSA9PiB7XHJcbiAgaWYgKCFhdXRoSWQpIHJldHVybiBudWxsO1xyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5lcSgnZXh0ZXJuYWxfYXV0aF9pZCcsIGF1dGhJZClcclxuICAgICAgLnNpbmdsZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdQR1JTVDExNicpIHtcclxuICAgICAgICAvLyBOaWUgem5hbGV6aW9ubyAtIHRvIG5vcm1hbG55IHByenlwYWRla1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FkbWluOiBCxYLEhWQgcG9iaWVyYW5pYSBwcm9maWx1IHXFvHl0a293bmlrYTonLCBlcnJvcik7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ05pZSB1ZGHFgm8gc2nEmSBwb2JyYcSHIHByb2ZpbHUgdcW8eXRrb3duaWthJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIGFrdHVhbGl6YWNqaSBwcm9maWx1IHXFvHl0a293bmlrYSBwcnpleiBhZG1pbmlzdHJhdG9yYVxyXG5leHBvcnQgY29uc3QgdXBkYXRlVXNlclByb2ZpbGVBZG1pbiA9IGFzeW5jICh1c2VySWQsIHVwZGF0ZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgndXNlcl9wcm9maWxlcycpXHJcbiAgICAgIC51cGRhdGUodXBkYXRlcylcclxuICAgICAgLmVxKCdpZCcsIHVzZXJJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG4vLyBGdW5rY2phIGRvIHBvYmllcmFuaWEgcGxhdGZvcm0gc3Vic2tyeXBjeWpueWNoIHByemV6IGFkbWluaXN0cmF0b3JhXHJcbmV4cG9ydCBjb25zdCBnZXRTdWJzY3JpcHRpb25QbGF0Zm9ybXNBZG1pbiA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnc3Vic2NyaXB0aW9uX3BsYXRmb3JtcycpXHJcbiAgICAgIC5zZWxlY3QoJyonKVxyXG4gICAgICAub3JkZXIoJ25hbWUnKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuICAgIFxyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvcihlcnJvcik7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRnVua2NqYSBkbyBwb2JpZXJhbmlhIGN6xYJvbmvDs3cgZ3J1cHkgcHJ6ZXogYWRtaW5pc3RyYXRvcmFcclxuZXhwb3J0IGNvbnN0IGdldEdyb3VwTWVtYmVyc0FkbWluID0gYXN5bmMgKGdyb3VwSWQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnZ3JvdXBfbWVtYmVycycpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICosXHJcbiAgICAgICAgdXNlcjp1c2VyX3Byb2ZpbGVzKGlkLCBkaXNwbGF5X25hbWUsIGF2YXRhcl91cmwsIGVtYWlsKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ2dyb3VwX2lkJywgZ3JvdXBJZCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcbiAgICBcclxuICAgIHJldHVybiBkYXRhO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBoYW5kbGVTdXBhYmFzZUFkbWluRXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbi8vIFphcGlzeiB3c3p5c3RraWUgYWt0eXdub8WbY2kgYWRtaW5pc3RyYXRvcmEgZG8gbG9ndSBiZXpwaWVjemXFhHN0d2FcclxuZXhwb3J0IGNvbnN0IGxvZ0FkbWluQWN0aXZpdHkgPSBhc3luYyAoYWN0aW9uLCByZXNvdXJjZVR5cGUsIHJlc291cmNlSWQsIGRldGFpbHMgPSB7fSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdzZWN1cml0eV9sb2dzJylcclxuICAgICAgLmluc2VydChbe1xyXG4gICAgICAgIGFjdGlvbl90eXBlOiBhY3Rpb24sXHJcbiAgICAgICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxyXG4gICAgICAgIHJlc291cmNlX2lkOiByZXNvdXJjZUlkLFxyXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgIGRldGFpbHM6IGRldGFpbHMsXHJcbiAgICAgIH1dKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSBjb25zb2xlLmVycm9yKCdCxYLEhWQgbG9nb3dhbmlhIGFrdHl3bm/Fm2NpIGFkbWluaXN0cmF0b3JhOicsIGVycm9yKTtcclxuICAgIFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdXeWrEhXRlayBwb2RjemFzIGxvZ293YW5pYSBha3R5d25vxZtjaSBhZG1pbmlzdHJhdG9yYTonLCBlcnJvcik7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8gRWtzcG9ydCBrbGllbnRhIGFkbWluaXN0cmF0b3JhIGpha28gZG9tecWbbG55XHJcbmV4cG9ydCBkZWZhdWx0IHN1cGFiYXNlQWRtaW47Il0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJjb25zb2xlIiwiZXJyb3IiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImhhbmRsZVN1cGFiYXNlQWRtaW5FcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwiZGV0YWlscyIsImNyZWF0ZVVzZXJQcm9maWxlQWRtaW4iLCJ1c2VyUHJvZmlsZSIsImRhdGEiLCJmcm9tIiwiaW5zZXJ0Iiwic2VsZWN0Iiwic2luZ2xlIiwid2FybiIsImV4aXN0aW5nVXNlciIsImZldGNoRXJyb3IiLCJlcSIsImV4dGVybmFsX2F1dGhfaWQiLCJFcnJvciIsImdldFVzZXJCeUF1dGhJZEFkbWluIiwiYXV0aElkIiwidXBkYXRlVXNlclByb2ZpbGVBZG1pbiIsInVzZXJJZCIsInVwZGF0ZXMiLCJ1cGRhdGUiLCJnZXRTdWJzY3JpcHRpb25QbGF0Zm9ybXNBZG1pbiIsIm9yZGVyIiwiZ2V0R3JvdXBNZW1iZXJzQWRtaW4iLCJncm91cElkIiwibG9nQWRtaW5BY3Rpdml0eSIsImFjdGlvbiIsInJlc291cmNlVHlwZSIsInJlc291cmNlSWQiLCJhY3Rpb25fdHlwZSIsInJlc291cmNlX3R5cGUiLCJyZXNvdXJjZV9pZCIsInN0YXR1cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/database/supabase-admin-client.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@clerk","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/cookie","vendor-chunks/map-obj","vendor-chunks/no-case","vendor-chunks/lower-case","vendor-chunks/snakecase-keys","vendor-chunks/snake-case","vendor-chunks/dot-case","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Faccess%2F%5Bid%5D%2Froute&page=%2Fapi%2Faccess%2F%5Bid%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Faccess%2F%5Bid%5D%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShare%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();